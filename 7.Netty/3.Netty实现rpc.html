
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>3.Netty实现rpc · 学习笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="ALin">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-footer-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="2.Netty实战.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://lucklin8.github.io/ALin.github.io/" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    1.JAVA基础
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    JAVA容器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../1.JAVA基础/JAVA容器/1.ArrayList与LinkedList.html">
            
                <a href="../1.JAVA基础/JAVA容器/1.ArrayList与LinkedList.html">
            
                    
                    1.ArrayList与LinkedList
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../1.JAVA基础/JAVA容器/2.HashTable.html">
            
                <a href="../1.JAVA基础/JAVA容器/2.HashTable.html">
            
                    
                    2.HashTable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../1.JAVA基础/JAVA容器/3.HashMap.html">
            
                <a href="../1.JAVA基础/JAVA容器/3.HashMap.html">
            
                    
                    3.HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../1.JAVA基础/JAVA容器/4.ConcurrentHashMap.html">
            
                <a href="../1.JAVA基础/JAVA容器/4.ConcurrentHashMap.html">
            
                    
                    4.ConcurrentHashMap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    JVM
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../1.JAVA基础/JVM/1.深入理解JVM.html">
            
                <a href="../1.JAVA基础/JVM/1.深入理解JVM.html">
            
                    
                    1.深入理解JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../1.JAVA基础/JVM/2.JVM常见问题.html">
            
                <a href="../1.JAVA基础/JVM/2.JVM常见问题.html">
            
                    
                    2.JVM常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                    并发编程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../1.JAVA基础/并发编程/1.JMM内存模型和volatile.html">
            
                <a href="../1.JAVA基础/并发编程/1.JMM内存模型和volatile.html">
            
                    
                    1.JMM内存模型和volatile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../1.JAVA基础/并发编程/2.CAS.html">
            
                <a href="../1.JAVA基础/并发编程/2.CAS.html">
            
                    
                    2.CAS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../1.JAVA基础/并发编程/3.锁.html">
            
                <a href="../1.JAVA基础/并发编程/3.锁.html">
            
                    
                    3.锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../1.JAVA基础/并发编程/4.CountDownLatch、CyclicBarrier、Semaphore.html">
            
                <a href="../1.JAVA基础/并发编程/4.CountDownLatch、CyclicBarrier、Semaphore.html">
            
                    
                    4.CountDownLatch、CyclicBarrier、Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../1.JAVA基础/并发编程/5.AQS原理以及AQS同步组件.html">
            
                <a href="../1.JAVA基础/并发编程/5.AQS原理以及AQS同步组件.html">
            
                    
                    5.AQS原理以及AQS同步组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../1.JAVA基础/并发编程/6.阻塞队列.html">
            
                <a href="../1.JAVA基础/并发编程/6.阻塞队列.html">
            
                    
                    6.阻塞队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.7" data-path="../1.JAVA基础/并发编程/7.Synchronized与锁升级.html">
            
                <a href="../1.JAVA基础/并发编程/7.Synchronized与锁升级.html">
            
                    
                    7.Synchronized与锁升级
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.8" data-path="../1.JAVA基础/并发编程/8.Synchronized与ReentrantLock.html">
            
                <a href="../1.JAVA基础/并发编程/8.Synchronized与ReentrantLock.html">
            
                    
                    8.Synchronized与ReentrantLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.9" data-path="../1.JAVA基础/并发编程/9.ThreadPoolExecutor.html">
            
                <a href="../1.JAVA基础/并发编程/9.ThreadPoolExecutor.html">
            
                    
                    9.ThreadPoolExecutor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.10" data-path="../1.JAVA基础/并发编程/x.DeadLock.html">
            
                <a href="../1.JAVA基础/并发编程/x.DeadLock.html">
            
                    
                    x.DeadLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.11" data-path="../1.JAVA基础/并发编程/x1.ThreadLocal.html">
            
                <a href="../1.JAVA基础/并发编程/x1.ThreadLocal.html">
            
                    
                    x1.ThreadLocal
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    2.分布式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../2.分布式/1.分布式事务.html">
            
                <a href="../2.分布式/1.分布式事务.html">
            
                    
                    1.分布式事务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    3.Mysql原理
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../3.Mysql原理/1.索引失效和索引优化.html">
            
                <a href="../3.Mysql原理/1.索引失效和索引优化.html">
            
                    
                    1.索引失效和索引优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../3.Mysql原理/2.B+Tree与Innodb.html">
            
                <a href="../3.Mysql原理/2.B+Tree与Innodb.html">
            
                    
                    2.B+Tree与Innodb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../3.Mysql原理/3.Mysql如何实现事务.html">
            
                <a href="../3.Mysql原理/3.Mysql如何实现事务.html">
            
                    
                    3.Mysql如何实现事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../3.Mysql原理/4.MVCC.html">
            
                <a href="../3.Mysql原理/4.MVCC.html">
            
                    
                    4.MVCC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../3.Mysql原理/5.Mysql脏读、不可重复读、幻读和MVCC.html">
            
                <a href="../3.Mysql原理/5.Mysql脏读、不可重复读、幻读和MVCC.html">
            
                    
                    5.Mysql脏读、不可重复读、幻读和MVCC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../3.Mysql原理/6.Mysql锁.html">
            
                <a href="../3.Mysql原理/6.Mysql锁.html">
            
                    
                    6.Mysql锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../3.Mysql原理/7.Explain.html">
            
                <a href="../3.Mysql原理/7.Explain.html">
            
                    
                    7.Explain
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    4.Redis原理
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    常见问题
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../4.Redis原理/常见问题/1.热key击穿穿透雪崩.html">
            
                <a href="../4.Redis原理/常见问题/1.热key击穿穿透雪崩.html">
            
                    
                    1.热key击穿穿透雪崩
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../4.Redis原理/常见问题/2.redis分布式锁.html">
            
                <a href="../4.Redis原理/常见问题/2.redis分布式锁.html">
            
                    
                    2.redis分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../4.Redis原理/常见问题/3.如何保证缓存一致性.html">
            
                <a href="../4.Redis原理/常见问题/3.如何保证缓存一致性.html">
            
                    
                    3.如何保证缓存一致性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="../4.Redis原理/常见问题/4.过期删除策略和内存淘汰策略.html">
            
                <a href="../4.Redis原理/常见问题/4.过期删除策略和内存淘汰策略.html">
            
                    
                    4.过期删除策略和内存淘汰策略
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <span>
            
                    
                    数据结构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../4.Redis原理/数据结构/1.简单动态字符串.html">
            
                <a href="../4.Redis原理/数据结构/1.简单动态字符串.html">
            
                    
                    1.简单动态字符串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../4.Redis原理/数据结构/2.链表.html">
            
                <a href="../4.Redis原理/数据结构/2.链表.html">
            
                    
                    2.链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../4.Redis原理/数据结构/3.字典.html">
            
                <a href="../4.Redis原理/数据结构/3.字典.html">
            
                    
                    3.字典
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="../4.Redis原理/数据结构/4.跳跃表.html">
            
                <a href="../4.Redis原理/数据结构/4.跳跃表.html">
            
                    
                    4.跳跃表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="../4.Redis原理/数据结构/5.整数集合.html">
            
                <a href="../4.Redis原理/数据结构/5.整数集合.html">
            
                    
                    5.整数集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="../4.Redis原理/数据结构/6.压缩列表.html">
            
                <a href="../4.Redis原理/数据结构/6.压缩列表.html">
            
                    
                    6.压缩列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="../4.Redis原理/数据结构/7.对象.html">
            
                <a href="../4.Redis原理/数据结构/7.对象.html">
            
                    
                    7.对象
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" >
            
                <span>
            
                    
                    核心设计
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../4.Redis原理/核心设计/1.redis核心设计概述.html">
            
                <a href="../4.Redis原理/核心设计/1.redis核心设计概述.html">
            
                    
                    1.redis核心设计概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../4.Redis原理/核心设计/2.redis为什么这么快.html">
            
                <a href="../4.Redis原理/核心设计/2.redis为什么这么快.html">
            
                    
                    2.redis为什么这么快
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3" data-path="../4.Redis原理/核心设计/3.AOF日志.html">
            
                <a href="../4.Redis原理/核心设计/3.AOF日志.html">
            
                    
                    3.AOF日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.4" data-path="../4.Redis原理/核心设计/4.RDB日志.html">
            
                <a href="../4.Redis原理/核心设计/4.RDB日志.html">
            
                    
                    4.RDB日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.5" data-path="../4.Redis原理/核心设计/5.主从库如何保证一致.html">
            
                <a href="../4.Redis原理/核心设计/5.主从库如何保证一致.html">
            
                    
                    5.主从库如何保证一致
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.6" data-path="../4.Redis原理/核心设计/6.哨兵机制.html">
            
                <a href="../4.Redis原理/核心设计/6.哨兵机制.html">
            
                    
                    6.哨兵机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.7" data-path="../4.Redis原理/核心设计/7.哨兵集群.html">
            
                <a href="../4.Redis原理/核心设计/7.哨兵集群.html">
            
                    
                    7.哨兵集群
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    5.MQ
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" >
            
                <span>
            
                    
                    Kafka
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../5.MQ/kafka/1.kafka.html">
            
                <a href="../5.MQ/kafka/1.kafka.html">
            
                    
                    1.kafka
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../5.MQ/1.mq选型.html">
            
                <a href="../5.MQ/1.mq选型.html">
            
                    
                    1.mq选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../5.MQ/2.如何保证mq的高可用.html">
            
                <a href="../5.MQ/2.如何保证mq的高可用.html">
            
                    
                    2.如何保证mq的高可用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../5.MQ/3.事务性消息.html">
            
                <a href="../5.MQ/3.事务性消息.html">
            
                    
                    3.事务性消息
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    6.Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../6.Spring/1.Spring的Bean的生命周期.html">
            
                <a href="../6.Spring/1.Spring的Bean的生命周期.html">
            
                    
                    1.Spring的Bean的生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../6.Spring/2.Spring的Aop原理.html">
            
                <a href="../6.Spring/2.Spring的Aop原理.html">
            
                    
                    2.Spring的Aop原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../6.Spring/3.三级缓存解决循环依赖.html">
            
                <a href="../6.Spring/3.三级缓存解决循环依赖.html">
            
                    
                    3.三级缓存解决循环依赖
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    7.Netty
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="1.传统IO.html">
            
                <a href="1.传统IO.html">
            
                    
                    1.传统IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="2.Netty实战.html">
            
                <a href="2.Netty实战.html">
            
                    
                    2.Netty实战
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.3" data-path="3.Netty实现rpc.html">
            
                <a href="3.Netty实现rpc.html">
            
                    
                    3.Netty实现rpc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    8.大数据相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" >
            
                <span>
            
                    
                    Flink
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../8.大数据相关/flink/1.docker部署flink.html">
            
                <a href="../8.大数据相关/flink/1.docker部署flink.html">
            
                    
                    1.docker部署flink
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../8.大数据相关/flink/2.运行时架构.html">
            
                <a href="../8.大数据相关/flink/2.运行时架构.html">
            
                    
                    2.运行时架构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" >
            
                <span>
            
                    
                    Hive
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../8.大数据相关/hive/hive基础.html">
            
                <a href="../8.大数据相关/hive/hive基础.html">
            
                    
                    hive基础
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" >
            
                <span>
            
                    
                    实时数仓
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../8.大数据相关/实时数仓/随记1.html">
            
                <a href="../8.大数据相关/实时数仓/随记1.html">
            
                    
                    随记1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    x.问题总结
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../x.问题总结/多线程使用不当OOM排查.html">
            
                <a href="../x.问题总结/多线程使用不当OOM排查.html">
            
                    
                    多线程使用不当OOM排查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../x.问题总结/父子线程公用线程池线上事故.html">
            
                <a href="../x.问题总结/父子线程公用线程池线上事故.html">
            
                    
                    父子线程公用线程池线上事故
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >3.Netty实现rpc</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#google-protobuf"><b>1. </b>Google Protobuf</a></li><ul><li><span class="title-icon "></span><a href="#&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><b>1.1. </b>&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><li><span class="title-icon "></span><a href="#netty-&#x672C;&#x8EAB;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x7684;&#x673A;&#x5236;&#x548C;&#x95EE;&#x9898;&#x5206;&#x6790;"><b>1.2. </b>Netty &#x672C;&#x8EAB;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x7684;&#x673A;&#x5236;&#x548C;&#x95EE;&#x9898;&#x5206;&#x6790;</a></li><li><span class="title-icon "></span><a href="#protobuf"><b>1.3. </b>Protobuf</a></li><li><span class="title-icon "></span><a href="#protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;"><b>1.4. </b>Protobuf &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;</a></li><ul><li><span class="title-icon "></span><a href="#studentproto"><b>1.4.1. </b>Student.proto</a></li><li><span class="title-icon "></span><a href="#nettyserver"><b>1.4.2. </b>NettyServer</a></li><li><span class="title-icon "></span><a href="#nettyserverhandler"><b>1.4.3. </b>NettyServerHandler</a></li><li><span class="title-icon "></span><a href="#nettyclient"><b>1.4.4. </b>NettyClient</a></li><li><span class="title-icon "></span><a href="#nettyclienthandler"><b>1.4.5. </b>NettyClientHandler</a></li></ul><li><span class="title-icon "></span><a href="#protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;-2"><b>1.5. </b>Protobuf &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B; 2</a></li><ul><li><span class="title-icon "></span><a href="#proto"><b>1.5.1. </b>proto</a></li><li><span class="title-icon "></span><a href="#nettyserver_1"><b>1.5.2. </b>NettyServer</a></li><li><span class="title-icon "></span><a href="#nettyserverhandler_1"><b>1.5.3. </b>NettyServerHandler</a></li><li><span class="title-icon "></span><a href="#nettyclient_1"><b>1.5.4. </b>NettyClient</a></li><li><span class="title-icon "></span><a href="#nettyclienthandler_1"><b>1.5.5. </b>NettyClientHandler</a></li></ul></ul><li><span class="title-icon "></span><a href="#netty-&#x7F16;&#x89E3;&#x7801;&#x5668;&#x548C;-handler-&#x8C03;&#x7528;&#x673A;&#x5236;"><b>2. </b>Netty &#x7F16;&#x89E3;&#x7801;&#x5668;&#x548C; Handler &#x8C03;&#x7528;&#x673A;&#x5236;</a></li><ul><li><span class="title-icon "></span><a href="#&#x57FA;&#x672C;&#x8BF4;&#x660E;"><b>2.1. </b>&#x57FA;&#x672C;&#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;"><b>2.2. </b>&#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;</a></li><li><span class="title-icon "></span><a href="#&#x89E3;&#x7801;&#x5668;---bytetomessagedecoder"><b>2.3. </b>&#x89E3;&#x7801;&#x5668; - ByteToMessageDecoder</a></li><li><span class="title-icon "></span><a href="#netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;"><b>2.4. </b>Netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;</a></li><ul><li><span class="title-icon "></span><a href="#myserver"><b>2.4.1. </b>MyServer</a></li><li><span class="title-icon "></span><a href="#myserverinitializer"><b>2.4.2. </b>MyServerInitializer</a></li><li><span class="title-icon "></span><a href="#myserverhandler"><b>2.4.3. </b>MyServerHandler</a></li><li><span class="title-icon "></span><a href="#myclient"><b>2.4.4. </b>MyClient</a></li><li><span class="title-icon "></span><a href="#myclientinitializer"><b>2.4.5. </b>MyClientInitializer</a></li><li><span class="title-icon "></span><a href="#myclienthandler"><b>2.4.6. </b>MyClientHandler</a></li><li><span class="title-icon "></span><a href="#mybytetolongdecoder"><b>2.4.7. </b>MyByteToLongDecoder</a></li><li><span class="title-icon "></span><a href="#mylongtobyteencoder"><b>2.4.8. </b>MyLongToByteEncoder</a></li><li><span class="title-icon "></span><a href="#&#x6548;&#x679C;"><b>2.4.9. </b>&#x6548;&#x679C;</a></li><li><span class="title-icon "></span><a href="#&#x51FA;&#x7AD9;&#x5165;&#x7AD9;"><b>2.4.10. </b>&#x51FA;&#x7AD9;&#x5165;&#x7AD9;</a></li></ul><li><span class="title-icon "></span><a href="#bytetomessagedecoder&#x7684;&#x5C0F;&#x7EC6;&#x8282;"><b>2.5. </b>ByteToMessageDecoder&#x7684;&#x5C0F;&#x7EC6;&#x8282;</a></li><li><span class="title-icon "></span><a href="#&#x89E3;&#x7801;&#x5668;---replayingdecoder"><b>2.6. </b>&#x89E3;&#x7801;&#x5668; - ReplayingDecoder</a></li><li><span class="title-icon "></span><a href="#&#x5176;&#x5B83;&#x7F16;&#x89E3;&#x7801;&#x5668;"><b>2.7. </b>&#x5176;&#x5B83;&#x7F16;&#x89E3;&#x7801;&#x5668;</a></li><li><span class="title-icon "></span><a href="#log4j-&#x6574;&#x5408;&#x5230;-netty"><b>2.8. </b>Log4j &#x6574;&#x5408;&#x5230; Netty</a></li></ul><li><span class="title-icon "></span><a href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><b>3. </b>TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;</a></li><ul><li><span class="title-icon "></span><a href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><b>3.1. </b>TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><li><span class="title-icon "></span><a href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#x5B9E;&#x4F8B;"><b>3.2. </b>TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#x5B9E;&#x4F8B;</a></li><ul><li><span class="title-icon "></span><a href="#myserver_1"><b>3.2.1. </b>MyServer</a></li><li><span class="title-icon "></span><a href="#myserverinitializer_1"><b>3.2.2. </b>MyServerInitializer</a></li><li><span class="title-icon "></span><a href="#myserverhandler_1"><b>3.2.3. </b>MyServerHandler</a></li><li><span class="title-icon "></span><a href="#myclient_1"><b>3.2.4. </b>MyClient</a></li><li><span class="title-icon "></span><a href="#myclientinitializer_1"><b>3.2.5. </b>MyClientInitializer</a></li><li><span class="title-icon "></span><a href="#myclienthandler_1"><b>3.2.6. </b>MyClientHandler</a></li><li><span class="title-icon "></span><a href="#&#x6548;&#x679C;_1"><b>3.2.7. </b>&#x6548;&#x679C;</a></li></ul><li><span class="title-icon "></span><a href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><b>3.3. </b>TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x89E3;&#x51B3;&#x65B9;&#x6848;</a></li><ul><li><span class="title-icon "></span><a href="#messageprotocol"><b>3.3.1. </b>MessageProtocol</a></li><li><span class="title-icon "></span><a href="#myserver_2"><b>3.3.2. </b>MyServer</a></li><li><span class="title-icon "></span><a href="#myserverinitializer_2"><b>3.3.3. </b>MyServerInitializer</a></li><li><span class="title-icon "></span><a href="#myserverhandler_2"><b>3.3.4. </b>MyServerHandler</a></li><li><span class="title-icon "></span><a href="#myclient_2"><b>3.3.5. </b>MyClient</a></li><li><span class="title-icon "></span><a href="#myclientinitializer_2"><b>3.3.6. </b>MyClientInitializer</a></li><li><span class="title-icon "></span><a href="#myclienthandler_2"><b>3.3.7. </b>MyClientHandler</a></li><li><span class="title-icon "></span><a href="#mymessagedecoder"><b>3.3.8. </b>MyMessageDecoder</a></li><li><span class="title-icon "></span><a href="#mymessageencoder"><b>3.3.9. </b>MyMessageEncoder</a></li><li><span class="title-icon "></span><a href="#&#x6548;&#x679C;_2"><b>3.3.10. </b>&#x6548;&#x679C;</a></li></ul></ul><li><span class="title-icon "></span><a href="#&#x7528;-netty-&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;rpc"><b>4. </b>&#x7528; Netty &#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;RPC</a></li><ul><li><span class="title-icon "></span><a href="#rpc-&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><b>4.1. </b>RPC &#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><li><span class="title-icon "></span><a href="#&#x6211;&#x4EEC;&#x7684;rpc-&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x56FE;"><b>4.2. </b>&#x6211;&#x4EEC;&#x7684;RPC &#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#&#x5DF1;&#x5B9E;&#x73B0;-dubbo-rpc&#xFF08;&#x57FA;&#x4E8E;-netty&#xFF09;"><b>4.3. </b>&#x5DF1;&#x5B9E;&#x73B0; Dubbo RPC&#xFF08;&#x57FA;&#x4E8E; Netty&#xFF09;</a></li><ul><li><span class="title-icon "></span><a href="#&#x9700;&#x6C42;&#x8BF4;&#x660E;"><b>4.3.1. </b>&#x9700;&#x6C42;&#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x8BBE;&#x8BA1;&#x8BF4;&#x660E;"><b>4.3.2. </b>&#x8BBE;&#x8BA1;&#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x4EE3;&#x7801;"><b>4.3.3. </b>&#x4EE3;&#x7801;</a></li><li><span class="title-icon "></span><a href="#&#x8C03;&#x7528;&#x8FC7;&#x7A0B;"><b>4.3.4. </b>&#x8C03;&#x7528;&#x8FC7;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x6548;&#x679C;_3"><b>4.3.5. </b>&#x6548;&#x679C;</a></li></ul></ul></ul></div><a href="#google-protobuf" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="google-protobuf"><a name="google-protobuf" class="anchor-navigation-ex-anchor" href="#google-protobuf"><i class="fa fa-link" aria-hidden="true"></i></a>1. Google Protobuf</h1>
<h2 id="&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><a name="&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</h2>
<ol>
<li>&#x7F16;&#x5199;&#x7F51;&#x7EDC;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5728;&#x7F51;&#x7EDC;&#x4E2D;&#x4F20;&#x8F93;&#x7684;&#x90FD;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x5B57;&#x8282;&#x7801;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x53D1;&#x9001;&#x6570;&#x636E;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x7F16;&#x7801;&#xFF0C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x89E3;&#x7801;[&#x793A;&#x610F;&#x56FE;]</li>
<li><code>codec</code>&#xFF08;&#x7F16;&#x89E3;&#x7801;&#x5668;&#xFF09;&#x7684;&#x7EC4;&#x6210;&#x90E8;&#x5206;&#x6709;&#x4E24;&#x4E2A;&#xFF1A;<code>decoder</code>&#xFF08;&#x89E3;&#x7801;&#x5668;&#xFF09;&#x548C; <code>encoder</code>&#xFF08;&#x7F16;&#x7801;&#x5668;&#xFF09;&#x3002;<code>encoder</code> &#x8D1F;&#x8D23;&#x628A;&#x4E1A;&#x52A1;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x8282;&#x7801;&#x6570;&#x636E;&#xFF0C;<code>decoder</code> &#x8D1F;&#x8D23;&#x628A;&#x5B57;&#x8282;&#x7801;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x6210;&#x4E1A;&#x52A1;&#x6570;&#x636E;</li>
</ol>
<p><img src="../img/n1.png" alt=""></p>
<h2 id="netty-&#x672C;&#x8EAB;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x7684;&#x673A;&#x5236;&#x548C;&#x95EE;&#x9898;&#x5206;&#x6790;"><a name="netty-&#x672C;&#x8EAB;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x7684;&#x673A;&#x5236;&#x548C;&#x95EE;&#x9898;&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#netty-&#x672C;&#x8EAB;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x7684;&#x673A;&#x5236;&#x548C;&#x95EE;&#x9898;&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. Netty &#x672C;&#x8EAB;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x7684;&#x673A;&#x5236;&#x548C;&#x95EE;&#x9898;&#x5206;&#x6790;</h2>
<ol>
<li><code>Netty</code> &#x81EA;&#x8EAB;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B; <code>codec</code>(&#x7F16;&#x89E3;&#x7801;&#x5668;)</li>
<li><code>Netty</code> &#x63D0;&#x4F9B;&#x7684;&#x7F16;&#x7801;&#x5668; <ul>
<li><code>StringEncoder</code>&#xFF1A;&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x3002;</li>
<li><code>ObjectEncoder</code>&#xFF1A;&#x5BF9;Java&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x3002;</li>
</ul>
</li>
<li><code>Netty</code> &#x63D0;&#x4F9B;&#x7684;&#x89E3;&#x7801;&#x5668; <ul>
<li><code>StringDecoder</code>,&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x89E3;&#x7801; </li>
<li><code>ObjectDecoder</code>&#xFF0C;&#x5BF9; Java &#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x89E3;&#x7801;</li>
</ul>
</li>
<li><code>Netty</code> &#x672C;&#x8EAB;&#x81EA;&#x5E26;&#x7684; <code>ObjectDecoder</code> &#x548C; <code>ObjectEncoder</code> &#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5B9E;&#x73B0; <code>POJO</code> &#x5BF9;&#x8C61;&#x6216;&#x5404;&#x79CD;&#x4E1A;&#x52A1;&#x5BF9;&#x8C61;&#x7684;&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#xFF0C;&#x5E95;&#x5C42;&#x4F7F;&#x7528;&#x7684;&#x4ECD;&#x662F;Java&#x5E8F;&#x5217;&#x5316;&#x6280;&#x672F;,&#x800C;Java&#x5E8F;&#x5217;&#x5316;&#x6280;&#x672F;&#x672C;&#x8EAB;&#x6548;&#x7387;&#x5C31;&#x4E0D;&#x9AD8;&#xFF0C;&#x5B58;&#x5728;&#x5982;&#x4E0B;&#x95EE;&#x9898;<ul>
<li>&#x65E0;&#x6CD5;&#x8DE8;&#x8BED;&#x8A00;</li>
<li>&#x5E8F;&#x5217;&#x5316;&#x540E;&#x7684;&#x4F53;&#x79EF;&#x592A;&#x5927;&#xFF0C;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x7F16;&#x7801;&#x7684;5&#x500D;&#x591A;&#x3002;</li>
<li>&#x5E8F;&#x5217;&#x5316;&#x6027;&#x80FD;&#x592A;&#x4F4E;</li>
</ul>
</li>
<li>&#x5F15;&#x51FA;&#x65B0;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;[<code>Google</code> &#x7684; <code>Protobuf</code>]</li>
</ol>
<h2 id="protobuf"><a name="protobuf" class="anchor-navigation-ex-anchor" href="#protobuf"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Protobuf</h2>
<ol>
<li><code>Protobuf</code> &#x57FA;&#x672C;&#x4ECB;&#x7ECD;&#x548C;&#x4F7F;&#x7528;&#x793A;&#x610F;&#x56FE;</li>
<li><code>Protobuf</code> &#x662F; <code>Google</code> &#x53D1;&#x5E03;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x5168;&#x79F0; <code>Google Protocol Buffers</code>&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x8F7B;&#x4FBF;&#x9AD8;&#x6548;&#x7684;&#x7ED3;&#x6784;&#x5316;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x7ED3;&#x6784;&#x5316;&#x6570;&#x636E;&#x4E32;&#x884C;&#x5316;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5E8F;&#x5217;&#x5316;&#x3002;&#x5B83;&#x5F88;&#x9002;&#x5408;&#x505A;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x6216; <code>RPC</code> [&#x8FDC;&#x7A0B;&#x8FC7;&#x7A0B;&#x8C03;&#x7528; <code>remote procedure call</code> ]&#x6570;&#x636E;&#x4EA4;&#x6362;&#x683C;&#x5F0F;&#x3002;&#x76EE;&#x524D;&#x5F88;&#x591A;&#x516C;&#x53F8; &#x4ECE;<code>http + json &#x8F6C;&#x5411;tcp + protobuf</code>&#xFF0C;&#x6548;&#x7387;&#x4F1A;&#x66F4;&#x9AD8;&#x3002;</li>
<li>&#x53C2;&#x8003;&#x6587;&#x6863;&#xFF1A;<a href="https://developers.google.com/protocol-buffers/docs/proto" target="_blank">https://developers.google.com/protocol-buffers/docs/proto</a> &#x8BED;&#x8A00;&#x6307;&#x5357;</li>
<li><code>Protobuf</code> &#x662F;&#x4EE5; <code>message</code> &#x7684;&#x65B9;&#x5F0F;&#x6765;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x7684;.</li>
<li>&#x652F;&#x6301;&#x8DE8;&#x5E73;&#x53F0;&#x3001;&#x8DE8;&#x8BED;&#x8A00;&#xFF0C;&#x5373;[&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x53EF;&#x4EE5;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x7684;]&#xFF08;&#x652F;&#x6301;&#x76EE;&#x524D;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x8BED;&#x8A00;&#xFF0C;&#x4F8B;&#x5982; <code>C++</code>&#x3001;<code>C#</code>&#x3001;<code>Java</code>&#x3001;<code>python</code> &#x7B49;&#xFF09;</li>
<li>&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x9AD8;&#x53EF;&#x9760;&#x6027;</li>
<li>&#x4F7F;&#x7528; <code>protobuf</code> &#x7F16;&#x8BD1;&#x5668;&#x80FD;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4EE3;&#x7801;&#xFF0C;<code>Protobuf</code> &#x662F;&#x5C06;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;&#x4F7F;&#x7528; <code>.proto</code> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x63CF;&#x8FF0;&#x3002;&#x8BF4;&#x660E;&#xFF0C;&#x5728; <code>idea</code> &#x4E2D;&#x7F16;&#x5199; <code>.proto</code> &#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x63D0;&#x793A;&#x662F;&#x5426;&#x4E0B;&#x8F7D; <code>.ptoto</code> &#x7F16;&#x5199;&#x63D2;&#x4EF6;.&#x53EF;&#x4EE5;&#x8BA9;&#x8BED;&#x6CD5;&#x9AD8;&#x4EAE;&#x3002;</li>
<li>&#x7136;&#x540E;&#x901A;&#x8FC7; <code>protoc.exe</code> &#x7F16;&#x8BD1;&#x5668;&#x6839;&#x636E; <code>.proto</code> &#x81EA;&#x52A8;&#x751F;&#x6210; <code>.java</code> &#x6587;&#x4EF6;</li>
<li><code>protobuf</code> &#x4F7F;&#x7528;&#x793A;&#x610F;&#x56FE;</li>
</ol>
<p><img src="../img/n2.png" alt=""></p>
<h2 id="protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;"><a name="protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4. Protobuf &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;</h2>
<p>&#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F7F;&#x7528; <code>Protobuf</code> &#x5B8C;&#x6210;&#x5982;&#x4E0B;&#x529F;&#x80FD;</p>
<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x4E00;&#x4E2A; <code>StudentPoJo</code> &#x5BF9;&#x8C61;&#x5230;&#x670D;&#x52A1;&#x5668;(&#x901A;&#x8FC7; <code>Protobuf</code> &#x7F16;&#x7801;)</li>
<li>&#x670D;&#x52A1;&#x7AEF;&#x80FD;&#x63A5;&#x6536; <code>StudentPoJo</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x663E;&#x793A;&#x4FE1;&#x606F;(&#x901A;&#x8FC7; <code>Protobuf</code> &#x89E3;&#x7801;)</li>
</ol>
<pre class="language-"><code class="lang-maven">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.protobuf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>protobuf-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="studentproto"><a name="studentproto" class="anchor-navigation-ex-anchor" href="#studentproto"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.1. Student.proto</h3>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span> <span class="token comment">//&#x7248;&#x672C;</span>
<span class="token keyword">option</span> java_outer_classname <span class="token operator">=</span> <span class="token string">&quot;StudentPOJO&quot;</span><span class="token punctuation">;</span><span class="token comment">//&#x751F;&#x6210;&#x7684;&#x5916;&#x90E8;&#x7C7B;&#x540D;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x6587;&#x4EF6;&#x540D;</span>
<span class="token comment">//protobuf &#x4F7F;&#x7528;message &#x7BA1;&#x7406;&#x6570;&#x636E;</span>
<span class="token keyword">message</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span> <span class="token comment">//&#x4F1A;&#x5728; StudentPOJO &#x5916;&#x90E8;&#x7C7B;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x7C7B; Student&#xFF0C; &#x4ED6;&#x662F;&#x771F;&#x6B63;&#x53D1;&#x9001;&#x7684;POJO&#x5BF9;&#x8C61;</span>
    <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Student &#x7C7B;&#x4E2D;&#x6709; &#x4E00;&#x4E2A;&#x5C5E;&#x6027; &#x540D;&#x5B57;&#x4E3A; id &#x7C7B;&#x578B;&#x4E3A;int32(protobuf&#x7C7B;&#x578B;) 1&#x8868;&#x793A;&#x5C5E;&#x6027;&#x5E8F;&#x53F7;&#xFF0C;&#x4E0D;&#x662F;&#x503C;</span>
    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7F16;&#x8BD1;
protoc.exe --java_out=.Student.proto
&#x5C06;&#x751F;&#x6210;&#x7684; StudentPOJO &#x653E;&#x5165;&#x5230;&#x9879;&#x76EE;&#x4F7F;&#x7528;</p>
<p><img src="../img/n3.png" alt=""></p>
<p>&#x751F;&#x6210;&#x7684;StudentPOJO&#x4EE3;&#x7801;&#x592A;&#x957F;&#x5C31;&#x4E0D;&#x8D34;&#x5728;&#x8FD9;&#x91CC;&#x4E86;</p>
<h3 id="nettyserver"><a name="nettyserver" class="anchor-navigation-ex-anchor" href="#nettyserver"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.2. NettyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span></span><span class="token class-name">ProtobufDecoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>


        <span class="token comment">//&#x521B;&#x5EFA;BossGroup &#x548C; WorkerGroup</span>
        <span class="token comment">//&#x8BF4;&#x660E;</span>
        <span class="token comment">//1. &#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4; bossGroup &#x548C; workerGroup</span>
        <span class="token comment">//2. bossGroup &#x53EA;&#x662F;&#x5904;&#x7406;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42; , &#x771F;&#x6B63;&#x7684;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#xFF0C;&#x4F1A;&#x4EA4;&#x7ED9; workerGroup&#x5B8C;&#x6210;</span>
        <span class="token comment">//3. &#x4E24;&#x4E2A;&#x90FD;&#x662F;&#x65E0;&#x9650;&#x5FAA;&#x73AF;</span>
        <span class="token comment">//4. bossGroup &#x548C; workerGroup &#x542B;&#x6709;&#x7684;&#x5B50;&#x7EBF;&#x7A0B;(NioEventLoop)&#x7684;&#x4E2A;&#x6570;</span>
        <span class="token comment">//   &#x9ED8;&#x8BA4;&#x5B9E;&#x9645; cpu&#x6838;&#x6570; * 2</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8</span>



        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x542F;&#x52A8;&#x5BF9;&#x8C61;&#xFF0C;&#x914D;&#x7F6E;&#x53C2;&#x6570;</span>
            <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x4F7F;&#x7528;&#x94FE;&#x5F0F;&#x7F16;&#x7A0B;&#x6765;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4;</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//&#x4F7F;&#x7528;NioSocketChannel &#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_BACKLOG<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x961F;&#x5217;&#x5F97;&#x5230;&#x8FDE;&#x63A5;&#x4E2A;&#x6570;</span>
                    <span class="token punctuation">.</span><span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_KEEPALIVE<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x4FDD;&#x6301;&#x6D3B;&#x52A8;&#x8FDE;&#x63A5;&#x72B6;&#x6001;</span>
<span class="token comment">//                    .handler(null) // &#x8BE5; handler&#x5BF9;&#x5E94; bossGroup , childHandler &#x5BF9;&#x5E94; workerGroup</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x901A;&#x9053;&#x521D;&#x59CB;&#x5316;&#x5BF9;&#x8C61;(&#x533F;&#x540D;&#x5BF9;&#x8C61;)</span>
                        <span class="token comment">//&#x7ED9;pipeline &#x8BBE;&#x7F6E;&#x5904;&#x7406;&#x5668;</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>


                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x5728;pipeline&#x52A0;&#x5165;ProtoBufDecoder</span>
                            <span class="token comment">//&#x6307;&#x5B9A;&#x5BF9;&#x54EA;&#x79CD;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x89E3;&#x7801;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;decoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProtobufDecoder</span><span class="token punctuation">(</span><span class="token class-name">StudentPOJO<span class="token punctuation">.</span>Student</span><span class="token punctuation">.</span><span class="token function">getDefaultInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x7ED9;&#x6211;&#x4EEC;&#x7684;workerGroup &#x7684; EventLoop &#x5BF9;&#x5E94;&#x7684;&#x7BA1;&#x9053;&#x8BBE;&#x7F6E;&#x5904;&#x7406;&#x5668;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;.....&#x670D;&#x52A1;&#x5668; is ready...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x5E76;&#x4E14;&#x540C;&#x6B65;, &#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A; ChannelFuture &#x5BF9;&#x8C61;</span>
            <span class="token comment">//&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;(&#x5E76;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;)</span>
            <span class="token class-name">ChannelFuture</span> cf <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x7ED9;cf &#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x76D1;&#x63A7;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#x4E8B;&#x4EF6;</span>

            cf<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cf<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3; 6668 &#x6210;&#x529F;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3; 6668 &#x5931;&#x8D25;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">//&#x5BF9;&#x5173;&#x95ED;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x76D1;&#x542C;</span>
            cf<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyserverhandler"><a name="nettyserverhandler" class="anchor-navigation-ex-anchor" href="#nettyserverhandler"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.3. NettyServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token comment">/*
&#x8BF4;&#x660E;
1. &#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Handler &#x9700;&#x8981;&#x7EE7;&#x7EED;netty &#x89C4;&#x5B9A;&#x597D;&#x7684;&#x67D0;&#x4E2A;HandlerAdapter(&#x89C4;&#x8303;)
2. &#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Handler , &#x624D;&#x80FD;&#x79F0;&#x4E3A;&#x4E00;&#x4E2A;handler
 */</span>
<span class="token comment">//public class NettyServerHandler extends ChannelInboundHandlerAdapter {</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentPOJO<span class="token punctuation">.</span>Student</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>


    <span class="token comment">//&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5B9E;&#x9645;(&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;)</span>
    <span class="token comment">/*
    1. ChannelHandlerContext ctx:&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;, &#x542B;&#x6709; &#x7BA1;&#x9053;pipeline , &#x901A;&#x9053;channel, &#x5730;&#x5740;
    2. Object msg: &#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E; &#x9ED8;&#x8BA4;Object
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">StudentPOJO<span class="token punctuation">.</span>Student</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x8BFB;&#x53D6;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;StudentPojo.Student</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E; id=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x540D;&#x5B57;=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//writeAndFlush &#x662F; write + flush</span>
        <span class="token comment">//&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x5237;&#x65B0;</span>
        <span class="token comment">//&#x4E00;&#x822C;&#x8BB2;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5904;&#x7406;&#x5F02;&#x5E38;, &#x4E00;&#x822C;&#x662F;&#x9700;&#x8981;&#x5173;&#x95ED;&#x901A;&#x9053;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyclient"><a name="nettyclient" class="anchor-navigation-ex-anchor" href="#nettyclient"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.4. NettyClient</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span></span><span class="token class-name">ProtobufEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7EC4;</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x5BF9;&#x8C61;</span>
            <span class="token comment">//&#x6CE8;&#x610F;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x7684;&#x4E0D;&#x662F; ServerBootstrap &#x800C;&#x662F; Bootstrap</span>
            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x8BBE;&#x7F6E;&#x76F8;&#x5173;&#x53C2;&#x6570;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x7EC4;</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x9053;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;(&#x53CD;&#x5C04;)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x5728;pipeline&#x4E2D;&#x52A0;&#x5165; ProtoBufEncoder</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;encoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProtobufEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x52A0;&#x5165;&#x81EA;&#x5DF1;&#x7684;&#x5904;&#x7406;&#x5668;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF; ok..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x542F;&#x52A8;&#x5BA2;&#x6237;&#x7AEF;&#x53BB;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x7AEF;</span>
            <span class="token comment">//&#x5173;&#x4E8E; ChannelFuture &#x8981;&#x5206;&#x6790;&#xFF0C;&#x6D89;&#x53CA;&#x5230;netty&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x578B;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x7ED9;&#x5173;&#x95ED;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x76D1;&#x542C;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>

            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyclienthandler"><a name="nettyclienthandler" class="anchor-navigation-ex-anchor" href="#nettyclienthandler"><i class="fa fa-link" aria-hidden="true"></i></a>1.4.5. NettyClientHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x5F53;&#x901A;&#x9053;&#x5C31;&#x7EEA;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;&#x65B9;&#x6CD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x53D1;&#x751F;&#x4E00;&#x4E2A;Student &#x5BF9;&#x8C61;&#x5230;&#x670D;&#x52A1;&#x5668;</span>

        <span class="token class-name">StudentPOJO<span class="token punctuation">.</span>Student</span> student <span class="token operator">=</span> <span class="token class-name">StudentPOJO<span class="token punctuation">.</span>Student</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;&#x667A;&#x591A;&#x661F; &#x5434;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Teacher , Member ,Message</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5F53;&#x901A;&#x9053;&#x6709;&#x8BFB;&#x53D6;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x56DE;&#x590D;&#x7684;&#x6D88;&#x606F;:&quot;</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&#xFF1A; &quot;</span><span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;-2"><a name="protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;-2" class="anchor-navigation-ex-anchor" href="#protobuf-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;-2"><i class="fa fa-link" aria-hidden="true"></i></a>1.5. Protobuf &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B; 2</h2>
<ol>
<li>&#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F7F;&#x7528; <code>Protobuf</code> &#x5B8C;&#x6210;&#x5982;&#x4E0B;&#x529F;&#x80FD;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x968F;&#x673A;&#x53D1;&#x9001; <code>StudentPoJo</code> / <code>WorkerPoJo</code> &#x5BF9;&#x8C61;&#x5230;&#x670D;&#x52A1;&#x5668;(&#x901A;&#x8FC7; <code>Protobuf</code> &#x7F16;&#x7801;)</li>
<li>&#x670D;&#x52A1;&#x7AEF;&#x80FD;&#x63A5;&#x6536; <code>StudentPoJo</code> / <code>WorkerPoJo</code> &#x5BF9;&#x8C61;(&#x9700;&#x8981;&#x5224;&#x65AD;&#x662F;&#x54EA;&#x79CD;&#x7C7B;&#x578B;)&#xFF0C;&#x5E76;&#x663E;&#x793A;&#x4FE1;&#x606F;(&#x901A;&#x8FC7; <code>Protobuf</code> &#x89E3;&#x7801;)</li>
</ol>
<h3 id="proto"><a name="proto" class="anchor-navigation-ex-anchor" href="#proto"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.1. proto</h3>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">option</span> optimize_for <span class="token operator">=</span> SPEED<span class="token punctuation">;</span> <span class="token comment">// &#x52A0;&#x5FEB;&#x89E3;&#x6790;</span>
<span class="token keyword">option</span> java_package<span class="token operator">=</span><span class="token string">&quot;com.atguigu.netty.codec2&quot;</span><span class="token punctuation">;</span>   <span class="token comment">//&#x6307;&#x5B9A;&#x751F;&#x6210;&#x5230;&#x54EA;&#x4E2A;&#x5305;&#x4E0B;</span>
<span class="token keyword">option</span> java_outer_classname<span class="token operator">=</span><span class="token string">&quot;MyDataInfo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// &#x5916;&#x90E8;&#x7C7B;&#x540D;, &#x6587;&#x4EF6;&#x540D;</span>


<span class="token comment">/*
1.protobuf &#x53EF;&#x4EE5;&#x4F7F;&#x7528;message &#x7BA1;&#x7406;&#x5176;&#x4ED6;&#x7684;message&#x3002;&#x6700;&#x7EC8;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x4E2A;message&#x4F5C;&#x4E3A;&#x4F20;&#x8F93;&#x5BF9;&#x8C61;
2.&#x5047;&#x8BBE;&#x4F60;&#x67D0;&#x4E2A;&#x9879;&#x76EE;&#x9700;&#x8981;&#x4F20;&#x8F93;20&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x4F60;&#x4E0D;&#x53EF;&#x80FD;&#x65B0;&#x5EFA;20&#x4E2A;proto&#x6587;&#x4EF6;&#x5427;&#x3002;&#x6B64;&#x65F6;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;
&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x91CC;&#x5B9A;&#x4E49;20&#x4E2A;message&#xFF0C;&#x6700;&#x540E;&#x518D;&#x7528;&#x4E00;&#x4E2A;&#x603B;&#x7684;message&#xFF08;&#x6BD4;&#x65B9;&#x8BF4;&#x8FD9;&#x91CC;&#x7684;MyMessage&#xFF09;
&#x6765;&#x51B3;&#x5B9A;&#x5728;&#x5B9E;&#x9645;&#x4F20;&#x8F93;&#x65F6;&#x771F;&#x6B63;&#x9700;&#x8981;&#x4F20;&#x8F93;&#x54EA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;
3.&#x56E0;&#x4E3A;&#x4F60;&#x5B9E;&#x9645;&#x4F20;&#x8F93;&#x7684;&#x65F6;&#x5019;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4F20;&#x8F93;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x7528;oneof&#x8FDB;&#x884C;&#x4E86;&#x9650;&#x5236;
4.&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x4F20;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x5462;&#xFF1F;&#x6211;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;map(&#x76EE;&#x524D;&#x6211;&#x4E5F;&#x4E0D;&#x592A;&#x4E86;&#x89E3;proto&#x7684;&#x8BED;&#x6CD5;)
 */</span>
<span class="token keyword">message</span> <span class="token class-name">MyMessage</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x679A;&#x4E3E;&#x7C7B;&#x578B;,DataType&#x5982;&#x679C;&#x662F;0&#x5219;&#x8868;&#x793A;&#x4E00;&#x4E2A;Student&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#xFF0C;DataType&#x8FD9;&#x4E2A;&#x540D;&#x79F0;&#x81EA;&#x5B9A;&#x4E49;</span>
    <span class="token keyword">enum</span> <span class="token class-name">DataType</span> <span class="token punctuation">{</span>
        StudentType <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//&#x5728;proto3 &#x8981;&#x6C42;enum&#x7684;&#x7F16;&#x53F7;&#x4ECE;0&#x5F00;&#x59CB;</span>
        WorkerType <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x7528;data_type &#x6765;&#x6807;&#x8BC6;&#x4F20;&#x7684;&#x662F;&#x54EA;&#x4E00;&#x4E2A;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x91CC;&#x624D;&#x771F;&#x6B63;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;MyMessage&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;</span>
    <span class="token positional-class-name class-name">DataType</span> data_type <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//&#x6240;&#x6709;&#x540E;&#x9762;&#x7684;&#x6570;&#x5B57;&#x90FD;&#x53EA;&#x662F;&#x7F16;&#x53F7;&#x800C;&#x5DF2;</span>

    <span class="token comment">/*
    1.oneof&#x5173;&#x952E;&#x5B57; &#x8868;&#x793A;&#x6BCF;&#x6B21;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x4F20;&#x8F93;&#x65F6;&#xFF0C;&#x9650;&#x5236;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x4F20;&#x8F93;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;
    dataBody&#x540D;&#x79F0;&#x4E5F;&#x662F;&#x81EA;&#x5B9A;&#x4E49;&#x7684;
    2.&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x91CC;&#x7684;&#x5E8F;&#x53F7;&#x662F;2&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x4E0A;&#x9762;DataType data_type = 1  &#x5360;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x5E8F;&#x53F7;&#x4E86;
    3.MyMessage&#x91CC;&#x771F;&#x6B63;&#x51FA;&#x73B0;&#x7684;&#x7C7B;&#x578B;&#x53EA;&#x6709;&#x4E24;&#x4E2A;
      &#x2460;DataType&#x7C7B;&#x578B;
      &#x2461;Student&#x7C7B;&#x578B;&#x6216;&#x8005;Worker&#x7C7B;&#x578B;&#xFF08;&#x8FD9;&#x4E24;&#x4E2A;&#x5728;&#x771F;&#x6B63;&#x4F20;&#x8F93;&#x7684;&#x65F6;&#x5019;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x51FA;&#x73B0;&#xFF09;
    */</span>
    <span class="token keyword">oneof</span> dataBody <span class="token punctuation">{</span>
        <span class="token positional-class-name class-name">Student</span> student <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">//&#x6CE8;&#x610F;&#x8FD9;&#x540E;&#x9762;&#x7684;&#x6570;&#x5B57;&#x4E5F;&#x90FD;&#x53EA;&#x662F;&#x7F16;&#x53F7;&#x800C;&#x5DF2;</span>
        <span class="token positional-class-name class-name">Worker</span> worker <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


<span class="token keyword">message</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>
    <span class="token builtin">int32</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//Student&#x7C7B;&#x7684;&#x5C5E;&#x6027;</span>
    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//</span>
<span class="token punctuation">}</span>
<span class="token keyword">message</span> <span class="token class-name">Worker</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> name<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span> age<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyserver_1"><a name="nettyserver_1" class="anchor-navigation-ex-anchor" href="#nettyserver_1"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.2. NettyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec2</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">StudentPOJO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span></span><span class="token class-name">ProtobufDecoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>


        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8</span>



        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x542F;&#x52A8;&#x5BF9;&#x8C61;&#xFF0C;&#x914D;&#x7F6E;&#x53C2;&#x6570;</span>
            <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x4F7F;&#x7528;&#x94FE;&#x5F0F;&#x7F16;&#x7A0B;&#x6765;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4;</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//&#x4F7F;&#x7528;NioSocketChannel &#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_BACKLOG<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x961F;&#x5217;&#x5F97;&#x5230;&#x8FDE;&#x63A5;&#x4E2A;&#x6570;</span>
                    <span class="token punctuation">.</span><span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_KEEPALIVE<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x4FDD;&#x6301;&#x6D3B;&#x52A8;&#x8FDE;&#x63A5;&#x72B6;&#x6001;</span>
<span class="token comment">//                    .handler(null) // &#x8BE5; handler&#x5BF9;&#x5E94; bossGroup , childHandler &#x5BF9;&#x5E94; workerGroup</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x901A;&#x9053;&#x521D;&#x59CB;&#x5316;&#x5BF9;&#x8C61;(&#x533F;&#x540D;&#x5BF9;&#x8C61;)</span>
                        <span class="token comment">//&#x7ED9;pipeline &#x8BBE;&#x7F6E;&#x5904;&#x7406;&#x5668;</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>


                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x5728;pipeline&#x52A0;&#x5165;ProtoBufDecoder</span>
                            <span class="token comment">//&#x6307;&#x5B9A;&#x5BF9;&#x54EA;&#x79CD;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x89E3;&#x7801;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;decoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProtobufDecoder</span><span class="token punctuation">(</span><span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage</span><span class="token punctuation">.</span><span class="token function">getDefaultInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x7ED9;&#x6211;&#x4EEC;&#x7684;workerGroup &#x7684; EventLoop &#x5BF9;&#x5E94;&#x7684;&#x7BA1;&#x9053;&#x8BBE;&#x7F6E;&#x5904;&#x7406;&#x5668;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;.....&#x670D;&#x52A1;&#x5668; is ready...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x5E76;&#x4E14;&#x540C;&#x6B65;, &#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A; ChannelFuture &#x5BF9;&#x8C61;</span>
            <span class="token comment">//&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;(&#x5E76;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;)</span>
            <span class="token class-name">ChannelFuture</span> cf <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x7ED9;cf &#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x76D1;&#x63A7;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#x4E8B;&#x4EF6;</span>

            cf<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cf<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3; 6668 &#x6210;&#x529F;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3; 6668 &#x5931;&#x8D25;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">//&#x5BF9;&#x5173;&#x95ED;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x76D1;&#x542C;</span>
            cf<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyserverhandler_1"><a name="nettyserverhandler_1" class="anchor-navigation-ex-anchor" href="#nettyserverhandler_1"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.3. NettyServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec2</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">StudentPOJO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>


<span class="token comment">//public class NettyServerHandler extends ChannelInboundHandlerAdapter {</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>


    <span class="token comment">//&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5B9E;&#x9645;(&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;)</span>
    <span class="token comment">/*
    1. ChannelHandlerContext ctx:&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;, &#x542B;&#x6709; &#x7BA1;&#x9053;pipeline , &#x901A;&#x9053;channel, &#x5730;&#x5740;
    2. Object msg: &#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E; &#x9ED8;&#x8BA4;Object
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x6839;&#x636E;dataType &#x6765;&#x663E;&#x793A;&#x4E0D;&#x540C;&#x7684;&#x4FE1;&#x606F;</span>

        <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage<span class="token punctuation">.</span>DataType</span> dataType <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getDataType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dataType <span class="token operator">==</span> <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage<span class="token punctuation">.</span>DataType<span class="token punctuation">.</span>StudentType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>Student</span> student <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5B66;&#x751F;id=&quot;</span> <span class="token operator">+</span> student<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x5B66;&#x751F;&#x540D;&#x5B57;=&quot;</span> <span class="token operator">+</span> student<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dataType <span class="token operator">==</span> <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage<span class="token punctuation">.</span>DataType<span class="token punctuation">.</span>WorkerType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>Worker</span> worker <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5DE5;&#x4EBA;&#x7684;&#x540D;&#x5B57;=&quot;</span> <span class="token operator">+</span> worker<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x5E74;&#x9F84;=&quot;</span> <span class="token operator">+</span> worker<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4F20;&#x8F93;&#x7684;&#x7C7B;&#x578B;&#x4E0D;&#x6B63;&#x786E;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>


    <span class="token comment">//&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//writeAndFlush &#x662F; write + flush</span>
        <span class="token comment">//&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x5237;&#x65B0;</span>
        <span class="token comment">//&#x4E00;&#x822C;&#x8BB2;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5904;&#x7406;&#x5F02;&#x5E38;, &#x4E00;&#x822C;&#x662F;&#x9700;&#x8981;&#x5173;&#x95ED;&#x901A;&#x9053;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyclient_1"><a name="nettyclient_1" class="anchor-navigation-ex-anchor" href="#nettyclient_1"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.4. NettyClient</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec2</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span></span><span class="token class-name">ProtobufEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7EC4;</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x5BF9;&#x8C61;</span>
            <span class="token comment">//&#x6CE8;&#x610F;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x7684;&#x4E0D;&#x662F; ServerBootstrap &#x800C;&#x662F; Bootstrap</span>
            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x8BBE;&#x7F6E;&#x76F8;&#x5173;&#x53C2;&#x6570;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x7EC4;</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x9053;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;(&#x53CD;&#x5C04;)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x5728;pipeline&#x4E2D;&#x52A0;&#x5165; ProtoBufEncoder</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;encoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProtobufEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x52A0;&#x5165;&#x81EA;&#x5DF1;&#x7684;&#x5904;&#x7406;&#x5668;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF; ok..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x542F;&#x52A8;&#x5BA2;&#x6237;&#x7AEF;&#x53BB;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x7AEF;</span>
            <span class="token comment">//&#x5173;&#x4E8E; ChannelFuture &#x8981;&#x5206;&#x6790;&#xFF0C;&#x6D89;&#x53CA;&#x5230;netty&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x578B;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x7ED9;&#x5173;&#x95ED;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x76D1;&#x542C;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>

            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="nettyclienthandler_1"><a name="nettyclienthandler_1" class="anchor-navigation-ex-anchor" href="#nettyclienthandler_1"><i class="fa fa-link" aria-hidden="true"></i></a>1.5.5. NettyClientHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec2</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">StudentPOJO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x5F53;&#x901A;&#x9053;&#x5C31;&#x7EEA;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;&#x65B9;&#x6CD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x968F;&#x673A;&#x7684;&#x53D1;&#x9001;Student &#x6216;&#x8005; Workder &#x5BF9;&#x8C61;</span>
        <span class="token keyword">int</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage</span> myMessage <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> random<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//&#x53D1;&#x9001;Student &#x5BF9;&#x8C61;</span>

            myMessage <span class="token operator">=</span> <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataType</span><span class="token punctuation">(</span><span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage<span class="token punctuation">.</span>DataType<span class="token punctuation">.</span>StudentType</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStudent</span><span class="token punctuation">(</span><span class="token class-name">MyDataInfo<span class="token punctuation">.</span>Student</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;&#x7389;&#x9E92;&#x9E9F; &#x5362;&#x4FCA;&#x4E49;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// &#x53D1;&#x9001;&#x4E00;&#x4E2A;Worker &#x5BF9;&#x8C61;</span>

            myMessage <span class="token operator">=</span> <span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDataType</span><span class="token punctuation">(</span><span class="token class-name">MyDataInfo<span class="token punctuation">.</span>MyMessage<span class="token punctuation">.</span>DataType<span class="token punctuation">.</span>WorkerType</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setWorker</span><span class="token punctuation">(</span><span class="token class-name">MyDataInfo<span class="token punctuation">.</span>Worker</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8001;&#x674E;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>myMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5F53;&#x901A;&#x9053;&#x6709;&#x8BFB;&#x53D6;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x56DE;&#x590D;&#x7684;&#x6D88;&#x606F;:&quot;</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&#xFF1A; &quot;</span><span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="netty-&#x7F16;&#x89E3;&#x7801;&#x5668;&#x548C;-handler-&#x8C03;&#x7528;&#x673A;&#x5236;"><a name="netty-&#x7F16;&#x89E3;&#x7801;&#x5668;&#x548C;-handler-&#x8C03;&#x7528;&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#netty-&#x7F16;&#x89E3;&#x7801;&#x5668;&#x548C;-handler-&#x8C03;&#x7528;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>2. Netty &#x7F16;&#x89E3;&#x7801;&#x5668;&#x548C; Handler &#x8C03;&#x7528;&#x673A;&#x5236;</h1>
<h2 id="&#x57FA;&#x672C;&#x8BF4;&#x660E;"><a name="&#x57FA;&#x672C;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x57FA;&#x672C;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x57FA;&#x672C;&#x8BF4;&#x660E;</h2>
<ol>
<li><code>Netty</code> &#x7684;&#x7EC4;&#x4EF6;&#x8BBE;&#x8BA1;&#xFF1A;<code>Netty</code> &#x7684;&#x4E3B;&#x8981;&#x7EC4;&#x4EF6;&#x6709; <code>Channel</code>&#x3001;<code>EventLoop</code>&#x3001;<code>ChannelFuture</code>&#x3001;<code>ChannelHandler</code>&#x3001;<code>ChannelPipe</code> &#x7B49;</li>
<li><code>ChannelHandler</code> &#x5145;&#x5F53;&#x4E86;&#x5904;&#x7406;&#x5165;&#x7AD9;&#x548C;&#x51FA;&#x7AD9;&#x6570;&#x636E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x903B;&#x8F91;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5B9E;&#x73B0; <code>ChannelInboundHandler</code> &#x63A5;&#x53E3;&#xFF08;&#x6216; <code>ChannelInboundHandlerAdapter</code>&#xFF09;&#xFF0C;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x5165;&#x7AD9;&#x4E8B;&#x4EF6;&#x548C;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4F1A;&#x88AB;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5904;&#x7406;&#x3002;&#x5F53;&#x8981;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x54CD;&#x5E94;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE; <code>ChannelInboundHandler</code> &#x51B2;&#x5237;&#x6570;&#x636E;&#x3002;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x901A;&#x5E38;&#x5199;&#x5728;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A; <code>ChannelInboundHandler</code> &#x4E2D;&#x3002;<code>ChannelOutboundHandler</code> &#x539F;&#x7406;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5B83;&#x662F;&#x7528;&#x6765;&#x5904;&#x7406;&#x51FA;&#x7AD9;&#x6570;&#x636E;&#x7684;</li>
<li><code>ChannelPipeline</code> &#x63D0;&#x4F9B;&#x4E86; <code>ChannelHandler</code> &#x94FE;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x4EE5;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E3A;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x4E8B;&#x4EF6;&#x7684;&#x8FD0;&#x52A8;&#x65B9;&#x5411;&#x662F;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x79F0;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x4E3A;&#x51FA;&#x7AD9;&#x7684;&#xFF0C;&#x5373;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x901A;&#x8FC7; <code>pipeline</code> &#x4E2D;&#x7684;&#x4E00;&#x7CFB;&#x5217; <code>ChannelOutboundHandler</code>&#xFF0C;&#x5E76;&#x88AB;&#x8FD9;&#x4E9B; <code>Handler</code> &#x5904;&#x7406;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x79F0;&#x4E3A;&#x5165;&#x7AD9;&#x7684;</li>
</ol>
<p><img src="../img/n4.png" alt=""></p>
<blockquote>
<p>&#x51FA;&#x7AD9;&#xFF0C;&#x5165;&#x7AD9;&#x5982;&#x679C;&#x641E;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x7684;<strong>Netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;</strong>&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x548C;&#x56FE;&#x8BB2;&#x6E05;&#x695A;</p>
</blockquote>
<h2 id="&#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;"><a name="&#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;" class="anchor-navigation-ex-anchor" href="#&#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x7F16;&#x7801;&#x89E3;&#x7801;&#x5668;</h2>
<ol>
<li>&#x5F53; <code>Netty</code> &#x53D1;&#x9001;&#x6216;&#x8005;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x5C06;&#x4F1A;&#x53D1;&#x751F;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x3002;&#x5165;&#x7AD9;&#x6D88;&#x606F;&#x4F1A;&#x88AB;&#x89E3;&#x7801;&#xFF1A;&#x4ECE;&#x5B57;&#x8282;&#x8F6C;&#x6362;&#x4E3A;&#x53E6;&#x4E00;&#x79CD;&#x683C;&#x5F0F;&#xFF08;&#x6BD4;&#x5982; <code>java</code> &#x5BF9;&#x8C61;&#xFF09;&#xFF1B;&#x5982;&#x679C;&#x662F;&#x51FA;&#x7AD9;&#x6D88;&#x606F;&#xFF0C;&#x5B83;&#x4F1A;&#x88AB;&#x7F16;&#x7801;&#x6210;&#x5B57;&#x8282;&#x3002;</li>
<li><code>Netty</code> &#x63D0;&#x4F9B;&#x4E00;&#x7CFB;&#x5217;&#x5B9E;&#x7528;&#x7684;&#x7F16;&#x89E3;&#x7801;&#x5668;&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x5B9E;&#x73B0;&#x4E86; <code>ChannelInboundHadnler</code> &#x6216;&#x8005; <code>ChannelOutboundHandler</code> &#x63A5;&#x53E3;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x7C7B;&#x4E2D;&#xFF0C;<code>channelRead</code> &#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x88AB;&#x91CD;&#x5199;&#x4E86;&#x3002;&#x4EE5;&#x5165;&#x7AD9;&#x4E3A;&#x4F8B;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x4ECE;&#x5165;&#x7AD9; <code>Channel</code> &#x8BFB;&#x53D6;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x968F;&#x540E;&#xFF0C;&#x5B83;&#x5C06;&#x8C03;&#x7528;&#x7531;&#x89E3;&#x7801;&#x5668;&#x6240;&#x63D0;&#x4F9B;&#x7684; <code>decode()</code> &#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF0C;&#x5E76;&#x5C06;&#x5DF2;&#x7ECF;&#x89E3;&#x7801;&#x7684;&#x5B57;&#x8282;&#x8F6C;&#x53D1;&#x7ED9; <code>ChannelPipeline</code> &#x4E2D;&#x7684;&#x4E0B;&#x4E00;&#x4E2A; <code>ChannelInboundHandler</code>&#x3002;</li>
</ol>
<h2 id="&#x89E3;&#x7801;&#x5668;---bytetomessagedecoder"><a name="&#x89E3;&#x7801;&#x5668;---bytetomessagedecoder" class="anchor-navigation-ex-anchor" href="#&#x89E3;&#x7801;&#x5668;---bytetomessagedecoder"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x89E3;&#x7801;&#x5668; - ByteToMessageDecoder</h2>
<ol>
<li>&#x5173;&#x7CFB;&#x7EE7;&#x627F;&#x56FE;</li>
</ol>
<p><img src="../img/n5.png" alt=""></p>
<ol>
<li>&#x7531;&#x4E8E;&#x4E0D;&#x53EF;&#x80FD;&#x77E5;&#x9053;&#x8FDC;&#x7A0B;&#x8282;&#x70B9;&#x662F;&#x5426;&#x4F1A;&#x4E00;&#x6B21;&#x6027;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4FE1;&#x606F;&#xFF0C;<code>tcp</code> &#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7C98;&#x5305;&#x62C6;&#x5305;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x4F1A;&#x5BF9;&#x5165;&#x7AD9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F13;&#x51B2;&#xFF0C;&#x76F4;&#x5230;&#x5B83;&#x51C6;&#x5907;&#x597D;&#x88AB;&#x5904;&#x7406;.&#x3010;&#x540E;&#x9762;&#x6709;&#x8BF4;TCP&#x7684;&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x95EE;&#x9898;&#x3011;</li>
<li>&#x4E00;&#x4E2A;&#x5173;&#x4E8E; <code>ByteToMessageDecoder</code> &#x5B9E;&#x4F8B;&#x5206;&#x6790;</li>
</ol>
<p><img src="../img/n6.png" alt=""></p>
<h2 id="netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;"><a name="netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. Netty&#x7684;handler&#x94FE;&#x7684;&#x8C03;&#x7528;&#x673A;&#x5236;</h2>
<p>&#x5B9E;&#x4F8B;&#x8981;&#x6C42;:</p>
<ol>
<li>&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7F16;&#x7801;&#x5668;&#x548C;&#x89E3;&#x7801;&#x5668;&#x6765;&#x8BF4;&#x660E; <code>Netty</code> &#x7684; <code>handler</code> &#x8C03;&#x7528;&#x673A;&#x5236;
&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001; <code>long</code> -&gt; &#x670D;&#x52A1;&#x5668;
&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001; <code>long</code> -&gt; &#x5BA2;&#x6237;&#x7AEF;</li>
</ol>
<blockquote>
<p> &#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;&#x8FD9;&#x4E2A;&#x56FE;&#xFF0C;&#x5E26;&#x7740;&#x8FD9;&#x4E2A;&#x56FE;&#x53BB;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x3002;</p>
</blockquote>
<p><img src="../img/n7.png" alt=""></p>
<h3 id="myserver"><a name="myserver" class="anchor-navigation-ex-anchor" href="#myserver"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.1. MyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workerGroup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7C7B;</span>


            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverinitializer"><a name="myserverinitializer" class="anchor-navigation-ex-anchor" href="#myserverinitializer"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.2. MyServerInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x4E00;&#x4F1A;&#x4E0B;&#x65AD;&#x70B9;</span>

        <span class="token comment">//&#x5165;&#x7AD9;&#x7684;handler&#x8FDB;&#x884C;&#x89E3;&#x7801; MyByteToLongDecoder</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyByteToLongDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x51FA;&#x7AD9;&#x7684;handler&#x8FDB;&#x884C;&#x7F16;&#x7801;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLongToByteEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x7684;handler &#x5904;&#x7406;&#x4E1A;&#x52A1;&#x903B;&#x8F91;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverhandler"><a name="myserverhandler" class="anchor-navigation-ex-anchor" href="#myserverhandler"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.3. MyServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Long</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x8BFB;&#x53D6;&#x5230;long &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x4E00;&#x4E2A;long</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token number">98765L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclient"><a name="myclient" class="anchor-navigation-ex-anchor" href="#myclient"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.4. MyClient</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7C7B;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclientinitializer"><a name="myclientinitializer" class="anchor-navigation-ex-anchor" href="#myclientinitializer"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.5. MyClientInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x51FA;&#x7AD9;&#x7684;handler &#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x7F16;&#x7801;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLongToByteEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x8FD9;&#x65F6;&#x4E00;&#x4E2A;&#x5165;&#x7AD9;&#x7684;&#x89E3;&#x7801;&#x5668;(&#x5165;&#x7AD9;handler )</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyByteToLongDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;handler &#xFF0C; &#x5904;&#x7406;&#x4E1A;&#x52A1;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclienthandler"><a name="myclienthandler" class="anchor-navigation-ex-anchor" href="#myclienthandler"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.6. MyClientHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientHandler</span>  <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Long</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x7684;ip=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x6D88;&#x606F;=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//&#x91CD;&#x5199;channelActive &#x53D1;&#x9001;&#x6570;&#x636E;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyClientHandler &#x53D1;&#x9001;&#x6570;&#x636E;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;&quot;))</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token number">123456L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x53D1;&#x9001;&#x7684;&#x662F;&#x4E00;&#x4E2A;long</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="mybytetolongdecoder"><a name="mybytetolongdecoder" class="anchor-navigation-ex-anchor" href="#mybytetolongdecoder"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.7. MyByteToLongDecoder</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ByteToMessageDecoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyByteToLongDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">ByteToMessageDecoder</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     *
     * decode &#x4F1A;&#x6839;&#x636E;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x88AB;&#x8C03;&#x7528;&#x591A;&#x6B21;, &#x76F4;&#x5230;&#x786E;&#x5B9A;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x5143;&#x7D20;&#x88AB;&#x6DFB;&#x52A0;&#x5230;list
     * , &#x6216;&#x8005;&#x662F;ByteBuf &#x6CA1;&#x6709;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x8BFB;&#x5B57;&#x8282;&#x4E3A;&#x6B62;
     * &#x5982;&#x679C;list out &#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x4F1A;&#x5C06;list&#x7684;&#x5185;&#x5BB9;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A; channelinboundhandler&#x5904;&#x7406;,
     * &#x8BE5;&#x5904;&#x7406;&#x5668;&#x7684;&#x65B9;&#x6CD5;&#x4E5F;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x591A;&#x6B21;
     *
     * @param ctx &#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;
     * @param in &#x5165;&#x7AD9;&#x7684; ByteBuf
     * @param out List &#x96C6;&#x5408;&#xFF0C;&#x5C06;&#x89E3;&#x7801;&#x540E;&#x7684;&#x6570;&#x636E;&#x4F20;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;handler
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyByteToLongDecoder &#x88AB;&#x8C03;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x56E0;&#x4E3A; long 8&#x4E2A;&#x5B57;&#x8282;, &#x9700;&#x8981;&#x5224;&#x65AD;&#x6709;8&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x624D;&#x80FD;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;long</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="mylongtobyteencoder"><a name="mylongtobyteencoder" class="anchor-navigation-ex-anchor" href="#mylongtobyteencoder"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.8. MyLongToByteEncoder</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">MessageToByteEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLongToByteEncoder</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToByteEncoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">//&#x7F16;&#x7801;&#x65B9;&#x6CD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Long</span> msg<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyLongToByteEncoder encode &#x88AB;&#x8C03;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;msg=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x6548;&#x679C;"><a name="&#x6548;&#x679C;" class="anchor-navigation-ex-anchor" href="#&#x6548;&#x679C;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.9. &#x6548;&#x679C;</h3>
<p><img src="../img/n8.png" alt=""></p>
<p><img src="../img/n9.png" alt=""></p>
<h3 id="&#x51FA;&#x7AD9;&#x5165;&#x7AD9;"><a name="&#x51FA;&#x7AD9;&#x5165;&#x7AD9;" class="anchor-navigation-ex-anchor" href="#&#x51FA;&#x7AD9;&#x5165;&#x7AD9;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.10. &#x51FA;&#x7AD9;&#x5165;&#x7AD9;</h3>
<p>&#x5173;&#x4E8E;&#x51FA;&#x7AD9;&#x5165;&#x7AD9;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x53EF;&#x80FD;&#x6709;&#x70B9;&#x8FF7;&#x7CCA;
1&#xFF09;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x51FA;&#x7AD9;&#x5165;&#x7AD9;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x4E5F;&#x6709;&#x51FA;&#x7AD9;&#x5165;&#x7AD9;
2&#xFF09;&#x4EE5;&#x5BA2;&#x6237;&#x7AEF;&#x4E3A;&#x4F8B;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x670D;&#x52A1;&#x7AEF;&#x4F20;&#x9001;&#x7684;&#x6570;&#x636E;&#x5230;&#x8FBE;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x5165;&#x7AD9;&#xFF1B;
                             &#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x4F20;&#x9001;&#x6570;&#x636E;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x51FA;&#x7AD9;&#xFF1B;
                     &#x540C;&#x7406;&#xFF0C;&#x5BF9;&#x4E8E;&#x670D;&#x52A1;&#x7AEF;&#x6765;&#x8BF4;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x6709;&#x6570;&#x636E;&#x6765;&#x5C31;&#x662F;&#x5165;&#x7AD9;&#xFF0C;&#x6709;&#x6570;&#x636E;&#x8F93;&#x51FA;&#x5C31;&#x662F;&#x51FA;&#x7AD9;
3&#xFF09;&#x4E3A;&#x4EC0;&#x4E48;&#x670D;&#x52A1;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;Serverhandler&#x90FD;&#x662F;&#x7EE7;&#x627F;<code>SimpleChannelInboundHandler</code>&#xFF0C;&#x800C;&#x6CA1;&#x6709;<code>ChannelOutboundHandler</code>&#x51FA;&#x7AD9;&#x7C7B;&#xFF1F;
      &#x5B9E;&#x9645;&#x4E0A;&#x5F53;&#x6211;&#x4EEC;&#x5728;handler&#x4E2D;&#x8C03;&#x7528;ctx.writeAndFlush()&#x65B9;&#x6CD5;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x5C06;&#x6570;&#x636E;&#x4EA4;&#x7ED9;ChannelOutboundHandler&#x8FDB;&#x884C;&#x51FA;&#x7AD9;&#x5904;&#x7406;&#xFF0C;&#x53EA;&#x662F;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x53BB;&#x5B9A;&#x4E49;&#x51FA;&#x7AD9;&#x7C7B;&#x800C;&#x5DF2;&#xFF0C;&#x82E5;&#x6709;&#x9700;&#x6C42;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x5B9E;&#x73B0;ChannelOutboundHandler&#x51FA;&#x7AD9;&#x7C7B;
4&#xFF09;&#x603B;&#x7ED3;&#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x90FD;&#x6709;&#x51FA;&#x7AD9;&#x548C;&#x5165;&#x7AD9;&#x7684;&#x64CD;&#x4F5C;
        <strong>&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x6570;&#x636E;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;</strong>&#x670D;&#x52A1;&#x7AEF;---&gt;&#x51FA;&#x7AD9;---&gt;Socket&#x901A;&#x9053;---&gt;&#x5165;&#x7AD9;---&gt;&#x5BA2;&#x6237;&#x7AEF;</p>
<p>&#x200B;        <strong>&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x6570;&#x636E;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF1A;</strong>&#x5BA2;&#x6237;&#x7AEF;---&gt;&#x51FA;&#x7AD9;---&gt;Socket&#x901A;&#x9053;---&gt;&#x5165;&#x7AD9;---&gt;&#x670D;&#x52A1;&#x7AEF;</p>
<p>&#x200B;        </p>
<p><img src="../img/n7.png" alt=""></p>
<blockquote>
<p>&#x4E0B;&#x9762;&#x662F;Netty&#x5B98;&#x65B9;&#x6E90;&#x7801;&#x7ED9;&#x7684;&#x56FE;&#xFF0C;&#x6211;&#x4E2A;&#x4EBA;&#x89C9;&#x7684;&#x4E0D;&#x662F;&#x592A;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x597D;&#x7406;&#x89E3;&#x4E00;&#x4E9B;</p>
</blockquote>
<p><img src="image/chapter08_05.png" alt=""></p>
<h2 id="bytetomessagedecoder&#x7684;&#x5C0F;&#x7EC6;&#x8282;"><a name="bytetomessagedecoder&#x7684;&#x5C0F;&#x7EC6;&#x8282;" class="anchor-navigation-ex-anchor" href="#bytetomessagedecoder&#x7684;&#x5C0F;&#x7EC6;&#x8282;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. ByteToMessageDecoder&#x7684;&#x5C0F;&#x7EC6;&#x8282;</h2>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientHandler</span>  <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Long</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x7684;ip=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x6D88;&#x606F;=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//&#x91CD;&#x5199;channelActive &#x53D1;&#x9001;&#x6570;&#x636E;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyClientHandler &#x53D1;&#x9001;&#x6570;&#x636E;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x5206;&#x6790;</span>
        <span class="token comment">//1. &quot;abcdabcdabcdabcd&quot; &#x662F; 16&#x4E2A;&#x5B57;&#x8282;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;abcdabcdabcdabcd&quot;</span><span class="token punctuation">,</span><span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ByteToMessageDecoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyByteToLongDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">ByteToMessageDecoder</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     *
     * decode &#x4F1A;&#x6839;&#x636E;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x88AB;&#x8C03;&#x7528;&#x591A;&#x6B21;, &#x76F4;&#x5230;&#x786E;&#x5B9A;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x5143;&#x7D20;&#x88AB;&#x6DFB;&#x52A0;&#x5230;list
     * , &#x6216;&#x8005;&#x662F;ByteBuf &#x6CA1;&#x6709;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x8BFB;&#x5B57;&#x8282;&#x4E3A;&#x6B62;
     * &#x5982;&#x679C;list out &#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x4F1A;&#x5C06;list&#x7684;&#x5185;&#x5BB9;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A; channelinboundhandler&#x5904;&#x7406;,
     * &#x8BE5;&#x5904;&#x7406;&#x5668;&#x7684;&#x65B9;&#x6CD5;&#x4E5F;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x591A;&#x6B21;
     *
     * @param ctx &#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;
     * @param in &#x5165;&#x7AD9;&#x7684; ByteBuf
     * @param out List &#x96C6;&#x5408;&#xFF0C;&#x5C06;&#x89E3;&#x7801;&#x540E;&#x7684;&#x6570;&#x636E;&#x4F20;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;handler
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyByteToLongDecoder &#x88AB;&#x8C03;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x56E0;&#x4E3A; long 8&#x4E2A;&#x5B57;&#x8282;, &#x9700;&#x8981;&#x5224;&#x65AD;&#x6709;8&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x624D;&#x80FD;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;long</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ol>
<li>&#x7531;&#x4E8E;&#x53D1;&#x9001;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x662F;16&#x5B57;&#x8282;&#xFF0C;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x6CE8;&#x91CA;&#x8BF4;&#x7684;&#x5185;&#x5BB9;&#xFF0C;decode&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x4E24;&#x6B21;</li>
</ol>
<p>&#x5982;&#x4E0B;&#x56FE;&#x9A8C;&#x8BC1;&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="../img/n10.png" alt=""></p>
<ol>
<li><p>&#x540C;&#x65F6;&#x53C8;&#x5F15;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x5C0F;&#x95EE;&#x9898;</p>
<p><img src="../img/n11.png" alt=""></p>
<p>&#x5F53;&#x6211;&#x4EEC;<code>MyClientHandler</code>&#x4F20;&#x4E00;&#x4E2A;Long&#x65F6;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x7684;<code>MyLongToByteEncoder</code>&#x7684;&#x7F16;&#x7801;&#x5668;&#x3002;&#x90A3;&#x4E48;&#x63A7;&#x5236;&#x53F0;&#x5C31;&#x4F1A;&#x6253;&#x5370;&#x8FD9;&#x6837;&#x4E00;&#x53E5;&#x8BDD;&#xFF1A;<strong>MyLongToByteEncoder encode &#x88AB;&#x8C03;&#x7528;</strong>&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x5E76;&#x6CA1;&#x6709;&#x8C03;&#x7528;&#x7F16;&#x7801;&#x5668;&#xFF0C;&#x8FD9;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>
<ol>
<li><code>MyClientHandler</code>&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x5668;&#x7684;&#x540E;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x5668;&#x662F;<code>MyLongToByteEncoder</code></li>
<li><code>MyLongToByteEncoder</code>&#x7684;&#x7236;&#x7C7B;&#x662F;<code>MessageToByteEncoder</code>&#xFF0C;&#x5728;<code>MessageToByteEncoder</code>&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;</li>
</ol>
</li>
</ol>
<pre class="language-"><code class="lang-java"><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x8FD9;&#x91CC;&#x4F1A;&#x5224;&#x65AD;&#x5F53;&#x524D;msg &#x662F;&#x4E0D;&#x662F;&#x5E94;&#x8BE5;&#x5904;&#x7406;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5C31;&#x5904;&#x7406;&#xFF0C;&#x4E0D;&#x662F;&#x5C31;&#x8DF3;&#x8FC7;encode</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">acceptOutboundMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
                <span class="token class-name">I</span> cast <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                buf <span class="token operator">=</span> <span class="token function">allocateBuffer</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cast<span class="token punctuation">,</span> preferDirect<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">encode</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cast<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ReferenceCountUtil</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    buf<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span>EMPTY_BUFFER<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                buf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">EncoderException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EncoderException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>buf <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                buf<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x200B;        </p>
<ol>
<li>&#x5F53;&#x6211;&#x4EEC;&#x4EE5;&#x8FD9;&#x6837;&#x7684;&#x5F62;&#x5F0F;&#x53D1;&#x9001;&#x6570;&#x636E;</li>
</ol>
<pre class="language-"><code class="lang-java">ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;abcdabcdabcdabcd&quot;</span><span class="token punctuation">,</span><span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>![](../img/n12.png&quot; /&gt;</p>
<p>&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#x578B;&#x5E76;&#x4E0D;&#x5339;&#x914D;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x8D70;&#x7F16;&#x7801;&#x5668;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x7F16;&#x5199; Encoder &#x662F;&#x8981;&#x6CE8;&#x610F;&#x4F20;&#x5165;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x548C;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E00;&#x81F4;</p>
<p><strong>&#x7ED3;&#x8BBA;&#xFF1A;</strong></p>
<ul>
<li>&#x4E0D;&#x8BBA;&#x89E3;&#x7801;&#x5668; <code>handler</code> &#x8FD8;&#x662F;&#x7F16;&#x7801;&#x5668; <code>handler</code> &#x5373;&#x63A5;&#x6536;&#x7684;&#x6D88;&#x606F;&#x7C7B;&#x578B;&#x5FC5;&#x987B;&#x4E0E;&#x5F85;&#x5904;&#x7406;&#x7684;&#x6D88;&#x606F;&#x7C7B;&#x578B;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219;&#x8BE5; <code>handler</code> &#x4E0D;&#x4F1A;&#x88AB;&#x6267;&#x884C;</li>
<li>&#x5728;&#x89E3;&#x7801;&#x5668;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x89E3;&#x7801;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5224;&#x65AD;&#x7F13;&#x5B58;&#x533A;&#xFF08;<code>ByteBuf</code>&#xFF09;&#x7684;&#x6570;&#x636E;&#x662F;&#x5426;&#x8DB3;&#x591F;&#xFF0C;&#x5426;&#x5219;&#x63A5;&#x6536;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x671F;&#x671B;&#x7ED3;&#x679C;&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</li>
</ul>
<h2 id="&#x89E3;&#x7801;&#x5668;---replayingdecoder"><a name="&#x89E3;&#x7801;&#x5668;---replayingdecoder" class="anchor-navigation-ex-anchor" href="#&#x89E3;&#x7801;&#x5668;---replayingdecoder"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. &#x89E3;&#x7801;&#x5668; - ReplayingDecoder</h2>
<ol>
<li><code>public abstract class ReplayingDecoder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>S</span><span class="token punctuation">&gt;</span></span> extends ByteToMessageDecoder</code></li>
<li><code>ReplayingDecoder</code> &#x6269;&#x5C55;&#x4E86; <code>ByteToMessageDecoder</code> &#x7C7B;&#xFF0C;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x5FC5;&#x8C03;&#x7528; <code>readableBytes()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x7528;&#x5224;&#x65AD;&#x8FD8;&#x6709;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x6570;&#x636E;&#x6765;&#x8BFB;&#x53D6;&#x3002;&#x53C2;&#x6570; <code>S</code> &#x6307;&#x5B9A;&#x4E86;&#x7528;&#x6237;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5176;&#x4E2D; <code>Void</code> &#x4EE3;&#x8868;&#x4E0D;&#x9700;&#x8981;&#x72B6;&#x6001;&#x7BA1;&#x7406;</li>
<li>&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#xFF1A;&#x4F7F;&#x7528; <code>ReplayingDecoder</code> &#x7F16;&#x5199;&#x89E3;&#x7801;&#x5668;&#xFF0C;&#x5BF9;&#x524D;&#x9762;&#x7684;&#x6848;&#x4F8B;&#x8FDB;&#x884C;&#x7B80;&#x5316;[&#x6848;&#x4F8B;&#x6F14;&#x793A;]</li>
</ol>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>inboundhandlerandoutboundhandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ReplayingDecoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyByteToLongDecoder2</span> <span class="token keyword">extends</span> <span class="token class-name">ReplayingDecoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyByteToLongDecoder2 &#x88AB;&#x8C03;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5728; ReplayingDecoder &#x4E0D;&#x9700;&#x8981;&#x5224;&#x65AD;&#x6570;&#x636E;&#x662F;&#x5426;&#x8DB3;&#x591F;&#x8BFB;&#x53D6;&#xFF0C;&#x5185;&#x90E8;&#x4F1A;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x5224;&#x65AD;</span>
        out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ol>
<li><code>ReplayingDecoder</code> &#x4F7F;&#x7528;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x5B83;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x5C40;&#x9650;&#x6027;&#xFF1A;<ul>
<li>&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684; <code>ByteBuf</code> &#x64CD;&#x4F5C;&#x90FD;&#x88AB;&#x652F;&#x6301;&#xFF0C;&#x5982;&#x679C;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x4E0D;&#x88AB;&#x652F;&#x6301;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A; <code>UnsupportedOperationException</code>&#x3002;</li>
<li><code>ReplayingDecoder</code> &#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x80FD;&#x7A0D;&#x6162;&#x4E8E; <code>ByteToMessageDecoder</code>&#xFF0C;&#x4F8B;&#x5982;&#x7F51;&#x7EDC;&#x7F13;&#x6162;&#x5E76;&#x4E14;&#x6D88;&#x606F;&#x683C;&#x5F0F;&#x590D;&#x6742;&#x65F6;&#xFF0C;&#x6D88;&#x606F;&#x4F1A;&#x88AB;&#x62C6;&#x6210;&#x4E86;&#x591A;&#x4E2A;&#x788E;&#x7247;&#xFF0C;&#x901F;&#x5EA6;&#x53D8;&#x6162;</li>
</ul>
</li>
</ol>
<h2 id="&#x5176;&#x5B83;&#x7F16;&#x89E3;&#x7801;&#x5668;"><a name="&#x5176;&#x5B83;&#x7F16;&#x89E3;&#x7801;&#x5668;" class="anchor-navigation-ex-anchor" href="#&#x5176;&#x5B83;&#x7F16;&#x89E3;&#x7801;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. &#x5176;&#x5B83;&#x7F16;&#x89E3;&#x7801;&#x5668;</h2>
<p><img src="../img/n13.png" alt=""></p>
<ol>
<li><code>LineBasedFrameDecoder</code>&#xFF1A;&#x8FD9;&#x4E2A;&#x7C7B;&#x5728; <code>Netty</code> &#x5185;&#x90E8;&#x4E5F;&#x6709;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x884C;&#x5C3E;&#x63A7;&#x5236;&#x5B57;&#x7B26;&#xFF08;\n&#x6216;&#x8005;\r\n&#xFF09;&#x4F5C;&#x4E3A;&#x5206;&#x9694;&#x7B26;&#x6765;&#x89E3;&#x6790;&#x6570;&#x636E;&#x3002;</li>
<li><code>DelimiterBasedFrameDecoder</code>&#xFF1A;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x4F5C;&#x4E3A;&#x6D88;&#x606F;&#x7684;&#x5206;&#x9694;&#x7B26;&#x3002;</li>
<li><code>HttpObjectDecoder</code>&#xFF1A;&#x4E00;&#x4E2A; <code>HTTP</code> &#x6570;&#x636E;&#x7684;&#x89E3;&#x7801;&#x5668;</li>
<li><code>LengthFieldBasedFrameDecoder</code>&#xFF1A;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x957F;&#x5EA6;&#x6765;&#x6807;&#x8BC6;&#x6574;&#x5305;&#x6D88;&#x606F;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x7684;&#x5904;&#x7406;&#x9ECF;&#x5305;&#x548C;&#x534A;&#x5305;&#x6D88;&#x606F;&#x3002;</li>
</ol>
<h2 id="log4j-&#x6574;&#x5408;&#x5230;-netty"><a name="log4j-&#x6574;&#x5408;&#x5230;-netty" class="anchor-navigation-ex-anchor" href="#log4j-&#x6574;&#x5408;&#x5230;-netty"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. Log4j &#x6574;&#x5408;&#x5230; Netty</h2>
<ol>
<li>&#x5728; <code>Maven</code> &#x4E2D;&#x6DFB;&#x52A0;&#x5BF9; <code>Log4j</code> &#x7684;&#x4F9D;&#x8D56;&#x5728; <code>pom.xml</code></li>
</ol>
<pre class="language-"><code class="lang-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ol>
<li>&#x914D;&#x7F6E; <code>Log4j</code>&#xFF0C;&#x5728; <code>resources/log4j.properties</code></li>
</ol>
<pre class="language-"><code class="lang-properties"><span class="token key attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token value attr-value">DEBUG,stdout</span>
<span class="token key attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token key attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.stdout.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">[%p]%C{1}-%m%n</span>
</code></pre>
<ol>
<li>&#x6F14;&#x793A;&#x6574;&#x5408;</li>
</ol>
<p><img src="../img/n14.jpg" alt=""></p>
<h1 id="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a name="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="anchor-navigation-ex-anchor" href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><i class="fa fa-link" aria-hidden="true"></i></a>3. TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h1>
<h2 id="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><a name="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</h2>
<ol>
<li><code>TCP</code> &#x662F;&#x9762;&#x5411;&#x8FDE;&#x63A5;&#x7684;&#xFF0C;&#x9762;&#x5411;&#x6D41;&#x7684;&#xFF0C;&#x63D0;&#x4F9B;&#x9AD8;&#x53EF;&#x9760;&#x6027;&#x670D;&#x52A1;&#x3002;&#x6536;&#x53D1;&#x4E24;&#x7AEF;&#xFF08;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF09;&#x90FD;&#x8981;&#x6709;&#x4E00;&#x4E00;&#x6210;&#x5BF9;&#x7684; <code>socket</code>&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x53D1;&#x9001;&#x7AEF;&#x4E3A;&#x4E86;&#x5C06;&#x591A;&#x4E2A;&#x53D1;&#x7ED9;&#x63A5;&#x6536;&#x7AEF;&#x7684;&#x5305;&#xFF0C;&#x66F4;&#x6709;&#x6548;&#x7684;&#x53D1;&#x7ED9;&#x5BF9;&#x65B9;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x4F18;&#x5316;&#x65B9;&#x6CD5;&#xFF08;<code>Nagle</code> &#x7B97;&#x6CD5;&#xFF09;&#xFF0C;&#x5C06;&#x591A;&#x6B21;&#x95F4;&#x9694;&#x8F83;&#x5C0F;&#x4E14;&#x6570;&#x636E;&#x91CF;&#x5C0F;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x6570;&#x636E;&#x5757;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x5C01;&#x5305;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x867D;&#x7136;&#x63D0;&#x9AD8;&#x4E86;&#x6548;&#x7387;&#xFF0C;&#x4F46;&#x662F;&#x63A5;&#x6536;&#x7AEF;&#x5C31;&#x96BE;&#x4E8E;&#x5206;&#x8FA8;&#x51FA;&#x5B8C;&#x6574;&#x7684;&#x6570;&#x636E;&#x5305;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x9762;&#x5411;&#x6D41;&#x7684;&#x901A;&#x4FE1;&#x662F;&#x65E0;&#x6D88;&#x606F;&#x4FDD;&#x62A4;&#x8FB9;&#x754C;&#x7684;</li>
<li>&#x7531;&#x4E8E; <code>TCP</code> &#x65E0;&#x6D88;&#x606F;&#x4FDD;&#x62A4;&#x8FB9;&#x754C;,&#x9700;&#x8981;&#x5728;&#x63A5;&#x6536;&#x7AEF;&#x5904;&#x7406;&#x6D88;&#x606F;&#x8FB9;&#x754C;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;&#x7C98;&#x5305;&#x3001;&#x62C6;&#x5305;&#x95EE;&#x9898;,&#x770B;&#x4E00;&#x5F20;&#x56FE;</li>
<li><code>TCP</code> &#x7C98;&#x5305;&#x3001;&#x62C6;&#x5305;&#x56FE;&#x89E3;</li>
</ol>
<p><img src="../img/n15.png" alt=""></p>
<p>&#x5047;&#x8BBE;&#x5BA2;&#x6237;&#x7AEF;&#x5206;&#x522B;&#x53D1;&#x9001;&#x4E86;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x5305; <code>D1</code> &#x548C; <code>D2</code> &#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x7531;&#x4E8E;&#x670D;&#x52A1;&#x7AEF;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x5B57;&#x8282;&#x6570;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x6545;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x56DB;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<ol>
<li>&#x670D;&#x52A1;&#x7AEF;&#x5206;&#x4E24;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x4E24;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x5206;&#x522B;&#x662F; <code>D1</code> &#x548C; <code>D2</code>&#xFF0C;&#x6CA1;&#x6709;&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;</li>
<li>&#x670D;&#x52A1;&#x7AEF;&#x4E00;&#x6B21;&#x63A5;&#x53D7;&#x5230;&#x4E86;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x5305;&#xFF0C;<code>D1</code> &#x548C; <code>D2</code> &#x7C98;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x79F0;&#x4E4B;&#x4E3A; <code>TCP</code> &#x7C98;&#x5305;</li>
<li>&#x670D;&#x52A1;&#x7AEF;&#x5206;&#x4E24;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x5B8C;&#x6574;&#x7684; <code>D1</code> &#x5305;&#x548C; <code>D2</code> &#x5305;&#x7684;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86; <code>D2</code> &#x5305;&#x7684;&#x5269;&#x4F59;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x79F0;&#x4E4B;&#x4E3A; <code>TCP</code> &#x62C6;&#x5305;</li>
<li>&#x670D;&#x52A1;&#x7AEF;&#x5206;&#x4E24;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86; <code>D1</code> &#x5305;&#x7684;&#x90E8;&#x5206;&#x5185;&#x5BB9; <code>D1_1</code>&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8BFB;&#x53D6;&#x5230;&#x4E86; <code>D1</code> &#x5305;&#x7684;&#x5269;&#x4F59;&#x90E8;&#x5206;&#x5185;&#x5BB9; <code>D1_2</code> &#x548C;&#x5B8C;&#x6574;&#x7684; <code>D2</code> &#x5305;&#x3002;</li>
</ol>
<h2 id="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#x5B9E;&#x4F8B;"><a name="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#x5B9E;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#x5B9E;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x73B0;&#x8C61;&#x5B9E;&#x4F8B;</h2>
<p>&#x5728;&#x7F16;&#x5199; <code>Netty</code> &#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x505A;&#x5904;&#x7406;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x7684;&#x95EE;&#x9898;</p>
<p>&#x770B;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x4F8B;&#xFF1A;</p>
<h3 id="myserver_1"><a name="myserver_1" class="anchor-navigation-ex-anchor" href="#myserver_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.1. MyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workerGroup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7C7B;</span>


            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverinitializer_1"><a name="myserverinitializer_1" class="anchor-navigation-ex-anchor" href="#myserverinitializer_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.2. MyServerInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp</span><span class="token punctuation">;</span>



<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverhandler_1"><a name="myserverhandler_1" class="anchor-navigation-ex-anchor" href="#myserverhandler_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.3. MyServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//cause.printStackTrace();</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x5C06;buffer&#x8F6C;&#x6210;&#x5B57;&#x7B26;&#x4E32;</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E; &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x91CF;=&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x670D;&#x52A1;&#x5668;&#x56DE;&#x9001;&#x6570;&#x636E;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;, &#x56DE;&#x9001;&#x4E00;&#x4E2A;&#x968F;&#x673A;id ,</span>
        <span class="token class-name">ByteBuf</span> responseByteBuf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>responseByteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclient_1"><a name="myclient_1" class="anchor-navigation-ex-anchor" href="#myclient_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.4. MyClient</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp</span><span class="token punctuation">;</span>



<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7C7B;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclientinitializer_1"><a name="myclientinitializer_1" class="anchor-navigation-ex-anchor" href="#myclientinitializer_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.5. MyClientInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclienthandler_1"><a name="myclienthandler_1" class="anchor-navigation-ex-anchor" href="#myclienthandler_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.6. MyClientHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuf</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;10&#x6761;&#x6570;&#x636E; hello,server &#x7F16;&#x53F7;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello,server &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;=&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;=&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x6548;&#x679C;_1"><a name="&#x6548;&#x679C;_1" class="anchor-navigation-ex-anchor" href="#&#x6548;&#x679C;_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.7. &#x6548;&#x679C;</h3>
<p><strong>&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#xFF1A;</strong></p>
<p><strong>Client</strong></p>
<p><img src="../img/n16.png" alt=""></p>
<p><strong>Server</strong></p>
<p><img src="../img/n17.png" alt=""></p>
<p><strong>&#x7B2C;&#x4E8C;&#x6B21;&#x8FD0;&#x884C;&#xFF1A;</strong></p>
<p><strong>Client</strong></p>
<p><img src="../img/n18.png" alt=""></p>
<p><strong>Server</strong></p>
<p><img src="../img/n19.png" alt=""></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E00;&#x6B21;&#x6027;&#x5C06;10&#x4E2A;&#x6570;&#x636E;&#x90FD;&#x63A5;&#x6536;&#x4E86;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8FD0;&#x884C;&#x65F6;&#x5206;&#x516D;&#x6B21;&#x63A5;&#x6536;&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x5F88;&#x5F62;&#x8C61;&#x7684;&#x770B;&#x51FA;&#x4E86;TCP&#x7684;&#x7C98;&#x5305;&#x73B0;&#x8C61;&#x3002;</p>
<h2 id="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a name="tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="anchor-navigation-ex-anchor" href="#tcp-&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. TCP &#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2>
<ol>
<li>&#x5E38;&#x7528;&#x65B9;&#x6848;&#xFF1A;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x534F;&#x8BAE;+&#x7F16;&#x89E3;&#x7801;&#x5668;&#x6765;&#x89E3;&#x51B3;</li>
<li>&#x5173;&#x952E;&#x5C31;&#x662F;&#x8981;&#x89E3;&#x51B3;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6BCF;&#x6B21;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x591A;&#x8BFB;&#x6216;&#x5C11;&#x8BFB;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x7684; <code>TCP</code> &#x7C98;&#x5305;&#x3001;&#x62C6;&#x5305;&#x3002;</li>
</ol>
<p><strong>&#x770B;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x4F8B;</strong></p>
<ol>
<li>&#x8981;&#x6C42;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001; <code>5</code> &#x4E2A; <code>Message</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6BCF;&#x6B21;&#x53D1;&#x9001;&#x4E00;&#x4E2A; <code>Message</code> &#x5BF9;&#x8C61;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6BCF;&#x6B21;&#x63A5;&#x6536;&#x4E00;&#x4E2A; <code>Message</code>&#xFF0C;&#x5206; <code>5</code> &#x6B21;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF0C;&#x6BCF;&#x8BFB;&#x53D6;&#x5230;&#x4E00;&#x4E2A; <code>Message</code>&#xFF0C;&#x4F1A;&#x56DE;&#x590D;&#x4E00;&#x4E2A; <code>Message</code> &#x5BF9;&#x8C61;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</li>
</ol>
<p><img src="../img/n20.png" alt=""></p>
<h3 id="messageprotocol"><a name="messageprotocol" class="anchor-navigation-ex-anchor" href="#messageprotocol"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.1. MessageProtocol</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>


<span class="token comment">//&#x534F;&#x8BAE;&#x5305;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageProtocol</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> len<span class="token punctuation">;</span> <span class="token comment">//&#x5173;&#x952E;</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> len<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLen</span><span class="token punctuation">(</span><span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>len <span class="token operator">=</span> len<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserver_2"><a name="myserver_2" class="anchor-navigation-ex-anchor" href="#myserver_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.2. MyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workerGroup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7C7B;</span>


            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverinitializer_2"><a name="myserverinitializer_2" class="anchor-navigation-ex-anchor" href="#myserverinitializer_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.3. MyServerInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>



<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyMessageDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x89E3;&#x7801;&#x5668;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyMessageEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x7F16;&#x7801;&#x5668;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverhandler_2"><a name="myserverhandler_2" class="anchor-navigation-ex-anchor" href="#myserverhandler_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.4. MyServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>


<span class="token comment">//&#x5904;&#x7406;&#x4E1A;&#x52A1;&#x7684;handler</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageProtocol</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//cause.printStackTrace();</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">MessageProtocol</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5904;&#x7406;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x5982;&#x4E0B;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x957F;&#x5EA6;=&quot;</span> <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5185;&#x5BB9;=&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5305;&#x6570;&#x91CF;=&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x56DE;&#x590D;&#x6D88;&#x606F;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x56DE;&#x590D;&#x6D88;&#x606F;------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> responseContent <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> responseLen <span class="token operator">=</span> responseContent<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>  responseContent2 <span class="token operator">=</span> responseContent<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x534F;&#x8BAE;&#x5305;</span>
        <span class="token class-name">MessageProtocol</span> messageProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageProtocol<span class="token punctuation">.</span><span class="token function">setLen</span><span class="token punctuation">(</span>responseLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageProtocol<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>responseContent2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>messageProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclient_2"><a name="myclient_2" class="anchor-navigation-ex-anchor" href="#myclient_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.5. MyClient</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>



<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7C7B;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclientinitializer_2"><a name="myclientinitializer_2" class="anchor-navigation-ex-anchor" href="#myclientinitializer_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.6. MyClientInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyMessageEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x52A0;&#x5165;&#x7F16;&#x7801;&#x5668;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyMessageDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x52A0;&#x5165;&#x89E3;&#x7801;&#x5668;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myclienthandler_2"><a name="myclienthandler_2" class="anchor-navigation-ex-anchor" href="#myclienthandler_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.7. MyClientHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageProtocol</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;10&#x6761;&#x6570;&#x636E; &quot;&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;&quot; &#x7F16;&#x53F7;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> mes <span class="token operator">=</span> <span class="token string">&quot;&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> mes<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> length <span class="token operator">=</span> mes<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

            <span class="token comment">//&#x521B;&#x5EFA;&#x534F;&#x8BAE;&#x5305;&#x5BF9;&#x8C61;</span>
            <span class="token class-name">MessageProtocol</span> messageProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageProtocol<span class="token punctuation">.</span><span class="token function">setLen</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageProtocol<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>messageProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token comment">//    @Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">MessageProtocol</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> len <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5982;&#x4E0B;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x957F;&#x5EA6;=&quot;</span> <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5185;&#x5BB9;=&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;=&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5F02;&#x5E38;&#x6D88;&#x606F;=&quot;</span> <span class="token operator">+</span> cause<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="mymessagedecoder"><a name="mymessagedecoder" class="anchor-navigation-ex-anchor" href="#mymessagedecoder"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.8. MyMessageDecoder</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ReplayingDecoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMessageDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">ReplayingDecoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyMessageDecoder decode &#x88AB;&#x8C03;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x9700;&#x8981;&#x5C06;&#x5F97;&#x5230;&#x4E8C;&#x8FDB;&#x5236;&#x5B57;&#x8282;&#x7801;-&gt; MessageProtocol &#x6570;&#x636E;&#x5305;(&#x5BF9;&#x8C61;)</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x5C01;&#x88C5;&#x6210; MessageProtocol &#x5BF9;&#x8C61;&#xFF0C;&#x653E;&#x5165; out&#xFF0C; &#x4F20;&#x9012;&#x4E0B;&#x4E00;&#x4E2A;handler&#x4E1A;&#x52A1;&#x5904;&#x7406;</span>
        <span class="token class-name">MessageProtocol</span> messageProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageProtocol<span class="token punctuation">.</span><span class="token function">setLen</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        messageProtocol<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x653E;&#x5165;out&#x4F20;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;hanlder&#x8FDB;&#x884C;&#x5904;&#x7406;</span>
        out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>messageProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="mymessageencoder"><a name="mymessageencoder" class="anchor-navigation-ex-anchor" href="#mymessageencoder"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.9. MyMessageEncoder</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>protocoltcp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">MessageToByteEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMessageEncoder</span> <span class="token keyword">extends</span> <span class="token class-name">MessageToByteEncoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageProtocol</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">MessageProtocol</span> msg<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyMessageEncoder encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x6548;&#x679C;_2"><a name="&#x6548;&#x679C;_2" class="anchor-navigation-ex-anchor" href="#&#x6548;&#x679C;_2"><i class="fa fa-link" aria-hidden="true"></i></a>3.3.10. &#x6548;&#x679C;</h3>
<p><strong>Client&#x8F93;&#x51FA;</strong></p>
<pre class="language-"><code class="lang-java"><span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;


<span class="token comment">//&#x4E0B;&#x9762;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x7684;&#x6536;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x56DE;&#x590D;</span>
<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">36</span>
&#x5185;&#x5BB9;<span class="token operator">=</span><span class="token number">1</span>b5286dd<span class="token operator">-</span><span class="token number">0f</span>c2<span class="token operator">-</span><span class="token number">4f</span><span class="token number">62</span><span class="token operator">-</span><span class="token number">9</span>bf7<span class="token operator">-</span>d5fad84179b5
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">1</span>


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">36</span>
&#x5185;&#x5BB9;<span class="token operator">=</span><span class="token number">653d</span><span class="token number">18</span>cb<span class="token operator">-</span>ab72<span class="token operator">-</span><span class="token number">4163</span><span class="token operator">-</span><span class="token number">8</span>b95<span class="token operator">-</span><span class="token number">09</span>c94ecac873
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">2</span>


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">36</span>
&#x5185;&#x5BB9;<span class="token operator">=</span><span class="token number">3</span>be6e403<span class="token operator">-</span><span class="token number">91</span>bb<span class="token operator">-</span><span class="token number">4437</span><span class="token operator">-</span>ada8<span class="token operator">-</span><span class="token number">6</span>cdb9eb7ef00
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">3</span>


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">36</span>
&#x5185;&#x5BB9;<span class="token operator">=</span><span class="token number">94</span>c8f306<span class="token operator">-</span>fd9c<span class="token operator">-</span><span class="token number">455</span>a<span class="token operator">-</span><span class="token number">956</span>c<span class="token operator">-</span><span class="token number">16698</span>ce4150b
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">4</span>


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">36</span>
&#x5185;&#x5BB9;<span class="token operator">=</span><span class="token number">7890d</span>e9c<span class="token operator">-</span><span class="token number">0f</span>a2<span class="token operator">-</span><span class="token number">4317</span><span class="token operator">-</span><span class="token number">8d</span>e1<span class="token operator">-</span><span class="token number">1d</span><span class="token number">464315f</span>a1b
&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">5</span>
</code></pre>
<p><strong>Server&#x8F93;&#x51FA;</strong></p>
<pre class="language-"><code class="lang-java"><span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">27</span>
&#x5185;&#x5BB9;<span class="token operator">=</span>&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5305;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">1</span>
&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x56DE;&#x590D;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">27</span>
&#x5185;&#x5BB9;<span class="token operator">=</span>&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5305;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">2</span>
&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x56DE;&#x590D;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">27</span>
&#x5185;&#x5BB9;<span class="token operator">=</span>&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5305;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">3</span>
&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x56DE;&#x590D;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">27</span>
&#x5185;&#x5BB9;<span class="token operator">=</span>&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5305;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">4</span>
&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x56DE;&#x590D;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;


<span class="token class-name">MyMessageDecoder</span> decode &#x88AB;&#x8C03;&#x7528;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x5982;&#x4E0B;
&#x957F;&#x5EA6;<span class="token operator">=</span><span class="token number">27</span>
&#x5185;&#x5BB9;<span class="token operator">=</span>&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x51B7;&#xFF0C;&#x5403;&#x706B;&#x9505;
&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5305;&#x6570;&#x91CF;<span class="token operator">=</span><span class="token number">5</span>
&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x56DE;&#x590D;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token class-name">MyMessageEncoder</span> encode &#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;
</code></pre>
<p>&#x65E0;&#x8BBA;&#x8FD0;&#x884C;&#x51E0;&#x6B21;&#xFF0C;Server&#x90FD;&#x662F;&#x5206;5&#x6B21;&#x63A5;&#x6536;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x89E3;&#x51B3;&#x4E86;TCP&#x7C98;&#x5305;&#x95EE;&#x9898;&#x3002;</p>
<h1 id="&#x7528;-netty-&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;rpc"><a name="&#x7528;-netty-&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;rpc" class="anchor-navigation-ex-anchor" href="#&#x7528;-netty-&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;rpc"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x7528; Netty &#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;RPC</h1>
<h2 id="rpc-&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><a name="rpc-&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#rpc-&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. RPC &#x57FA;&#x672C;&#x4ECB;&#x7ECD;</h2>
<ol>
<li><code>RPC&#xFF08;Remote Procedure Call&#xFF09;</code>&#x2014;&#x8FDC;&#x7A0B;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x673A;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x3002;&#x8BE5;&#x534F;&#x8BAE;&#x5141;&#x8BB8;&#x8FD0;&#x884C;&#x4E8E;&#x4E00;&#x53F0;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x53E6;&#x4E00;&#x53F0;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x800C;&#x7A0B;&#x5E8F;&#x5458;&#x65E0;&#x9700;&#x989D;&#x5916;&#x5730;&#x4E3A;&#x8FD9;&#x4E2A;&#x4EA4;&#x4E92;&#x4F5C;&#x7528;&#x7F16;&#x7A0B;</li>
<li>&#x4E24;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x5206;&#x5E03;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x8C03;&#x7528;&#x90FD;&#x50CF;&#x662F;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E00;&#x6837;(&#x5982;&#x56FE;)</li>
</ol>
<p><img src="../img/n21.png" alt=""></p>
<p>&#x8FC7;&#x7A0B;&#xFF1A;</p>
<ol>
<li>&#x8C03;&#x7528;&#x8005;(<code>Caller</code>)&#xFF0C;&#x8C03;&#x7528;&#x8FDC;&#x7A0B;API(<code>Remote API</code>)</li>
<li>&#x8C03;&#x7528;&#x8FDC;&#x7A0B;API&#x4F1A;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;RPC&#x4EE3;&#x7406;(<code>RpcProxy</code>)</li>
<li>RPC&#x4EE3;&#x7406;&#x518D;&#x53BB;&#x8C03;&#x7528;<code>RpcInvoker</code>(&#x8FD9;&#x4E2A;&#x662F;PRC&#x7684;&#x8C03;&#x7528;&#x8005;)</li>
<li><code>RpcInvoker</code>&#x901A;&#x8FC7;RPC&#x8FDE;&#x63A5;&#x5668;(<code>RpcConnector</code>)</li>
<li>RPC&#x8FDE;&#x63A5;&#x5668;&#x7528;&#x4E24;&#x53F0;&#x673A;&#x5668;&#x89C4;&#x5B9A;&#x597D;&#x7684;PRC&#x534F;&#x8BAE;(<code>RpcProtocol</code>)&#x628A;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;</li>
<li>&#x63A5;&#x7740;RPC&#x8FDE;&#x63A5;&#x5668;&#x901A;&#x8FC7;RpcChannel&#x901A;&#x9053;&#x53D1;&#x9001;&#x5230;&#x5BF9;&#x65B9;&#x7684;PRC&#x63A5;&#x6536;&#x5668;(RpcAcceptor)</li>
<li>PRC&#x63A5;&#x6536;&#x5668;&#x901A;&#x8FC7;PRC&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#x62FF;&#x5230;&#x6570;&#x636E;</li>
<li>&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x4F20;&#x7ED9;<code>RpcProcessor</code></li>
<li><code>RpcProcessor</code>&#x518D;&#x4F20;&#x7ED9;<code>RpcInvoker</code></li>
<li><code>RpcInvoker</code>&#x8C03;&#x7528;<code>Remote API</code></li>
<li>&#x6700;&#x540E;&#x63A8;&#x7ED9;&#x88AB;&#x8C03;&#x7528;&#x8005;(Callee)</li>
</ol>
<ol>
<li>&#x5E38;&#x89C1;&#x7684; <code>RPC</code> &#x6846;&#x67B6;&#x6709;&#xFF1A;&#x6BD4;&#x8F83;&#x77E5;&#x540D;&#x7684;&#x5982;&#x963F;&#x91CC;&#x7684; <code>Dubbo</code>&#x3001;<code>Google</code> &#x7684; <code>gRPC</code>&#x3001;<code>Go</code> &#x8BED;&#x8A00;&#x7684;  <code>rpcx</code>&#x3001;<code>Apache</code> &#x7684; <code>thrift</code>&#xFF0C;<code>Spring</code> &#x65D7;&#x4E0B;&#x7684; <code>SpringCloud</code>&#x3002;</li>
</ol>
<p><img src="../img/n22.png" alt=""></p>
<h2 id="&#x6211;&#x4EEC;&#x7684;rpc-&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x56FE;"><a name="&#x6211;&#x4EEC;&#x7684;rpc-&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x56FE;" class="anchor-navigation-ex-anchor" href="#&#x6211;&#x4EEC;&#x7684;rpc-&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. &#x6211;&#x4EEC;&#x7684;RPC &#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x56FE;</h2>
<p><img src="../img/n23.png" alt=""></p>
<p><strong>RPC &#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x8BF4;&#x660E;</strong></p>
<ol>
<li>&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x65B9;&#xFF08;<code>client</code>&#xFF09;&#x4EE5;&#x672C;&#x5730;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#x8C03;&#x7528;&#x670D;&#x52A1;</li>
<li><code>client stub</code> &#x63A5;&#x6536;&#x5230;&#x8C03;&#x7528;&#x540E;&#x8D1F;&#x8D23;&#x5C06;&#x65B9;&#x6CD5;&#x3001;&#x53C2;&#x6570;&#x7B49;&#x5C01;&#x88C5;&#x6210;&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x7684;&#x6D88;&#x606F;&#x4F53;</li>
<li><code>client stub</code> &#x5C06;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x5E76;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x7AEF;</li>
<li><code>server stub</code> &#x6536;&#x5230;&#x6D88;&#x606F;&#x540E;&#x8FDB;&#x884C;&#x89E3;&#x7801;</li>
<li><code>server stub</code> &#x6839;&#x636E;&#x89E3;&#x7801;&#x7ED3;&#x679C;&#x8C03;&#x7528;&#x672C;&#x5730;&#x7684;&#x670D;&#x52A1;</li>
<li>&#x672C;&#x5730;&#x670D;&#x52A1;&#x6267;&#x884C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9; <code>server stub</code></li>
<li><code>server stub</code> &#x5C06;&#x8FD4;&#x56DE;&#x5BFC;&#x5165;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x5E76;&#x53D1;&#x9001;&#x81F3;&#x6D88;&#x8D39;&#x65B9;</li>
<li><code>client stub</code> &#x63A5;&#x6536;&#x5230;&#x6D88;&#x606F;&#x5E76;&#x8FDB;&#x884C;&#x89E3;&#x7801;</li>
<li>&#x670D;&#x52A1;&#x6D88;&#x8D39;&#x65B9;&#xFF08;<code>client</code>&#xFF09;&#x5F97;&#x5230;&#x7ED3;&#x679C;</li>
</ol>
<p>&#x5C0F;&#x7ED3;&#xFF1A;<code>RPC</code> &#x7684;&#x76EE;&#x6807;&#x5C31;&#x662F;&#x5C06; <code>2 - 8</code> &#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x90FD;&#x5C01;&#x88C5;&#x8D77;&#x6765;&#xFF0C;&#x7528;&#x6237;&#x65E0;&#x9700;&#x5173;&#x5FC3;&#x8FD9;&#x4E9B;&#x7EC6;&#x8282;&#xFF0C;&#x53EF;&#x4EE5;&#x50CF;&#x8C03;&#x7528;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x8C03;&#x7528;</p>
<h2 id="&#x5DF1;&#x5B9E;&#x73B0;-dubbo-rpc&#xFF08;&#x57FA;&#x4E8E;-netty&#xFF09;"><a name="&#x5DF1;&#x5B9E;&#x73B0;-dubbo-rpc&#xFF08;&#x57FA;&#x4E8E;-netty&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x5DF1;&#x5B9E;&#x73B0;-dubbo-rpc&#xFF08;&#x57FA;&#x4E8E;-netty&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. &#x5DF1;&#x5B9E;&#x73B0; Dubbo RPC&#xFF08;&#x57FA;&#x4E8E; Netty&#xFF09;</h2>
<h3 id="&#x9700;&#x6C42;&#x8BF4;&#x660E;"><a name="&#x9700;&#x6C42;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x9700;&#x6C42;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.1. &#x9700;&#x6C42;&#x8BF4;&#x660E;</h3>
<ol>
<li><code>Dubbo</code> &#x5E95;&#x5C42;&#x4F7F;&#x7528;&#x4E86; <code>Netty</code> &#x4F5C;&#x4E3A;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x6846;&#x67B6;&#xFF0C;&#x8981;&#x6C42;&#x7528; <code>Netty</code> &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; <code>RPC</code> &#x6846;&#x67B6;</li>
<li>&#x6A21;&#x4EFF; <code>Dubbo</code>&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x548C;&#x63D0;&#x4F9B;&#x8005;&#x7EA6;&#x5B9A;&#x63A5;&#x53E3;&#x548C;&#x534F;&#x8BAE;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x63D0;&#x4F9B;&#x8005;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x6253;&#x5370;&#x63D0;&#x4F9B;&#x8005;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x3002;&#x5E95;&#x5C42;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x4F7F;&#x7528; <code>Netty 4.1.20</code></li>
</ol>
<h3 id="&#x8BBE;&#x8BA1;&#x8BF4;&#x660E;"><a name="&#x8BBE;&#x8BA1;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x8BBE;&#x8BA1;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2. &#x8BBE;&#x8BA1;&#x8BF4;&#x660E;</h3>
<ol>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5B9A;&#x4E49;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x3002;&#x7528;&#x4E8E;&#x6D88;&#x8D39;&#x8005;&#x548C;&#x63D0;&#x4F9B;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x7EA6;&#x5B9A;&#x3002;</li>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x63D0;&#x4F9B;&#x8005;&#xFF0C;&#x8BE5;&#x7C7B;&#x9700;&#x8981;&#x76D1;&#x542C;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x6309;&#x7167;&#x7EA6;&#x5B9A;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x3002;</li>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x8BE5;&#x7C7B;&#x9700;&#x8981;&#x900F;&#x660E;&#x7684;&#x8C03;&#x7528;&#x81EA;&#x5DF1;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5185;&#x90E8;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>Netty</code> &#x8BF7;&#x6C42;&#x63D0;&#x4F9B;&#x8005;&#x8FD4;&#x56DE;&#x6570;&#x636E;</li>
<li>&#x5F00;&#x53D1;&#x7684;&#x5206;&#x6790;&#x56FE;</li>
</ol>
<p>![](../img/n24.png&quot; /&gt;</p>
<h3 id="&#x4EE3;&#x7801;"><a name="&#x4EE3;&#x7801;" class="anchor-navigation-ex-anchor" href="#&#x4EE3;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3. &#x4EE3;&#x7801;</h3>
<h4 id="&#x5C01;&#x88C5;&#x7684;rpc"><a name="&#x5C01;&#x88C5;&#x7684;rpc" class="anchor-navigation-ex-anchor" href="#&#x5C01;&#x88C5;&#x7684;rpc"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5C01;&#x88C5;&#x7684;RPC</h4>
<blockquote>
<p>&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x5757;&#x4EE3;&#x7801;&#x7406;&#x89E3;&#x6210;&#x5C01;&#x88C5;&#x7684;dubbo</p>
</blockquote>
<h5 id="nettyserver_2"><a name="nettyserver_2" class="anchor-navigation-ex-anchor" href="#nettyserver_2"><i class="fa fa-link" aria-hidden="true"></i></a>NettyServer</h5>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServer</span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startServer</span><span class="token punctuation">(</span><span class="token class-name">String</span> hostName<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startServer0</span><span class="token punctuation">(</span>hostName<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5B8C;&#x6210;&#x5BF9;NettyServer&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x542F;&#x52A8;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startServer0</span><span class="token punctuation">(</span><span class="token class-name">String</span> hostname<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workerGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                      <span class="token annotation punctuation">@Override</span>
                                      <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                          <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                          pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                          pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                          pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x5668;</span>

                                      <span class="token punctuation">}</span>
                                  <span class="token punctuation">}</span>

                    <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x65B9;&#x5F00;&#x59CB;&#x63D0;&#x4F9B;&#x670D;&#x52A1;~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="nettyserverhandler_2"><a name="nettyserverhandler_2" class="anchor-navigation-ex-anchor" href="#nettyserverhandler_2"><i class="fa fa-link" aria-hidden="true"></i></a>NettyServerHandler</h5>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>customer<span class="token punctuation">.</span></span><span class="token class-name">ClientBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>provider<span class="token punctuation">.</span></span><span class="token class-name">HelloServiceImpl</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>

<span class="token comment">//&#x670D;&#x52A1;&#x5668;&#x8FD9;&#x8FB9;handler&#x6BD4;&#x8F83;&#x7B80;&#x5355;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x5355;&#x7684;&#x6D88;&#x606F;---&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x5E76;&#x8C03;&#x7528;&#x670D;&#x52A1;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x539F;&#x59CB;&#x6D88;&#x606F;&#xFF1A;&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
         1.&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;api &#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x534F;&#x8BAE;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8981;&#x6C42; &#x6BCF;&#x6B21;&#x53D1;&#x6D88;&#x606F;&#x662F;&#x90FD;
         &#x5FC5;&#x987B;&#x4EE5;&#x67D0;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5F00;&#x5934; &quot;HelloService#hello#&#x4F60;&#x597D;&quot;
         2.Dubbo&#x6CE8;&#x518C;&#x5728;Zookeeper&#x91CC;&#x65F6;&#xFF0C;&#x8FD9;&#x79CD;&#x5C31;&#x662F;&#x7C7B;&#x7684;&#x5168;&#x8DEF;&#x5F84;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4F60;&#x7528;IDEA&#x7684;zookeeper&#x63D2;&#x4EF6;
         &#x5C31;&#x53EF;&#x4EE5;&#x6E05;&#x695A;&#x5730;&#x770B;&#x5230;
         */</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">ClientBootstrap</span><span class="token punctuation">.</span>providerName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="nettyclienthandler_2"><a name="nettyclienthandler_2" class="anchor-navigation-ex-anchor" href="#nettyclienthandler_2"><i class="fa fa-link" aria-hidden="true"></i></a>NettyClientHandler</h5>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ChannelHandlerContext</span> context<span class="token punctuation">;</span><span class="token comment">//&#x4E0A;&#x4E0B;&#x6587;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> result<span class="token punctuation">;</span> <span class="token comment">//&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> para<span class="token punctuation">;</span> <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;</span>


    <span class="token comment">//&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x88AB;&#x8C03;&#x7528;, &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x88AB;&#x8C03;&#x7528;(1)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; channelActive &#x88AB;&#x8C03;&#x7528;  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context <span class="token operator">=</span> ctx<span class="token punctuation">;</span> <span class="token comment">//&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5728;&#x5176;&#x5B83;&#x65B9;&#x6CD5;&#x4F1A;&#x4F7F;&#x7528;&#x5230; ctx</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x8C03;&#x7528;&#x65B9;&#x6CD5; (4)</span>
    <span class="token comment">//</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; channelRead &#x88AB;&#x8C03;&#x7528;  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x5524;&#x9192;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x88AB;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x8C03;&#x7528;, &#x53D1;&#x9001;&#x6570;&#x636E;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;-&gt; wait -&gt; &#x7B49;&#x5F85;&#x88AB;&#x5524;&#x9192;(channelRead) -&gt; &#x8FD4;&#x56DE;&#x7ED3;&#x679C; (3)-&#x300B;5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Object</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; call1 &#x88AB;&#x8C03;&#x7528;  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>para<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x8FDB;&#x884C;wait</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x7B49;&#x5F85;channelRead &#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x5524;&#x9192;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; call2 &#x88AB;&#x8C03;&#x7528;  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  result<span class="token punctuation">;</span> <span class="token comment">//&#x670D;&#x52A1;&#x65B9;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//(2)</span>
    <span class="token keyword">void</span> <span class="token function">setPara</span><span class="token punctuation">(</span><span class="token class-name">String</span> para<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; setPara  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>para <span class="token operator">=</span> para<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="nettyclient_2"><a name="nettyclient_2" class="anchor-navigation-ex-anchor" href="#nettyclient_2"><i class="fa fa-link" aria-hidden="true"></i></a>NettyClient</h5>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelOption</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClient</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">NettyClientHandler</span> client<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//&#x7F16;&#x5199;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x6A21;&#x5F0F;&#xFF0C;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> serivceClass<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> providerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>serivceClass<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;(proxy, method, args) &#x8FDB;&#x5165;....&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x6B21;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//{}  &#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6BCF;&#x8C03;&#x7528;&#x4E00;&#x6B21; hello, &#x5C31;&#x4F1A;&#x8FDB;&#x5165;&#x5230;&#x8BE5;&#x4EE3;&#x7801;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>client <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">//&#x8BBE;&#x7F6E;&#x8981;&#x53D1;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x4FE1;&#x606F;</span>
                    <span class="token comment">//providerName&#xFF1A;&#x534F;&#x8BAE;&#x5934;&#xFF0C;args[0]&#xFF1A;&#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6570;&#x636E;</span>
                    client<span class="token punctuation">.</span><span class="token function">setPara</span><span class="token punctuation">(</span>providerName <span class="token operator">+</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//</span>
                    <span class="token keyword">return</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x521D;&#x59CB;&#x5316;&#x5BA2;&#x6237;&#x7AEF;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x521B;&#x5EFA;EventLoopGroup</span>
        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>TCP_NODELAY<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                                <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="&#x63A5;&#x53E3;"><a name="&#x63A5;&#x53E3;" class="anchor-navigation-ex-anchor" href="#&#x63A5;&#x53E3;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x63A5;&#x53E3;</h4>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>publicinterface</span><span class="token punctuation">;</span>

<span class="token comment">//&#x8FD9;&#x4E2A;&#x662F;&#x63A5;&#x53E3;&#xFF0C;&#x662F;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x65B9;&#x548C; &#x670D;&#x52A1;&#x6D88;&#x8D39;&#x65B9;&#x90FD;&#x9700;&#x8981;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> mes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="&#x670D;&#x52A1;&#x7AEF;provider"><a name="&#x670D;&#x52A1;&#x7AEF;provider" class="anchor-navigation-ex-anchor" href="#&#x670D;&#x52A1;&#x7AEF;provider"><i class="fa fa-link" aria-hidden="true"></i></a>&#x670D;&#x52A1;&#x7AEF;(provider)</h4>
<h5 id="helloserviceimpl"><a name="helloserviceimpl" class="anchor-navigation-ex-anchor" href="#helloserviceimpl"><i class="fa fa-link" aria-hidden="true"></i></a>HelloServiceImpl</h5>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>provider</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>publicinterface<span class="token punctuation">.</span></span><span class="token class-name">HelloService</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">HelloService</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x5F53;&#x6709;&#x6D88;&#x8D39;&#x65B9;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C; &#x5C31;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7ED3;&#x679C;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> mes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x606F;=&quot;</span> <span class="token operator">+</span> mes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x6839;&#x636E;mes &#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>mes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;, &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;[&quot;</span> <span class="token operator">+</span> mes <span class="token operator">+</span> <span class="token string">&quot;] &#xFF0C;&#x7B2C;&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x6B21; \n&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;, &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="serverbootstrap"><a name="serverbootstrap" class="anchor-navigation-ex-anchor" href="#serverbootstrap"><i class="fa fa-link" aria-hidden="true"></i></a>ServerBootstrap</h5>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>provider</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>netty<span class="token punctuation">.</span></span><span class="token class-name">NettyServer</span></span><span class="token punctuation">;</span>

<span class="token comment">//ServerBootstrap &#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#xFF0C;&#x5C31;&#x662F; NettyServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerBootstrap</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x4EE3;&#x7801;&#x4EE3;&#x586B;..</span>
        <span class="token class-name">NettyServer</span><span class="token punctuation">.</span><span class="token function">startServer</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x8D39;&#x8005;"><a name="&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x8D39;&#x8005;" class="anchor-navigation-ex-anchor" href="#&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x8D39;&#x8005;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5BA2;&#x6237;&#x7AEF;(&#x6D88;&#x8D39;&#x8005;)</h4>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>customer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>netty<span class="token punctuation">.</span></span><span class="token class-name">NettyClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>dubborpc<span class="token punctuation">.</span>publicinterface<span class="token punctuation">.</span></span><span class="token class-name">HelloService</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientBootstrap</span> <span class="token punctuation">{</span>


    <span class="token comment">//&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x534F;&#x8BAE;&#x5934;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> providerName <span class="token operator">=</span> <span class="token string">&quot;HelloService#hello#&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;</span>
        <span class="token class-name">NettyClient</span> customer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span>
        <span class="token class-name">HelloService</span> service <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">)</span> customer<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> providerName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x901A;&#x8FC7;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x65B9;&#x6CD5;(&#x670D;&#x52A1;)</span>
            <span class="token class-name">String</span> res <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4F60;&#x597D; dubbo~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C; res= &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x8C03;&#x7528;&#x8FC7;&#x7A0B;"><a name="&#x8C03;&#x7528;&#x8FC7;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x8C03;&#x7528;&#x8FC7;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.4. &#x8C03;&#x7528;&#x8FC7;&#x7A0B;</h3>
<ol>
<li><code>ClientBootstrap#main</code>&#x53D1;&#x8D77;&#x8C03;&#x7528;</li>
<li>&#x8D70;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x540E;</li>
</ol>
<pre class="language-"><code class="lang-java"> <span class="token class-name">HelloService</span> service <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">)</span> customer<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> providerName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ol>
<li><p>&#x8C03;&#x7528;<code>NettyClient#getBean</code>&#xFF0C;&#x5728;&#x6B64;&#x65B9;&#x6CD5;&#x91CC;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x94FE;&#x63A5;&#x3002;</p>
</li>
<li><p>&#x4E8E;&#x662F;&#x5C31;&#x6267;&#x884C;<code>NettyClientHandler#channelActive</code></p>
</li>
<li><p>&#x63A5;&#x7740;&#x56DE;&#x5230;<code>NettyClient#getBean</code>&#x8C03;&#x7528;<code>NettyClientHandler#setPara</code>&#xFF0C;&#x8C03;&#x7528;&#x5B8C;&#x4E4B;&#x540E;&#x518D;&#x56DE;&#x5230;<code>NettyClient#getBean</code>&#xFF0C;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;</p>
</li>
<li><p>&#x56E0;&#x4E3A;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4EA4;&#x4E86;&#x4EFB;&#x52A1;&#xFF0C;&#x5C31;&#x51C6;&#x5907;&#x6267;&#x884C;<code>NettyClientHandler#call</code>&#x7EBF;&#x7A0B;&#x4EFB;&#x52A1;</p>
</li>
<li><p>&#x5728;<code>NettyClientHandler#call</code>&#x4E2D;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7ED9;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;</p>
<pre class="language-"><code class="lang-java">context<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>para<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x7531;&#x4E8E;&#x8FD8;&#x6CA1;&#x6536;&#x5230;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x679C;&#xFF0C;&#x6240;&#x4EE5;wait&#x4F4F;</p>
</li>
<li><p>&#x6765;&#x5230;&#x4E86;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x8FD9;&#x8FB9;&#xFF0C;&#x4ECE;Socket&#x901A;&#x9053;&#x4E2D;&#x6536;&#x5230;&#x4E86;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x6267;&#x884C;<code>NettyServerHandler#channelRead</code>&#xFF0C;&#x7136;&#x540E;&#x56E0;&#x4E3A;&#x6B64;&#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;&#x4E86;</p>
<pre class="language-"><code class="lang-java"><span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>&#x5C31;&#x53BB;<code>HelloServiceImpl#hello</code>&#x4E2D;&#x6267;&#x884C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7ED9;<code>NettyServerHandler#channelRead</code>&#xFF0C;<code>NettyServerHandler#channelRead</code>&#x518D;&#x628A;&#x6570;&#x636E;&#x53D1;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</p>
</li>
<li><p><code>NettyClientHandler#channelRead</code>&#x6536;&#x5230;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x53D1;&#x6765;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5524;&#x9192;&#x4E4B;&#x524D;wait&#x7684;&#x7EBF;&#x7A0B;</p>
</li>
<li><p>&#x6240;&#x4EE5;&#x4E4B;&#x524D;wait&#x7684;&#x7EBF;&#x7A0B;&#x4ECE;<code>NettyClientHandler#call</code>&#x82CF;&#x9192;&#xFF0C;&#x8FD4;&#x56DE;result&#x7ED9;<code>NettyClient#getBean</code></p>
</li>
<li><p><code>NettyClient#getBean</code>get()&#x5230;&#x6570;&#x636E;&#xFF0C;<code>ClientBootstrap#main</code>&#x4E2D;&#x7684;&#x6B64;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#xFF0C;&#x5F97;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x63D0;&#x4F9B;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<pre class="language-"><code class="lang-java"> <span class="token class-name">String</span> res <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">&quot;&#x4F60;&#x597D; dubbo~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
</ol>
<p>13.&#x81F3;&#x6B64;&#xFF0C;&#x4E00;&#x6B21;RPC&#x8C03;&#x7528;&#x7ED3;&#x675F;&#x3002;</p>
<h3 id="&#x6548;&#x679C;_3"><a name="&#x6548;&#x679C;_3" class="anchor-navigation-ex-anchor" href="#&#x6548;&#x679C;_3"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.5. &#x6548;&#x679C;</h3>
<p><strong>ClientBootstrap&#x6253;&#x5370;</strong></p>
<pre class="language-"><code class="lang-java"><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> &#x8FDB;&#x5165;<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span> &#x6B21;
 setPara  
 channelActive &#x88AB;&#x8C03;&#x7528;  
 call1 &#x88AB;&#x8C03;&#x7528;  
 channelRead &#x88AB;&#x8C03;&#x7528;  
 call2 &#x88AB;&#x8C03;&#x7528;  
&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C; res<span class="token operator">=</span> &#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;<span class="token punctuation">,</span> &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;<span class="token punctuation">[</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span><span class="token punctuation">]</span> &#xFF0C;&#x7B2C;<span class="token number">1</span> &#x6B21; 

<span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> &#x8FDB;&#x5165;<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span> &#x6B21;
 setPara  
 call1 &#x88AB;&#x8C03;&#x7528;  
 channelRead &#x88AB;&#x8C03;&#x7528;  
 call2 &#x88AB;&#x8C03;&#x7528;  
&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C; res<span class="token operator">=</span> &#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;<span class="token punctuation">,</span> &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;<span class="token punctuation">[</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span><span class="token punctuation">]</span> &#xFF0C;&#x7B2C;<span class="token number">2</span> &#x6B21; 

<span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> &#x8FDB;&#x5165;<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.3</span> &#x6B21;
 setPara  
 call1 &#x88AB;&#x8C03;&#x7528;  
 channelRead &#x88AB;&#x8C03;&#x7528;  
 call2 &#x88AB;&#x8C03;&#x7528;  
&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C; res<span class="token operator">=</span> &#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;<span class="token punctuation">,</span> &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;<span class="token punctuation">[</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span><span class="token punctuation">]</span> &#xFF0C;&#x7B2C;<span class="token number">3</span> &#x6B21; 

<span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> &#x8FDB;&#x5165;<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.4</span> &#x6B21;
 setPara  
 call1 &#x88AB;&#x8C03;&#x7528;  
 channelRead &#x88AB;&#x8C03;&#x7528;  
 call2 &#x88AB;&#x8C03;&#x7528;  
&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C; res<span class="token operator">=</span> &#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;<span class="token punctuation">,</span> &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;<span class="token punctuation">[</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span><span class="token punctuation">]</span> &#xFF0C;&#x7B2C;<span class="token number">4</span> &#x6B21; 

<span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> &#x8FDB;&#x5165;<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.5</span> &#x6B21;
 setPara  
 call1 &#x88AB;&#x8C03;&#x7528;  
 channelRead &#x88AB;&#x8C03;&#x7528;  
 call2 &#x88AB;&#x8C03;&#x7528;  
&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C; res<span class="token operator">=</span> &#x4F60;&#x597D;&#x5BA2;&#x6237;&#x7AEF;<span class="token punctuation">,</span> &#x6211;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x4F60;&#x7684;&#x6D88;&#x606F;&#x3002;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;<span class="token punctuation">[</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span><span class="token punctuation">]</span> &#xFF0C;&#x7B2C;<span class="token number">5</span> &#x6B21;
</code></pre>
<p><strong>ServerBootstrap&#x6253;&#x5370;</strong></p>
<pre class="language-"><code class="lang-java">&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x65B9;&#x5F00;&#x59CB;&#x63D0;&#x4F9B;&#x670D;&#x52A1;<span class="token operator">~</span><span class="token operator">~</span>
<span class="token operator">--</span><span class="token operator">-</span>&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x5355;&#x7684;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">-</span>
&#x539F;&#x59CB;&#x6D88;&#x606F;&#xFF1A;<span class="token class-name">HelloService</span>#hello#&#x4F60;&#x597D; dubbo<span class="token operator">~</span>
&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x606F;<span class="token operator">=</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span>

<span class="token operator">--</span><span class="token operator">-</span>&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x5355;&#x7684;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">-</span>
&#x539F;&#x59CB;&#x6D88;&#x606F;&#xFF1A;<span class="token class-name">HelloService</span>#hello#&#x4F60;&#x597D; dubbo<span class="token operator">~</span>
&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x606F;<span class="token operator">=</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span>

<span class="token operator">--</span><span class="token operator">-</span>&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x5355;&#x7684;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">-</span>
&#x539F;&#x59CB;&#x6D88;&#x606F;&#xFF1A;<span class="token class-name">HelloService</span>#hello#&#x4F60;&#x597D; dubbo<span class="token operator">~</span>
&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x606F;<span class="token operator">=</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span>

<span class="token operator">--</span><span class="token operator">-</span>&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x5355;&#x7684;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">-</span>
&#x539F;&#x59CB;&#x6D88;&#x606F;&#xFF1A;<span class="token class-name">HelloService</span>#hello#&#x4F60;&#x597D; dubbo<span class="token operator">~</span>
&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x606F;<span class="token operator">=</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span>

<span class="token operator">--</span><span class="token operator">-</span>&#x670D;&#x52A1;&#x7AEF;&#x5F00;&#x59CB;&#x6536;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x5355;&#x7684;&#x6D88;&#x606F;<span class="token operator">--</span><span class="token operator">-</span>
&#x539F;&#x59CB;&#x6D88;&#x606F;&#xFF1A;<span class="token class-name">HelloService</span>#hello#&#x4F60;&#x597D; dubbo<span class="token operator">~</span>
&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6D88;&#x606F;<span class="token operator">=</span>&#x4F60;&#x597D; dubbo<span class="token operator">~</span>
</code></pre>
<footer class="page-footer-ex"> <span class="page-footer-ex-copyright"> &#x4F7F;&#x7528;<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">&#x77E5;&#x8BC6;&#x5171;&#x4EAB; &#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0&#x534F;&#x8BAE;</a>&#x53D1;&#x5E03; </span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <span class="page-footer-ex-footer-update"> <i>updated</i> 2022-07-18 15:10:06 </span> </footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2.Netty实战.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 2.Netty实战">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"3.Netty实现rpc","level":"1.8.3","depth":2,"next":{"title":"8.大数据相关","level":"1.9","depth":1,"ref":"","articles":[{"title":"Flink","level":"1.9.1","depth":2,"ref":"","articles":[{"title":"1.docker部署flink","level":"1.9.1.1","depth":3,"path":"8.大数据相关/flink/1.docker部署flink.md","ref":"8.大数据相关/flink/1.docker部署flink.md","articles":[]},{"title":"2.运行时架构","level":"1.9.1.2","depth":3,"path":"8.大数据相关/flink/2.运行时架构.md","ref":"8.大数据相关/flink/2.运行时架构.md","articles":[]}]},{"title":"Hive","level":"1.9.2","depth":2,"ref":"","articles":[{"title":"hive基础","level":"1.9.2.1","depth":3,"path":"8.大数据相关/hive/hive基础.md","ref":"8.大数据相关/hive/hive基础.md","articles":[]}]},{"title":"实时数仓","level":"1.9.3","depth":2,"ref":"","articles":[{"title":"随记1","level":"1.9.3.1","depth":3,"path":"8.大数据相关/实时数仓/随记1.md","ref":"8.大数据相关/实时数仓/随记1.md","articles":[]}]}]},"previous":{"title":"2.Netty实战","level":"1.8.2","depth":2,"path":"7.Netty/2.Netty实战.md","ref":"7.Netty/2.Netty实战.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","copy-code-button","page-footer-ex","anchor-navigation-ex","expandable-chapters-small","prism","-highlight","-lunr","-search","theme-comscore","search-pro","splitter"],"ignores":["_book","node_modules"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"],"lang":{"flow":"typescript"}},"page-footer-ex":{"copyright":"使用[知识共享 署名-相同方式共享 4.0协议](https://creativecommons.org/licenses/by-sa/4.0/)发布","markdown":true,"update_format":"YYYY-MM-DD HH:mm:ss","update_label":"<i>updated</i>"},"splitter":{},"search-pro":{},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"theme-comscore":{},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"ALin","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"学习笔记","links":{"sidebar":{"Home":"https://lucklin8.github.io/ALin.github.io/"}},"gitbook":"*","description":"ALin的学习博客"},"file":{"path":"7.Netty/3.Netty实现rpc.md","mtime":"2022-07-18T15:10:06.529Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-07-18T15:10:57.703Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

