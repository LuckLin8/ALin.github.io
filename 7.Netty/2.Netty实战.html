
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2.Netty实战 · 学习笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="ALin">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-footer-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="3.Netty实现rpc.html" />
    
    
    <link rel="prev" href="1.传统IO.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://lucklin8.github.io/ALin.github.io/" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    1.JAVA基础
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    JAVA容器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../1.JAVA基础/JAVA容器/1.ArrayList与LinkedList.html">
            
                <a href="../1.JAVA基础/JAVA容器/1.ArrayList与LinkedList.html">
            
                    
                    1.ArrayList与LinkedList
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../1.JAVA基础/JAVA容器/2.HashTable.html">
            
                <a href="../1.JAVA基础/JAVA容器/2.HashTable.html">
            
                    
                    2.HashTable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../1.JAVA基础/JAVA容器/3.HashMap.html">
            
                <a href="../1.JAVA基础/JAVA容器/3.HashMap.html">
            
                    
                    3.HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../1.JAVA基础/JAVA容器/4.ConcurrentHashMap.html">
            
                <a href="../1.JAVA基础/JAVA容器/4.ConcurrentHashMap.html">
            
                    
                    4.ConcurrentHashMap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    JVM
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../1.JAVA基础/JVM/1.深入理解JVM.html">
            
                <a href="../1.JAVA基础/JVM/1.深入理解JVM.html">
            
                    
                    1.深入理解JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../1.JAVA基础/JVM/2.JVM常见问题.html">
            
                <a href="../1.JAVA基础/JVM/2.JVM常见问题.html">
            
                    
                    2.JVM常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                    并发编程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../1.JAVA基础/并发编程/1.JMM内存模型和volatile.html">
            
                <a href="../1.JAVA基础/并发编程/1.JMM内存模型和volatile.html">
            
                    
                    1.JMM内存模型和volatile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../1.JAVA基础/并发编程/2.CAS.html">
            
                <a href="../1.JAVA基础/并发编程/2.CAS.html">
            
                    
                    2.CAS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../1.JAVA基础/并发编程/3.锁.html">
            
                <a href="../1.JAVA基础/并发编程/3.锁.html">
            
                    
                    3.锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../1.JAVA基础/并发编程/4.CountDownLatch、CyclicBarrier、Semaphore.html">
            
                <a href="../1.JAVA基础/并发编程/4.CountDownLatch、CyclicBarrier、Semaphore.html">
            
                    
                    4.CountDownLatch、CyclicBarrier、Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../1.JAVA基础/并发编程/5.AQS原理以及AQS同步组件.html">
            
                <a href="../1.JAVA基础/并发编程/5.AQS原理以及AQS同步组件.html">
            
                    
                    5.AQS原理以及AQS同步组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../1.JAVA基础/并发编程/6.阻塞队列.html">
            
                <a href="../1.JAVA基础/并发编程/6.阻塞队列.html">
            
                    
                    6.阻塞队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.7" data-path="../1.JAVA基础/并发编程/7.Synchronized与锁升级.html">
            
                <a href="../1.JAVA基础/并发编程/7.Synchronized与锁升级.html">
            
                    
                    7.Synchronized与锁升级
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.8" data-path="../1.JAVA基础/并发编程/8.Synchronized与ReentrantLock.html">
            
                <a href="../1.JAVA基础/并发编程/8.Synchronized与ReentrantLock.html">
            
                    
                    8.Synchronized与ReentrantLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.9" data-path="../1.JAVA基础/并发编程/9.ThreadPoolExecutor.html">
            
                <a href="../1.JAVA基础/并发编程/9.ThreadPoolExecutor.html">
            
                    
                    9.ThreadPoolExecutor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.10" data-path="../1.JAVA基础/并发编程/x.DeadLock.html">
            
                <a href="../1.JAVA基础/并发编程/x.DeadLock.html">
            
                    
                    x.DeadLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.11" data-path="../1.JAVA基础/并发编程/x1.ThreadLocal.html">
            
                <a href="../1.JAVA基础/并发编程/x1.ThreadLocal.html">
            
                    
                    x1.ThreadLocal
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    2.分布式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../2.分布式/1.分布式事务.html">
            
                <a href="../2.分布式/1.分布式事务.html">
            
                    
                    1.分布式事务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    3.Mysql原理
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../3.Mysql原理/1.索引失效和索引优化.html">
            
                <a href="../3.Mysql原理/1.索引失效和索引优化.html">
            
                    
                    1.索引失效和索引优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../3.Mysql原理/2.B+Tree与Innodb.html">
            
                <a href="../3.Mysql原理/2.B+Tree与Innodb.html">
            
                    
                    2.B+Tree与Innodb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../3.Mysql原理/3.Mysql如何实现事务.html">
            
                <a href="../3.Mysql原理/3.Mysql如何实现事务.html">
            
                    
                    3.Mysql如何实现事务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../3.Mysql原理/4.MVCC.html">
            
                <a href="../3.Mysql原理/4.MVCC.html">
            
                    
                    4.MVCC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../3.Mysql原理/5.Mysql脏读、不可重复读、幻读和MVCC.html">
            
                <a href="../3.Mysql原理/5.Mysql脏读、不可重复读、幻读和MVCC.html">
            
                    
                    5.Mysql脏读、不可重复读、幻读和MVCC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../3.Mysql原理/6.Mysql锁.html">
            
                <a href="../3.Mysql原理/6.Mysql锁.html">
            
                    
                    6.Mysql锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../3.Mysql原理/7.Explain.html">
            
                <a href="../3.Mysql原理/7.Explain.html">
            
                    
                    7.Explain
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    4.Redis原理
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    常见问题
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../4.Redis原理/常见问题/1.热key击穿穿透雪崩.html">
            
                <a href="../4.Redis原理/常见问题/1.热key击穿穿透雪崩.html">
            
                    
                    1.热key击穿穿透雪崩
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../4.Redis原理/常见问题/2.redis分布式锁.html">
            
                <a href="../4.Redis原理/常见问题/2.redis分布式锁.html">
            
                    
                    2.redis分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../4.Redis原理/常见问题/3.如何保证缓存一致性.html">
            
                <a href="../4.Redis原理/常见问题/3.如何保证缓存一致性.html">
            
                    
                    3.如何保证缓存一致性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="../4.Redis原理/常见问题/4.过期删除策略和内存淘汰策略.html">
            
                <a href="../4.Redis原理/常见问题/4.过期删除策略和内存淘汰策略.html">
            
                    
                    4.过期删除策略和内存淘汰策略
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <span>
            
                    
                    数据结构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../4.Redis原理/数据结构/1.简单动态字符串.html">
            
                <a href="../4.Redis原理/数据结构/1.简单动态字符串.html">
            
                    
                    1.简单动态字符串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../4.Redis原理/数据结构/2.链表.html">
            
                <a href="../4.Redis原理/数据结构/2.链表.html">
            
                    
                    2.链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../4.Redis原理/数据结构/3.字典.html">
            
                <a href="../4.Redis原理/数据结构/3.字典.html">
            
                    
                    3.字典
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="../4.Redis原理/数据结构/4.跳跃表.html">
            
                <a href="../4.Redis原理/数据结构/4.跳跃表.html">
            
                    
                    4.跳跃表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="../4.Redis原理/数据结构/5.整数集合.html">
            
                <a href="../4.Redis原理/数据结构/5.整数集合.html">
            
                    
                    5.整数集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="../4.Redis原理/数据结构/6.压缩列表.html">
            
                <a href="../4.Redis原理/数据结构/6.压缩列表.html">
            
                    
                    6.压缩列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="../4.Redis原理/数据结构/7.对象.html">
            
                <a href="../4.Redis原理/数据结构/7.对象.html">
            
                    
                    7.对象
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" >
            
                <span>
            
                    
                    核心设计
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../4.Redis原理/核心设计/1.redis核心设计概述.html">
            
                <a href="../4.Redis原理/核心设计/1.redis核心设计概述.html">
            
                    
                    1.redis核心设计概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../4.Redis原理/核心设计/2.redis为什么这么快.html">
            
                <a href="../4.Redis原理/核心设计/2.redis为什么这么快.html">
            
                    
                    2.redis为什么这么快
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3" data-path="../4.Redis原理/核心设计/3.AOF日志.html">
            
                <a href="../4.Redis原理/核心设计/3.AOF日志.html">
            
                    
                    3.AOF日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.4" data-path="../4.Redis原理/核心设计/4.RDB日志.html">
            
                <a href="../4.Redis原理/核心设计/4.RDB日志.html">
            
                    
                    4.RDB日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.5" data-path="../4.Redis原理/核心设计/5.主从库如何保证一致.html">
            
                <a href="../4.Redis原理/核心设计/5.主从库如何保证一致.html">
            
                    
                    5.主从库如何保证一致
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.6" data-path="../4.Redis原理/核心设计/6.哨兵机制.html">
            
                <a href="../4.Redis原理/核心设计/6.哨兵机制.html">
            
                    
                    6.哨兵机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.7" data-path="../4.Redis原理/核心设计/7.哨兵集群.html">
            
                <a href="../4.Redis原理/核心设计/7.哨兵集群.html">
            
                    
                    7.哨兵集群
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    5.MQ
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" >
            
                <span>
            
                    
                    Kafka
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../5.MQ/kafka/1.kafka.html">
            
                <a href="../5.MQ/kafka/1.kafka.html">
            
                    
                    1.kafka
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../5.MQ/1.mq选型.html">
            
                <a href="../5.MQ/1.mq选型.html">
            
                    
                    1.mq选型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../5.MQ/2.如何保证mq的高可用.html">
            
                <a href="../5.MQ/2.如何保证mq的高可用.html">
            
                    
                    2.如何保证mq的高可用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../5.MQ/3.事务性消息.html">
            
                <a href="../5.MQ/3.事务性消息.html">
            
                    
                    3.事务性消息
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    6.Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../6.Spring/1.Spring的Bean的生命周期.html">
            
                <a href="../6.Spring/1.Spring的Bean的生命周期.html">
            
                    
                    1.Spring的Bean的生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../6.Spring/2.Spring的Aop原理.html">
            
                <a href="../6.Spring/2.Spring的Aop原理.html">
            
                    
                    2.Spring的Aop原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../6.Spring/3.三级缓存解决循环依赖.html">
            
                <a href="../6.Spring/3.三级缓存解决循环依赖.html">
            
                    
                    3.三级缓存解决循环依赖
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    7.Netty
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="1.传统IO.html">
            
                <a href="1.传统IO.html">
            
                    
                    1.传统IO
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.2" data-path="2.Netty实战.html">
            
                <a href="2.Netty实战.html">
            
                    
                    2.Netty实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="3.Netty实现rpc.html">
            
                <a href="3.Netty实现rpc.html">
            
                    
                    3.Netty实现rpc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    8.大数据相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" >
            
                <span>
            
                    
                    Flink
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../8.大数据相关/flink/1.docker部署flink.html">
            
                <a href="../8.大数据相关/flink/1.docker部署flink.html">
            
                    
                    1.docker部署flink
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../8.大数据相关/flink/2.运行时架构.html">
            
                <a href="../8.大数据相关/flink/2.运行时架构.html">
            
                    
                    2.运行时架构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" >
            
                <span>
            
                    
                    Hive
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../8.大数据相关/hive/hive基础.html">
            
                <a href="../8.大数据相关/hive/hive基础.html">
            
                    
                    hive基础
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" >
            
                <span>
            
                    
                    实时数仓
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../8.大数据相关/实时数仓/随记1.html">
            
                <a href="../8.大数据相关/实时数仓/随记1.html">
            
                    
                    随记1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    x.问题总结
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../x.问题总结/多线程使用不当OOM排查.html">
            
                <a href="../x.问题总结/多线程使用不当OOM排查.html">
            
                    
                    多线程使用不当OOM排查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../x.问题总结/父子线程公用线程池线上事故.html">
            
                <a href="../x.问题总结/父子线程公用线程池线上事故.html">
            
                    
                    父子线程公用线程池线上事故
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >2.Netty实战</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#netty-&#x6982;&#x8FF0;"><b>1. </b>Netty &#x6982;&#x8FF0;</a></li><ul><li><span class="title-icon "></span><a href="#&#x539F;&#x751F;-nio-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;"><b>1.1. </b>&#x539F;&#x751F; NIO &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</a></li><li><span class="title-icon "></span><a href="#netty-&#x7684;&#x4F18;&#x70B9;"><b>1.2. </b>Netty &#x7684;&#x4F18;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#netty-&#x7248;&#x672C;&#x8BF4;&#x660E;"><b>1.3. </b>Netty &#x7248;&#x672C;&#x8BF4;&#x660E;</a></li></ul><li><span class="title-icon "></span><a href="#netty-&#x9AD8;&#x6027;&#x80FD;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"><b>2. </b>Netty &#x9AD8;&#x6027;&#x80FD;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><b>2.1. </b>&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><li><span class="title-icon "></span><a href="#&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;"><b>2.2. </b>&#x4F20;&#x7EDF;&#x963B;&#x585E; I/O &#x670D;&#x52A1;&#x6A21;&#x578B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;"><b>2.2.1. </b>&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#&#x6A21;&#x578B;&#x7279;&#x70B9;"><b>2.2.2. </b>&#x6A21;&#x578B;&#x7279;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x95EE;&#x9898;&#x5206;&#x6790;"><b>2.2.3. </b>&#x95EE;&#x9898;&#x5206;&#x6790;</a></li></ul><li><span class="title-icon "></span><a href="#reactor-&#x6A21;&#x5F0F;"><b>2.3. </b>Reactor &#x6A21;&#x5F0F;</a></li><ul><li><span class="title-icon "></span><a href="#&#x9488;&#x5BF9;&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;&#x7684;-2-&#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;"><b>2.3.1. </b>&#x9488;&#x5BF9;&#x4F20;&#x7EDF;&#x963B;&#x585E; I/O &#x670D;&#x52A1;&#x6A21;&#x578B;&#x7684; 2 &#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</a></li><li><span class="title-icon "></span><a href="#io-&#x590D;&#x7528;&#x7ED3;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C31;&#x662F;-reactor-&#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;&#x5982;&#x56FE;"><b>2.3.2. </b>I/O &#x590D;&#x7528;&#x7ED3;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C31;&#x662F; Reactor &#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;&#x5982;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#reactor-&#x6A21;&#x5F0F;&#x4E2D;&#x6838;&#x5FC3;&#x7EC4;&#x6210;"><b>2.3.3. </b>Reactor &#x6A21;&#x5F0F;&#x4E2D;&#x6838;&#x5FC3;&#x7EC4;&#x6210;</a></li><li><span class="title-icon "></span><a href="#reactor-&#x6A21;&#x5F0F;&#x5206;&#x7C7B;"><b>2.3.4. </b>Reactor &#x6A21;&#x5F0F;&#x5206;&#x7C7B;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5355;-reactor-&#x5355;&#x7EBF;&#x7A0B;"><b>2.4. </b>&#x5355; Reactor &#x5355;&#x7EBF;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x65B9;&#x6848;&#x8BF4;&#x660E;"><b>2.4.1. </b>&#x65B9;&#x6848;&#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;"><b>2.4.2. </b>&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5355;-reactor-&#x591A;&#x7EBF;&#x7A0B;"><b>2.5. </b>&#x5355; Reactor &#x591A;&#x7EBF;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x65B9;&#x6848;&#x8BF4;&#x660E;_1"><b>2.5.1. </b>&#x65B9;&#x6848;&#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;_1"><b>2.5.2. </b>&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E3B;&#x4ECE;-reactor-&#x591A;&#x7EBF;&#x7A0B;"><b>2.6. </b>&#x4E3B;&#x4ECE; Reactor &#x591A;&#x7EBF;&#x7A0B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;_1"><b>2.6.1. </b>&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x8BF4;&#x660E;"><b>2.6.2. </b>&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x8BF4;&#x660E;</a></li></ul><li><span class="title-icon "></span><a href="#reactor-&#x6A21;&#x5F0F;&#x5C0F;&#x7ED3;"><b>2.7. </b>Reactor &#x6A21;&#x5F0F;&#x5C0F;&#x7ED3;</a></li><ul><li><span class="title-icon "></span><a href="#3-&#x79CD;&#x6A21;&#x5F0F;&#x7528;&#x751F;&#x6D3B;&#x6848;&#x4F8B;&#x6765;&#x7406;&#x89E3;"><b>2.7.1. </b>3 &#x79CD;&#x6A21;&#x5F0F;&#x7528;&#x751F;&#x6D3B;&#x6848;&#x4F8B;&#x6765;&#x7406;&#x89E3;</a></li><li><span class="title-icon "></span><a href="#reactor-&#x6A21;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x70B9;"><b>2.7.2. </b>Reactor &#x6A21;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x70B9;</a></li></ul><li><span class="title-icon "></span><a href="#netty-&#x6A21;&#x578B;"><b>2.8. </b>Netty &#x6A21;&#x578B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;1---&#x7B80;&#x5355;&#x7248;"><b>2.8.1. </b>&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;1 - &#x7B80;&#x5355;&#x7248;</a></li><li><span class="title-icon "></span><a href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;2---&#x8FDB;&#x9636;&#x7248;"><b>2.8.2. </b>&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;2 - &#x8FDB;&#x9636;&#x7248;</a></li><li><span class="title-icon "></span><a href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;3---&#x8BE6;&#x7EC6;&#x7248;"><b>2.8.3. </b>&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;3 - &#x8BE6;&#x7EC6;&#x7248;</a></li><li><span class="title-icon "></span><a href="#netty-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---tcp-&#x670D;&#x52A1;"><b>2.8.4. </b>Netty &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B; - TCP &#x670D;&#x52A1;</a></li><li><span class="title-icon "></span><a href="#&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x7684;-task-&#x6709;-3-&#x79CD;&#x5178;&#x578B;&#x4F7F;&#x7528;&#x573A;&#x666F;"><b>2.8.5. </b>&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x7684; Task &#x6709; 3 &#x79CD;&#x5178;&#x578B;&#x4F7F;&#x7528;&#x573A;&#x666F;</a></li><li><span class="title-icon "></span><a href="#&#x65B9;&#x6848;&#x518D;&#x8BF4;&#x660E;"><b>2.8.6. </b>&#x65B9;&#x6848;&#x518D;&#x8BF4;&#x660E;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5F02;&#x6B65;&#x6A21;&#x578B;"><b>2.9. </b>&#x5F02;&#x6B65;&#x6A21;&#x578B;</a></li><ul><li><span class="title-icon "></span><a href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><b>2.9.1. </b>&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li><li><span class="title-icon "></span><a href="#future-&#x8BF4;&#x660E;"><b>2.9.2. </b>Future &#x8BF4;&#x660E;</a></li><li><span class="title-icon "></span><a href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;"><b>2.9.3. </b>&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#future-listener-&#x673A;&#x5236;"><b>2.9.4. </b>Future-Listener &#x673A;&#x5236;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---http&#x670D;&#x52A1;"><b>2.10. </b>&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B; - HTTP&#x670D;&#x52A1;</a></li><ul><li><span class="title-icon "></span><a href="#testserver"><b>2.10.1. </b>TestServer</a></li><li><span class="title-icon "></span><a href="#testserverinitializer"><b>2.10.2. </b>TestServerInitializer</a></li><li><span class="title-icon "></span><a href="#testhttpserverhandler"><b>2.10.3. </b>TestHttpServerHandler</a></li></ul></ul><li><span class="title-icon "></span><a href="#netty-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;"><b>3. </b>Netty &#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;</a></li><ul><li><span class="title-icon "></span><a href="#bootstrap&#x3001;serverbootstrap"><b>3.1. </b>Bootstrap&#x3001;ServerBootstrap</a></li><li><span class="title-icon "></span><a href="#future&#x3001;channelfuture"><b>3.2. </b>Future&#x3001;ChannelFuture</a></li><li><span class="title-icon "></span><a href="#channel"><b>3.3. </b>Channel</a></li><li><span class="title-icon "></span><a href="#selector"><b>3.4. </b>Selector</a></li><li><span class="title-icon "></span><a href="#channelhandler-&#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;"><b>3.5. </b>ChannelHandler &#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;</a></li><li><span class="title-icon "></span><a href="#pipeline-&#x548C;-channelpipeline"><b>3.6. </b>Pipeline &#x548C; ChannelPipeline</a></li><li><span class="title-icon "></span><a href="#channelhandlercontext"><b>3.7. </b>ChannelHandlerContext</a></li><li><span class="title-icon "></span><a href="#channeloption"><b>3.8. </b>ChannelOption</a></li><li><span class="title-icon "></span><a href="#eventloopgroup-&#x548C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;-nioeventloopgroup"><b>3.9. </b>EventLoopGroup &#x548C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B; NioEventLoopGroup</a></li><li><span class="title-icon "></span><a href="#unpooled-&#x7C7B;"><b>3.10. </b>Unpooled &#x7C7B;</a></li><li><span class="title-icon "></span><a href="#netty-&#x5E94;&#x7528;&#x5B9E;&#x4F8B;-&#x7FA4;&#x804A;&#x7CFB;&#x7EDF;"><b>3.11. </b>Netty &#x5E94;&#x7528;&#x5B9E;&#x4F8B;-&#x7FA4;&#x804A;&#x7CFB;&#x7EDF;</a></li><ul><li><span class="title-icon "></span><a href="#groupchatserver"><b>3.11.1. </b>GroupChatServer</a></li><li><span class="title-icon "></span><a href="#groupchatserverhandler"><b>3.11.2. </b>GroupChatServerHandler</a></li><li><span class="title-icon "></span><a href="#groupchatclient"><b>3.11.3. </b>GroupChatClient</a></li><li><span class="title-icon "></span><a href="#groupchatclienthandler"><b>3.11.4. </b>GroupChatClientHandler</a></li></ul><li><span class="title-icon "></span><a href="#netty-&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;"><b>3.12. </b>Netty &#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;</a></li><ul><li><span class="title-icon "></span><a href="#myserver"><b>3.12.1. </b>MyServer</a></li><li><span class="title-icon "></span><a href="#myserverhandler"><b>3.12.2. </b>MyServerHandler</a></li></ul><li><span class="title-icon "></span><a href="#netty-&#x901A;&#x8FC7;-websocket-&#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;"><b>3.13. </b>Netty &#x901A;&#x8FC7; WebSocket &#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;</a></li><ul><li><span class="title-icon "></span><a href="#myserver_1"><b>3.13.1. </b>MyServer</a></li><li><span class="title-icon "></span><a href="#mytextwebsocketframehandler"><b>3.13.2. </b>MyTextWebSocketFrameHandler</a></li><li><span class="title-icon "></span><a href="#hellohtml"><b>3.13.3. </b>hello.html</a></li></ul></ul></ul></div><a href="#netty-&#x6982;&#x8FF0;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="netty-&#x6982;&#x8FF0;"><a name="netty-&#x6982;&#x8FF0;" class="anchor-navigation-ex-anchor" href="#netty-&#x6982;&#x8FF0;"><i class="fa fa-link" aria-hidden="true"></i></a>1. Netty &#x6982;&#x8FF0;</h1>
<h2 id="&#x539F;&#x751F;-nio-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;"><a name="&#x539F;&#x751F;-nio-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#&#x539F;&#x751F;-nio-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x539F;&#x751F; NIO &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</h2>
<ol>
<li><code>NIO</code> &#x7684;&#x7C7B;&#x5E93;&#x548C; <code>API</code> &#x7E41;&#x6742;&#xFF0C;&#x4F7F;&#x7528;&#x9EBB;&#x70E6;&#xFF1A;&#x9700;&#x8981;&#x719F;&#x7EC3;&#x638C;&#x63E1; <code>Selector</code>&#x3001;<code>ServerSocketChannel</code>&#x3001;<code>SocketChannel</code>&#x3001;<code>ByteBuffer</code>&#x7B49;&#x3002;</li>
<li>&#x9700;&#x8981;&#x5177;&#x5907;&#x5176;&#x4ED6;&#x7684;&#x989D;&#x5916;&#x6280;&#x80FD;&#xFF1A;&#x8981;&#x719F;&#x6089; <code>Java</code> &#x591A;&#x7EBF;&#x7A0B;&#x7F16;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A; <code>NIO</code> &#x7F16;&#x7A0B;&#x6D89;&#x53CA;&#x5230; <code>Reactor</code> &#x6A21;&#x5F0F;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x5BF9;&#x591A;&#x7EBF;&#x7A0B;&#x548C;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x975E;&#x5E38;&#x719F;&#x6089;&#xFF0C;&#x624D;&#x80FD;&#x7F16;&#x5199;&#x51FA;&#x9AD8;&#x8D28;&#x91CF;&#x7684; <code>NIO</code> &#x7A0B;&#x5E8F;&#x3002;</li>
<li>&#x5F00;&#x53D1;&#x5DE5;&#x4F5C;&#x91CF;&#x548C;&#x96BE;&#x5EA6;&#x90FD;&#x975E;&#x5E38;&#x5927;&#xFF1A;&#x4F8B;&#x5982;&#x5BA2;&#x6237;&#x7AEF;&#x9762;&#x4E34;&#x65AD;&#x8FDE;&#x91CD;&#x8FDE;&#x3001;&#x7F51;&#x7EDC;&#x95EA;&#x65AD;&#x3001;&#x534A;&#x5305;&#x8BFB;&#x5199;&#x3001;&#x5931;&#x8D25;&#x7F13;&#x5B58;&#x3001;&#x7F51;&#x7EDC;&#x62E5;&#x585E;&#x548C;&#x5F02;&#x5E38;&#x6D41;&#x7684;&#x5904;&#x7406;&#x7B49;&#x7B49;&#x3002;</li>
<li><code>JDK NIO</code> &#x7684; <code>Bug</code>&#xFF1A;&#x4F8B;&#x5982;&#x81ED;&#x540D;&#x662D;&#x8457;&#x7684; <code>Epoll Bug</code>&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4; <code>Selector</code> &#x7A7A;&#x8F6E;&#x8BE2;&#xFF0C;&#x6700;&#x7EC8;&#x5BFC;&#x81F4; <code>CPU100%</code>&#x3002;&#x76F4;&#x5230; <code>JDK1.7</code> &#x7248;&#x672C;&#x8BE5;&#x95EE;&#x9898;&#x4ECD;&#x65E7;&#x5B58;&#x5728;&#xFF0C;&#x6CA1;&#x6709;&#x88AB;&#x6839;&#x672C;&#x89E3;&#x51B3;&#x3002;</li>
</ol>
<h2 id="netty-&#x7684;&#x4F18;&#x70B9;"><a name="netty-&#x7684;&#x4F18;&#x70B9;" class="anchor-navigation-ex-anchor" href="#netty-&#x7684;&#x4F18;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. Netty &#x7684;&#x4F18;&#x70B9;</h2>
<p><code>Netty</code> &#x5BF9; <code>JDK</code> &#x81EA;&#x5E26;&#x7684; <code>NIO</code> &#x7684; <code>API</code> &#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x4E0A;&#x8FF0;&#x95EE;&#x9898;&#x3002;</p>
<ol>
<li>&#x8BBE;&#x8BA1;&#x4F18;&#x96C5;&#xFF1A;&#x9002;&#x7528;&#x4E8E;&#x5404;&#x79CD;&#x4F20;&#x8F93;&#x7C7B;&#x578B;&#x7684;&#x7EDF;&#x4E00; <code>API</code> &#x963B;&#x585E;&#x548C;&#x975E;&#x963B;&#x585E; <code>Socket</code>&#xFF1B;&#x57FA;&#x4E8E;&#x7075;&#x6D3B;&#x4E14;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x4E8B;&#x4EF6;&#x6A21;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x6E05;&#x6670;&#x5730;&#x5206;&#x79BB;&#x5173;&#x6CE8;&#x70B9;&#xFF1B;&#x9AD8;&#x5EA6;&#x53EF;&#x5B9A;&#x5236;&#x7684;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;-&#x5355;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x3002;</li>
<li>&#x4F7F;&#x7528;&#x65B9;&#x4FBF;&#xFF1A;&#x8BE6;&#x7EC6;&#x8BB0;&#x5F55;&#x7684; <code>Javadoc</code>&#xFF0C;&#x7528;&#x6237;&#x6307;&#x5357;&#x548C;&#x793A;&#x4F8B;&#xFF1B;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x4F9D;&#x8D56;&#x9879;&#xFF0C;<code>JDK5&#xFF08;Netty3.x&#xFF09;</code>&#x6216; <code>6&#xFF08;Netty4.x&#xFF09;</code>&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</li>
<li>&#x9AD8;&#x6027;&#x80FD;&#x3001;&#x541E;&#x5410;&#x91CF;&#x66F4;&#x9AD8;&#xFF1A;&#x5EF6;&#x8FDF;&#x66F4;&#x4F4E;&#xFF1B;&#x51CF;&#x5C11;&#x8D44;&#x6E90;&#x6D88;&#x8017;&#xFF1B;&#x6700;&#x5C0F;&#x5316;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5185;&#x5B58;&#x590D;&#x5236;&#x3002;</li>
<li>&#x5B89;&#x5168;&#xFF1A;&#x5B8C;&#x6574;&#x7684; <code>SSL/TLS</code> &#x548C; <code>StartTLS</code> &#x652F;&#x6301;&#x3002;</li>
<li>&#x793E;&#x533A;&#x6D3B;&#x8DC3;&#x3001;&#x4E0D;&#x65AD;&#x66F4;&#x65B0;&#xFF1A;&#x793E;&#x533A;&#x6D3B;&#x8DC3;&#xFF0C;&#x7248;&#x672C;&#x8FED;&#x4EE3;&#x5468;&#x671F;&#x77ED;&#xFF0C;&#x53D1;&#x73B0;&#x7684; <code>Bug</code> &#x53EF;&#x4EE5;&#x88AB;&#x53CA;&#x65F6;&#x4FEE;&#x590D;&#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x65B0;&#x529F;&#x80FD;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x3002;</li>
</ol>
<h2 id="netty-&#x7248;&#x672C;&#x8BF4;&#x660E;"><a name="netty-&#x7248;&#x672C;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#netty-&#x7248;&#x672C;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Netty &#x7248;&#x672C;&#x8BF4;&#x660E;</h2>
<ol>
<li><code>Netty</code> &#x7248;&#x672C;&#x5206;&#x4E3A; <code>Netty 3.x</code> &#x548C; <code>Netty 4.x</code>&#x3001;<code>Netty 5.x</code></li>
<li>&#x56E0;&#x4E3A; <code>Netty 5</code> &#x51FA;&#x73B0;&#x91CD;&#x5927; <code>bug</code>&#xFF0C;&#x5DF2;&#x7ECF;&#x88AB;&#x5B98;&#x7F51;&#x5E9F;&#x5F03;&#x4E86;&#xFF0C;&#x76EE;&#x524D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Netty 4.x</code>&#x7684;&#x7A33;&#x5B9A;&#x7248;&#x672C;</li>
<li>&#x76EE;&#x524D;&#x5728;&#x5B98;&#x7F51;&#x53EF;&#x4E0B;&#x8F7D;&#x7684;&#x7248;&#x672C; <code>Netty 3.x</code>&#x3001;<code>Netty 4.0.x</code> &#x548C; <code>Netty 4.1.x</code></li>
<li>&#x5728;&#x672C;&#x5957;&#x8BFE;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BB2;&#x89E3; <code>Netty4.1.x</code> &#x7248;&#x672C;</li>
<li><code>Netty</code> &#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href="https://bintray.com/netty/downloads/netty/" target="_blank">https://bintray.com/netty/downloads/netty/</a></li>
</ol>
<h1 id="netty-&#x9AD8;&#x6027;&#x80FD;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"><a name="netty-&#x9AD8;&#x6027;&#x80FD;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;" class="anchor-navigation-ex-anchor" href="#netty-&#x9AD8;&#x6027;&#x80FD;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"><i class="fa fa-link" aria-hidden="true"></i></a>2. Netty &#x9AD8;&#x6027;&#x80FD;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;</h1>
<h2 id="&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><a name="&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</h2>
<ol>
<li>&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x6A21;&#x5F0F;&#xFF0C;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#x6709;&#x5F88;&#x5927;&#x5F71;&#x54CD;&#xFF0C;&#x4E3A;&#x4E86;&#x641E;&#x6E05; <code>Netty</code> &#x7EBF;&#x7A0B;&#x6A21;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x7CFB;&#x7EDF;&#x7684;&#x8BB2;&#x89E3;&#x4E0B;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x6A21;&#x5F0F;&#xFF0C;&#x6700;&#x540E;&#x770B;&#x770B; <code>Netty</code> &#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x6709;&#x4EC0;&#x4E48;&#x4F18;&#x8D8A;&#x6027;&#x3002;</li>
<li>&#x76EE;&#x524D;&#x5B58;&#x5728;&#x7684;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x6709;&#xFF1A;&#x4F20;&#x7EDF;&#x963B;&#x585E; <code>I/O</code> &#x670D;&#x52A1;&#x6A21;&#x578B; &#x548C;<code>Reactor</code> &#x6A21;&#x5F0F;</li>
<li>&#x6839;&#x636E; <code>Reactor</code> &#x7684;&#x6570;&#x91CF;&#x548C;&#x5904;&#x7406;&#x8D44;&#x6E90;&#x6C60;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x540C;&#xFF0C;&#x6709; <code>3</code> &#x79CD;&#x5178;&#x578B;&#x7684;&#x5B9E;&#x73B0;<ul>
<li>&#x5355; <code>Reactor</code> &#x5355;&#x7EBF;&#x7A0B;&#xFF1B;</li>
<li>&#x5355; <code>Reactor</code>&#x591A;&#x7EBF;&#x7A0B;&#xFF1B;</li>
<li>&#x4E3B;&#x4ECE; <code>Reactor</code>&#x591A;&#x7EBF;&#x7A0B;</li>
</ul>
</li>
<li><code>Netty</code> &#x7EBF;&#x7A0B;&#x6A21;&#x5F0F;&#xFF08;<code>Netty</code> &#x4E3B;&#x8981;&#x57FA;&#x4E8E;&#x4E3B;&#x4ECE; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x505A;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x6539;&#x8FDB;&#xFF0C;&#x5176;&#x4E2D;&#x4E3B;&#x4ECE; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x6709;&#x591A;&#x4E2A; <code>Reactor</code>&#xFF09;</li>
</ol>
<h2 id="&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;"><a name="&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x4F20;&#x7EDF;&#x963B;&#x585E; I/O &#x670D;&#x52A1;&#x6A21;&#x578B;</h2>
<h3 id="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;"><a name="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;" class="anchor-navigation-ex-anchor" href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. &#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;</h3>
<ol>
<li>&#x9EC4;&#x8272;&#x7684;&#x6846;&#x8868;&#x793A;&#x5BF9;&#x8C61;&#xFF0C;&#x84DD;&#x8272;&#x7684;&#x6846;&#x8868;&#x793A;&#x7EBF;&#x7A0B;</li>
<li>&#x767D;&#x8272;&#x7684;&#x6846;&#x8868;&#x793A;&#x65B9;&#x6CD5;&#xFF08;<code>API</code>&#xFF09;</li>
</ol>
<h3 id="&#x6A21;&#x578B;&#x7279;&#x70B9;"><a name="&#x6A21;&#x578B;&#x7279;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x6A21;&#x578B;&#x7279;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.2. &#x6A21;&#x578B;&#x7279;&#x70B9;</h3>
<ol>
<li>&#x91C7;&#x7528;&#x963B;&#x585E; <code>IO</code> &#x6A21;&#x5F0F;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x7684;&#x6570;&#x636E;</li>
<li>&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x90FD;&#x9700;&#x8981;&#x72EC;&#x7ACB;&#x7684;&#x7EBF;&#x7A0B;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#xFF0C;&#x6570;&#x636E;&#x8FD4;&#x56DE;</li>
</ol>
<h3 id="&#x95EE;&#x9898;&#x5206;&#x6790;"><a name="&#x95EE;&#x9898;&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#&#x95EE;&#x9898;&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.3. &#x95EE;&#x9898;&#x5206;&#x6790;</h3>
<ol>
<li>&#x5F53;&#x5E76;&#x53D1;&#x6570;&#x5F88;&#x5927;&#xFF0C;&#x5C31;&#x4F1A;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5360;&#x7528;&#x5F88;&#x5927;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;</li>
<li>&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x53EF;&#x8BFB;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x4F1A;&#x963B;&#x585E;&#x5728; Handler&#x5BF9;&#x8C61;&#x4E2D;&#x7684;<code>read</code> &#x64CD;&#x4F5C;&#xFF0C;&#x5BFC;&#x81F4;&#x4E0A;&#x9762;&#x7684;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;</li>
</ol>
<p><img src="../img/netty23.png" alt=""></p>
<h2 id="reactor-&#x6A21;&#x5F0F;"><a name="reactor-&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#reactor-&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. Reactor &#x6A21;&#x5F0F;</h2>
<h3 id="&#x9488;&#x5BF9;&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;&#x7684;-2-&#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;"><a name="&#x9488;&#x5BF9;&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;&#x7684;-2-&#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x9488;&#x5BF9;&#x4F20;&#x7EDF;&#x963B;&#x585E;-io-&#x670D;&#x52A1;&#x6A21;&#x578B;&#x7684;-2-&#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. &#x9488;&#x5BF9;&#x4F20;&#x7EDF;&#x963B;&#x585E; I/O &#x670D;&#x52A1;&#x6A21;&#x578B;&#x7684; 2 &#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</h3>
<p>&#x57FA;&#x4E8E; <code>I/O</code> &#x590D;&#x7528;&#x6A21;&#x578B;&#xFF1A;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x5171;&#x7528;&#x4E00;&#x4E2A;&#x963B;&#x585E;&#x5BF9;&#x8C61;<code>ServiceHandler</code>&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EA;&#x9700;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x963B;&#x585E;&#x5BF9;&#x8C61;&#x7B49;&#x5F85;&#xFF0C;&#x65E0;&#x9700;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x3002;&#x5F53;&#x67D0;&#x4E2A;&#x8FDE;&#x63A5;&#x6709;&#x65B0;&#x7684;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x65F6;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x901A;&#x77E5;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x7EBF;&#x7A0B;&#x4ECE;&#x963B;&#x585E;&#x72B6;&#x6001;&#x8FD4;&#x56DE;&#xFF0C;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x3002;</p>
<p> <code>Reactor</code> &#x5728;&#x4E0D;&#x540C;&#x4E66;&#x4E2D;&#x7684;&#x53EB;&#x6CD5;&#xFF1A;</p>
<ol>
<li>&#x53CD;&#x5E94;&#x5668;&#x6A21;&#x5F0F; </li>
<li>&#x5206;&#x53D1;&#x8005;&#x6A21;&#x5F0F;&#xFF08;Dispatcher&#xFF09;</li>
<li><p>&#x901A;&#x77E5;&#x8005;&#x6A21;&#x5F0F;&#xFF08;notifier&#xFF09;</p>
</li>
<li><p>&#x57FA;&#x4E8E;&#x7EBF;&#x7A0B;&#x6C60;&#x590D;&#x7528;&#x7EBF;&#x7A0B;&#x8D44;&#x6E90;&#xFF1A;&#x4E0D;&#x5FC5;&#x518D;&#x4E3A;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C06;&#x8FDE;&#x63A5;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x5206;&#x914D;&#x7ED9;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x4E1A;&#x52A1;&#x3002;&#xFF08;&#x89E3;&#x51B3;&#x4E86;&#x5F53;&#x5E76;&#x53D1;&#x6570;&#x5F88;&#x5927;&#x65F6;&#xFF0C;&#x4F1A;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x7EBF;&#x7A0B;&#xFF0C;&#x5360;&#x7528;&#x5F88;&#x5927;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#xFF09;</p>
</li>
<li>&#x57FA;&#x4E8E; <code>I/O</code> &#x590D;&#x7528;&#x6A21;&#x578B;&#xFF1A;&#x591A;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#xFF0C;&#x5148;&#x628A;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7ED9;<code>ServiceHandler</code>&#x3002;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x5171;&#x7528;&#x4E00;&#x4E2A;&#x963B;&#x585E;&#x5BF9;&#x8C61;<code>ServiceHandler</code>&#x3002;&#x5047;&#x8BBE;&#xFF0C;&#x5F53;C1&#x8FDE;&#x63A5;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x8981;&#x5904;&#x7406;&#x65F6;&#xFF0C;C1&#x5BA2;&#x6237;&#x7AEF;&#x53EA;&#x9700;&#x8981;&#x963B;&#x585E;&#x4E8E;<code>ServiceHandler</code>&#xFF0C;C1&#x4E4B;&#x524D;&#x7684;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x4FBF;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x6709;&#x6570;&#x636E;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x7EBF;&#x7A0B;&#x8D44;&#x6E90;&#x7684;&#x6D6A;&#x8D39;&#x3002;&#x5F53;C1&#x8FDE;&#x63A5;&#x518D;&#x6B21;&#x6709;&#x6570;&#x636E;&#x65F6;&#xFF0C;<code>ServiceHandler</code>&#x6839;&#x636E;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#xFF0C;&#x5C06;&#x8BF7;&#x6C42;&#x5206;&#x53D1;&#x7ED9;&#x7A7A;&#x95F2;&#x7684;&#x7EBF;&#x7A0B;&#x6765;&#x5904;&#x7406;C1&#x8FDE;&#x63A5;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#xFF08;&#x89E3;&#x51B3;&#x4E86;&#x7EBF;&#x7A0B;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;&#x7684;&#x90A3;&#x4E2A;&#x95EE;&#x9898;&#xFF09;</li>
</ol>
<p><img src="../img/netty24.png" alt=""></p>
<h3 id="io-&#x590D;&#x7528;&#x7ED3;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C31;&#x662F;-reactor-&#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;&#x5982;&#x56FE;"><a name="io-&#x590D;&#x7528;&#x7ED3;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C31;&#x662F;-reactor-&#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;&#x5982;&#x56FE;" class="anchor-navigation-ex-anchor" href="#io-&#x590D;&#x7528;&#x7ED3;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C31;&#x662F;-reactor-&#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;&#x5982;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.2. I/O &#x590D;&#x7528;&#x7ED3;&#x5408;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5C31;&#x662F; Reactor &#x6A21;&#x5F0F;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;&#x5982;&#x56FE;</h3>
<p><img src="../img/netty25.png" alt=""></p>
<p>&#x5BF9;&#x4E0A;&#x56FE;&#x8BF4;&#x660E;&#xFF1A;</p>
<ol>
<li><code>Reactor</code> &#x6A21;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8F93;&#x5165;&#x540C;&#x65F6;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x5904;&#x7406;&#x5668;&#xFF08;ServiceHandler&#xFF09;&#x7684;&#x6A21;&#x5F0F;&#xFF08;&#x57FA;&#x4E8E;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#xFF09;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7A0B;&#x5E8F;&#x5904;&#x7406;&#x4F20;&#x5165;&#x7684;&#x591A;&#x4E2A;&#x8BF7;&#x6C42;,&#x5E76;&#x5C06;&#x5B83;&#x4EEC;&#x540C;&#x6B65;&#x5206;&#x6D3E;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64; <code>Reactor</code> &#x6A21;&#x5F0F;&#x4E5F;&#x53EB; <code>Dispatcher</code> &#x6A21;&#x5F0F;</li>
<li><code>Reactor</code> &#x6A21;&#x5F0F;&#x4F7F;&#x7528; <code>IO</code> &#x590D;&#x7528;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#xFF0C;&#x6536;&#x5230;&#x4E8B;&#x4EF6;&#x540E;&#xFF0C;&#x5206;&#x53D1;&#x7ED9;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF08;&#x8FDB;&#x7A0B;&#xFF09;&#xFF0C;&#x8FD9;&#x70B9;&#x5C31;&#x662F;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x5668;&#x9AD8;&#x5E76;&#x53D1;&#x5904;&#x7406;&#x5173;&#x952E;</li>
</ol>
<blockquote>
<p>&#x539F;&#x5148;&#x6709;&#x591A;&#x4E2A;Handler&#x963B;&#x585E;&#xFF0C;&#x73B0;&#x5728;&#x53EA;&#x7528;&#x4E00;&#x4E2A;ServiceHandler&#x963B;&#x585E;</p>
</blockquote>
<h3 id="reactor-&#x6A21;&#x5F0F;&#x4E2D;&#x6838;&#x5FC3;&#x7EC4;&#x6210;"><a name="reactor-&#x6A21;&#x5F0F;&#x4E2D;&#x6838;&#x5FC3;&#x7EC4;&#x6210;" class="anchor-navigation-ex-anchor" href="#reactor-&#x6A21;&#x5F0F;&#x4E2D;&#x6838;&#x5FC3;&#x7EC4;&#x6210;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.3. Reactor &#x6A21;&#x5F0F;&#x4E2D;&#x6838;&#x5FC3;&#x7EC4;&#x6210;</h3>
<ol>
<li><code>Reactor&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x90A3;&#x4E2A;ServiceHandler&#xFF09;</code>&#xFF1A;<code>Reactor</code> &#x5728;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x8D1F;&#x8D23;&#x76D1;&#x542C;&#x548C;&#x5206;&#x53D1;&#x4E8B;&#x4EF6;&#xFF0C;&#x5206;&#x53D1;&#x7ED9;&#x9002;&#x5F53;&#x7684;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x6765;&#x5BF9; <code>IO</code> &#x4E8B;&#x4EF6;&#x505A;&#x51FA;&#x53CD;&#x5E94;&#x3002;&#x5B83;&#x5C31;&#x50CF;&#x516C;&#x53F8;&#x7684;&#x7535;&#x8BDD;&#x63A5;&#x7EBF;&#x5458;&#xFF0C;&#x5B83;&#x63A5;&#x542C;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x7684;&#x7535;&#x8BDD;&#x5E76;&#x5C06;&#x7EBF;&#x8DEF;&#x8F6C;&#x79FB;&#x5230;&#x9002;&#x5F53;&#x7684;&#x8054;&#x7CFB;&#x4EBA;&#xFF1B;</li>
<li><code>Handlers&#xFF08;&#x5904;&#x7406;&#x7EBF;&#x7A0B;EventHandler&#xFF09;</code>&#xFF1A;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x6267;&#x884C; <code>I/O</code> &#x4E8B;&#x4EF6;&#x8981;&#x5B8C;&#x6210;&#x7684;&#x5B9E;&#x9645;&#x4E8B;&#x4EF6;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x5BA2;&#x6237;&#x60F3;&#x8981;&#x4E0E;&#x4E4B;&#x4EA4;&#x8C08;&#x7684;&#x516C;&#x53F8;&#x4E2D;&#x7684;&#x5B9E;&#x9645;&#x5B98;&#x5458;&#x3002;<code>Reactor</code> &#x901A;&#x8FC7;&#x8C03;&#x5EA6;&#x9002;&#x5F53;&#x7684;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x6765;&#x54CD;&#x5E94; <code>I/O</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x975E;&#x963B;&#x585E;&#x64CD;&#x4F5C;&#x3002;</li>
</ol>
<h3 id="reactor-&#x6A21;&#x5F0F;&#x5206;&#x7C7B;"><a name="reactor-&#x6A21;&#x5F0F;&#x5206;&#x7C7B;" class="anchor-navigation-ex-anchor" href="#reactor-&#x6A21;&#x5F0F;&#x5206;&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.4. Reactor &#x6A21;&#x5F0F;&#x5206;&#x7C7B;</h3>
<p>&#x6839;&#x636E; <code>Reactor</code> &#x7684;&#x6570;&#x91CF;&#x548C;&#x5904;&#x7406;&#x8D44;&#x6E90;&#x6C60;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#x4E0D;&#x540C;&#xFF0C;&#x6709; <code>3</code> &#x79CD;&#x5178;&#x578B;&#x7684;&#x5B9E;&#x73B0;</p>
<ol>
<li>&#x5355; <code>Reactor</code> &#x5355;&#x7EBF;&#x7A0B;</li>
<li>&#x5355; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;</li>
<li>&#x4E3B;&#x4ECE; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;</li>
</ol>
<h2 id="&#x5355;-reactor-&#x5355;&#x7EBF;&#x7A0B;"><a name="&#x5355;-reactor-&#x5355;&#x7EBF;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x5355;-reactor-&#x5355;&#x7EBF;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. &#x5355; Reactor &#x5355;&#x7EBF;&#x7A0B;</h2>
<p>&#x539F;&#x7406;&#x56FE;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; <code>NIO</code> &#x7FA4;&#x804A;&#x7CFB;&#x7EDF;&#x9A8C;&#x8BC1;</p>
<p><img src="../img/netty26.png" alt=""></p>
<h3 id="&#x65B9;&#x6848;&#x8BF4;&#x660E;"><a name="&#x65B9;&#x6848;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6848;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.1. &#x65B9;&#x6848;&#x8BF4;&#x660E;</h3>
<ol>
<li><code>Select</code> &#x662F;&#x524D;&#x9762; <code>I/O</code> &#x590D;&#x7528;&#x6A21;&#x578B;&#x4ECB;&#x7ECD;&#x7684;&#x6807;&#x51C6;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B; <code>API</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x963B;&#x585E;&#x5BF9;&#x8C61;&#x76D1;&#x542C;&#x591A;&#x8DEF;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</li>
<li><code>Reactor</code> &#x5BF9;&#x8C61;&#x901A;&#x8FC7; <code>Select</code> &#x76D1;&#x63A7;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x4E8B;&#x4EF6;&#xFF0C;&#x6536;&#x5230;&#x4E8B;&#x4EF6;&#x540E;&#x901A;&#x8FC7; <code>Dispatch</code> &#x8FDB;&#x884C;&#x5206;&#x53D1;</li>
<li>&#x5982;&#x679C;&#x662F;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x4E8B;&#x4EF6;&#xFF0C;&#x5219;&#x7531; <code>Acceptor</code> &#x901A;&#x8FC7; <code>Accept</code> &#x5904;&#x7406;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>Handler</code> &#x5BF9;&#x8C61;&#x5904;&#x7406;&#x8FDE;&#x63A5;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x540E;&#x7EED;&#x4E1A;&#x52A1;&#x5904;&#x7406;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;&#xFF0C;&#x5219; <code>Reactor</code> &#x4F1A;&#x5206;&#x53D1;&#x8C03;&#x7528;&#x8FDE;&#x63A5;&#x5BF9;&#x5E94;&#x7684; <code>Handler</code> &#x6765;&#x54CD;&#x5E94;</li>
<li><code>Handler</code> &#x4F1A;&#x5B8C;&#x6210; <code>Read</code> &#x2192; &#x4E1A;&#x52A1;&#x5904;&#x7406; &#x2192; <code>Send</code> &#x7684;&#x5B8C;&#x6574;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;</li>
</ol>
<p>&#x7ED3;&#x5408;&#x5B9E;&#x4F8B;&#xFF1A;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7528;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x901A;&#x8FC7;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x641E;&#x5B9A;&#x6240;&#x6709;&#x7684; <code>IO</code> &#x64CD;&#x4F5C;&#xFF08;&#x5305;&#x62EC;&#x8FDE;&#x63A5;&#xFF0C;&#x8BFB;&#x3001;&#x5199;&#x7B49;&#xFF09;&#xFF0C;&#x7F16;&#x7801;&#x7B80;&#x5355;&#xFF0C;&#x6E05;&#x6670;&#x660E;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x6570;&#x91CF;&#x8F83;&#x591A;&#xFF0C;&#x5C06;&#x65E0;&#x6CD5;&#x652F;&#x6491;&#xFF0C;&#x524D;&#x9762;&#x7684; <code>NIO</code> &#x6848;&#x4F8B;&#x5C31;&#x5C5E;&#x4E8E;&#x8FD9;&#x79CD;&#x6A21;&#x578B;&#x3002;</p>
<h3 id="&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;"><a name="&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.2. &#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;</h3>
<ol>
<li>&#x4F18;&#x70B9;&#xFF1A;&#x6A21;&#x578B;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x591A;&#x7EBF;&#x7A0B;&#x3001;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x3001;&#x7ADE;&#x4E89;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5168;&#x90E8;&#x90FD;&#x5728;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x5B8C;&#x6210;</li>
<li>&#x7F3A;&#x70B9;&#xFF1A;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x65E0;&#x6CD5;&#x5B8C;&#x5168;&#x53D1;&#x6325;&#x591A;&#x6838; <code>CPU</code> &#x7684;&#x6027;&#x80FD;&#x3002;<code>Handler</code>&#x5728;&#x5904;&#x7406;&#x67D0;&#x4E2A;&#x8FDE;&#x63A5;&#x4E0A;&#x7684;&#x4E1A;&#x52A1;&#x65F6;&#xFF0C;&#x6574;&#x4E2A;&#x8FDB;&#x7A0B;&#x65E0;&#x6CD5;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x6027;&#x80FD;&#x74F6;&#x9888;</li>
<li>&#x7F3A;&#x70B9;&#xFF1A;&#x53EF;&#x9760;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x7EBF;&#x7A0B;&#x610F;&#x5916;&#x7EC8;&#x6B62;&#xFF0C;&#x6216;&#x8005;&#x8FDB;&#x5165;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x901A;&#x4FE1;&#x6A21;&#x5757;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x4E0D;&#x80FD;&#x63A5;&#x6536;&#x548C;&#x5904;&#x7406;&#x5916;&#x90E8;&#x6D88;&#x606F;&#xFF0C;&#x9020;&#x6210;&#x8282;&#x70B9;&#x6545;&#x969C;</li>
<li>&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x91CF;&#x6709;&#x9650;&#xFF0C;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x975E;&#x5E38;&#x5FEB;&#x901F;&#xFF0C;&#x6BD4;&#x5982; <code>Redis</code> &#x5728;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6; <code>O(1)</code> &#x7684;&#x60C5;&#x51B5;</li>
</ol>
<h2 id="&#x5355;-reactor-&#x591A;&#x7EBF;&#x7A0B;"><a name="&#x5355;-reactor-&#x591A;&#x7EBF;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x5355;-reactor-&#x591A;&#x7EBF;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. &#x5355; Reactor &#x591A;&#x7EBF;&#x7A0B;</h2>
<h3 id="&#x65B9;&#x6848;&#x8BF4;&#x660E;_1"><a name="&#x65B9;&#x6848;&#x8BF4;&#x660E;_1" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6848;&#x8BF4;&#x660E;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.1. &#x65B9;&#x6848;&#x8BF4;&#x660E;</h3>
<p><img src="../img/netty27.png" alt=""></p>
<ol>
<li><code>Reactor</code> &#x5BF9;&#x8C61;&#x901A;&#x8FC7; <code>Select</code> &#x76D1;&#x63A7;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x4E8B;&#x4EF6;&#xFF0C;&#x6536;&#x5230;&#x4E8B;&#x4EF6;&#x540E;&#xFF0C;&#x901A;&#x8FC7; <code>Dispatch</code> &#x8FDB;&#x884C;&#x5206;&#x53D1;</li>
<li>&#x5982;&#x679C;&#x662F;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x7531; <code>Acceptor</code> &#x901A;&#x8FC7; <code>accept</code> &#x5904;&#x7406;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>Handler</code> &#x5BF9;&#x8C61;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x8FDE;&#x63A5;&#x540E;&#x7684;&#x5404;&#x79CD;&#x4E8B;&#x4EF6;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x662F;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x7531; <code>Reactor</code> &#x5206;&#x53D1;&#x8C03;&#x7528;&#x8FDE;&#x63A5;&#x5BF9;&#x5E94;&#x7684; <code>handler</code> &#x6765;&#x5904;&#x7406;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8FDE;&#x63A5;&#x5DF2;&#x7ECF;&#x5EFA;&#x7ACB;&#xFF0C;&#x540E;&#x7EED;&#x5BA2;&#x6237;&#x7AEF;&#x518D;&#x6765;&#x8BF7;&#x6C42;&#xFF0C;&#x90A3;&#x57FA;&#x672C;&#x5C31;&#x662F;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#x4E3A;&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x597D;&#x7684;handler&#x6765;&#x5904;&#x7406;&#xFF09;</li>
<li><code>handler</code> &#x53EA;&#x8D1F;&#x8D23;&#x54CD;&#x5E94;&#x4E8B;&#x4EF6;&#xFF0C;&#x4E0D;&#x505A;&#x5177;&#x4F53;&#x7684;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#xFF08;&#x8FD9;&#x6837;&#x4E0D;&#x4F1A;&#x4F7F;handler&#x963B;&#x585E;&#x592A;&#x4E45;&#xFF09;&#xFF0C;&#x901A;&#x8FC7; <code>read</code> &#x8BFB;&#x53D6;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x4F1A;&#x5206;&#x53D1;&#x7ED9;&#x540E;&#x9762;&#x7684; <code>worker</code> &#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x4E1A;&#x52A1;&#x3002;&#x3010;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x662F;&#x6700;&#x8D39;&#x65F6;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5C06;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x53BB;&#x6267;&#x884C;&#x3011;</li>
<li><code>worker</code> &#x7EBF;&#x7A0B;&#x6C60;&#x4F1A;&#x5206;&#x914D;&#x72EC;&#x7ACB;&#x7EBF;&#x7A0B;&#x5B8C;&#x6210;&#x771F;&#x6B63;&#x7684;&#x4E1A;&#x52A1;&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9; <code>handler</code></li>
<li><code>handler</code> &#x6536;&#x5230;&#x54CD;&#x5E94;&#x540E;&#xFF0C;&#x901A;&#x8FC7; <code>send</code> &#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9; <code>client</code></li>
</ol>
<h3 id="&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;_1"><a name="&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;_1" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.2. &#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x5206;&#x6790;</h3>
<ol>
<li>&#x4F18;&#x70B9;&#xFF1A;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x7684;&#x5229;&#x7528;&#x591A;&#x6838; <code>cpu</code> &#x7684;&#x5904;&#x7406;&#x80FD;&#x529B;</li>
<li>&#x7F3A;&#x70B9;&#xFF1A;&#x591A;&#x7EBF;&#x7A0B;&#x6570;&#x636E;&#x5171;&#x4EAB;&#x548C;&#x8BBF;&#x95EE;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x3002;<code>Reactor</code> &#x627F;&#x62C5;&#x6240;&#x6709;&#x7684;&#x4E8B;&#x4EF6;&#x7684;&#x76D1;&#x542C;&#x548C;&#x54CD;&#x5E94;&#xFF0C;&#x5B83;&#x662F;&#x5355;&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;&#xFF0C;&#x5728;&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x6027;&#x80FD;&#x74F6;&#x9888;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;<code>Reactor</code>&#x4E3B;&#x7EBF;&#x7A0B;&#x627F;&#x62C5;&#x4E86;&#x8FC7;&#x591A;&#x7684;&#x4E8B;</li>
</ol>
<h2 id="&#x4E3B;&#x4ECE;-reactor-&#x591A;&#x7EBF;&#x7A0B;"><a name="&#x4E3B;&#x4ECE;-reactor-&#x591A;&#x7EBF;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x4E3B;&#x4ECE;-reactor-&#x591A;&#x7EBF;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. &#x4E3B;&#x4ECE; Reactor &#x591A;&#x7EBF;&#x7A0B;</h2>
<h3 id="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;_1"><a name="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;_1" class="anchor-navigation-ex-anchor" href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.6.1. &#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x56FE;</h3>
<p>&#x9488;&#x5BF9;&#x5355; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x4E2D;&#xFF0C;<code>Reactor</code> &#x5728;&#x5355;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x4E0B;&#x5BB9;&#x6613;&#x6210;&#x4E3A;&#x6027;&#x80FD;&#x74F6;&#x9888;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9; <code>Reactor</code> &#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;</p>
<p><img src="../img/netty28.png" alt=""></p>
<p><img src="../img/netty29.png" alt=""></p>
<blockquote>
<p>SubReactor&#x662F;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;SubReactor&#x7684;&#x8BDD;&#x90A3;&#x548C;<code>&#x5355; Reactor &#x591A;&#x7EBF;&#x7A0B;</code>&#x5C31;&#x6CA1;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x4E86;&#x3002;</p>
</blockquote>
<ol>
<li><code>Reactor</code> &#x4E3B;&#x7EBF;&#x7A0B; <code>MainReactor</code> &#x5BF9;&#x8C61;&#x901A;&#x8FC7; <code>select</code> &#x76D1;&#x542C;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;&#xFF0C;&#x6536;&#x5230;&#x4E8B;&#x4EF6;&#x540E;&#xFF0C;&#x901A;&#x8FC7; <code>Acceptor</code> &#x5904;&#x7406;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;</li>
<li>&#x5F53; <code>Acceptor</code> &#x5904;&#x7406;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;&#x540E;&#xFF0C;<code>MainReactor</code> &#x5C06;&#x8FDE;&#x63A5;&#x5206;&#x914D;&#x7ED9; <code>SubReactor</code></li>
<li><code>subreactor</code> &#x5C06;&#x8FDE;&#x63A5;&#x52A0;&#x5165;&#x5230;&#x8FDE;&#x63A5;&#x961F;&#x5217;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#xFF0C;&#x5E76;&#x521B;&#x5EFA; <code>handler</code> &#x8FDB;&#x884C;&#x5404;&#x79CD;&#x4E8B;&#x4EF6;&#x5904;&#x7406;</li>
<li>&#x5F53;&#x6709;&#x65B0;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;<code>subreactor</code> &#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684; <code>handler</code> &#x5904;&#x7406;</li>
<li><code>handler</code> &#x901A;&#x8FC7; <code>read</code> &#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5206;&#x53D1;&#x7ED9;&#x540E;&#x9762;&#x7684; <code>worker</code> &#x7EBF;&#x7A0B;&#x5904;&#x7406;</li>
<li><code>worker</code> &#x7EBF;&#x7A0B;&#x6C60;&#x5206;&#x914D;&#x72EC;&#x7ACB;&#x7684; <code>worker</code> &#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>
<li><code>handler</code> &#x6536;&#x5230;&#x54CD;&#x5E94;&#x7684;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x518D;&#x901A;&#x8FC7; <code>send</code> &#x5C06;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9; <code>client</code> </li>
<li><code>Reactor</code> &#x4E3B;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x591A;&#x4E2A; <code>Reactor</code> &#x5B50;&#x7EBF;&#x7A0B;&#xFF0C;&#x5373; <code>MainRecator</code> &#x53EF;&#x4EE5;&#x5173;&#x8054;&#x591A;&#x4E2A; <code>SubReactor</code></li>
</ol>
<h3 id="&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x8BF4;&#x660E;"><a name="&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6.2. &#x65B9;&#x6848;&#x4F18;&#x7F3A;&#x70B9;&#x8BF4;&#x660E;</h3>
<ol>
<li>&#x4F18;&#x70B9;&#xFF1A;&#x7236;&#x7EBF;&#x7A0B;&#x4E0E;&#x5B50;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x7B80;&#x5355;&#x804C;&#x8D23;&#x660E;&#x786E;&#xFF0C;&#x7236;&#x7EBF;&#x7A0B;&#x53EA;&#x9700;&#x8981;&#x63A5;&#x6536;&#x65B0;&#x8FDE;&#x63A5;&#xFF0C;&#x5B50;&#x7EBF;&#x7A0B;&#x5B8C;&#x6210;&#x540E;&#x7EED;&#x7684;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x3002;</li>
<li>&#x4F18;&#x70B9;&#xFF1A;&#x7236;&#x7EBF;&#x7A0B;&#x4E0E;&#x5B50;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x7B80;&#x5355;&#xFF0C;<code>Reactor</code> &#x4E3B;&#x7EBF;&#x7A0B;&#x53EA;&#x9700;&#x8981;&#x628A;&#x65B0;&#x8FDE;&#x63A5;&#x4F20;&#x7ED9;&#x5B50;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B50;&#x7EBF;&#x7A0B;&#x65E0;&#x9700;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x3002;</li>
<li>&#x7F3A;&#x70B9;&#xFF1A;&#x7F16;&#x7A0B;&#x590D;&#x6742;&#x5EA6;&#x8F83;&#x9AD8;</li>
</ol>
<p>&#x7ED3;&#x5408;&#x5B9E;&#x4F8B;&#xFF1A;&#x8FD9;&#x79CD;&#x6A21;&#x578B;&#x5728;&#x8BB8;&#x591A;&#x9879;&#x76EE;&#x4E2D;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#xFF0C;&#x5305;&#x62EC; <code>Nginx</code> &#x4E3B;&#x4ECE; <code>Reactor</code> &#x591A;&#x8FDB;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;<code>Memcached</code> &#x4E3B;&#x4ECE;&#x591A;&#x7EBF;&#x7A0B;&#xFF0C;<code>Netty</code> &#x4E3B;&#x4ECE;&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x7684;&#x652F;&#x6301;</p>
<h2 id="reactor-&#x6A21;&#x5F0F;&#x5C0F;&#x7ED3;"><a name="reactor-&#x6A21;&#x5F0F;&#x5C0F;&#x7ED3;" class="anchor-navigation-ex-anchor" href="#reactor-&#x6A21;&#x5F0F;&#x5C0F;&#x7ED3;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. Reactor &#x6A21;&#x5F0F;&#x5C0F;&#x7ED3;</h2>
<h3 id="3-&#x79CD;&#x6A21;&#x5F0F;&#x7528;&#x751F;&#x6D3B;&#x6848;&#x4F8B;&#x6765;&#x7406;&#x89E3;"><a name="3-&#x79CD;&#x6A21;&#x5F0F;&#x7528;&#x751F;&#x6D3B;&#x6848;&#x4F8B;&#x6765;&#x7406;&#x89E3;" class="anchor-navigation-ex-anchor" href="#3-&#x79CD;&#x6A21;&#x5F0F;&#x7528;&#x751F;&#x6D3B;&#x6848;&#x4F8B;&#x6765;&#x7406;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7.1. 3 &#x79CD;&#x6A21;&#x5F0F;&#x7528;&#x751F;&#x6D3B;&#x6848;&#x4F8B;&#x6765;&#x7406;&#x89E3;</h3>
<ol>
<li>&#x5355; <code>Reactor</code> &#x5355;&#x7EBF;&#x7A0B;&#xFF0C;&#x524D;&#x53F0;&#x63A5;&#x5F85;&#x5458;&#x548C;&#x670D;&#x52A1;&#x5458;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x4EBA;&#xFF0C;&#x5168;&#x7A0B;&#x4E3A;&#x987E;&#x5BA2;&#x670D;</li>
<li>&#x5355; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;&#xFF0C;<code>1</code> &#x4E2A;&#x524D;&#x53F0;&#x63A5;&#x5F85;&#x5458;&#xFF0C;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x5458;&#xFF0C;&#x63A5;&#x5F85;&#x5458;&#x53EA;&#x8D1F;&#x8D23;&#x63A5;&#x5F85;</li>
<li>&#x4E3B;&#x4ECE; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;&#xFF0C;&#x591A;&#x4E2A;&#x524D;&#x53F0;&#x63A5;&#x5F85;&#x5458;&#xFF0C;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x751F;</li>
</ol>
<h3 id="reactor-&#x6A21;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x70B9;"><a name="reactor-&#x6A21;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x70B9;" class="anchor-navigation-ex-anchor" href="#reactor-&#x6A21;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7.2. Reactor &#x6A21;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x4F18;&#x70B9;</h3>
<ol>
<li>&#x54CD;&#x5E94;&#x5FEB;&#xFF0C;&#x4E0D;&#x5FC5;&#x4E3A;&#x5355;&#x4E2A;&#x540C;&#x6B65;&#x65F6;&#x95F4;&#x6240;&#x963B;&#x585E;&#xFF0C;&#x867D;&#x7136; <code>Reactor</code> &#x672C;&#x8EAB;&#x4F9D;&#x7136;&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF08;&#x6BD4;&#x5982;&#x4F60;&#x7B2C;&#x4E00;&#x4E2A;SubReactor&#x963B;&#x585E;&#x4E86;&#xFF0C;&#x6211;&#x53EF;&#x4EE5;&#x8C03;&#x4E0B;&#x4E00;&#x4E2A; SubReactor&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x670D;&#x52A1;&#xFF09;</li>
<li>&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x907F;&#x514D;&#x590D;&#x6742;&#x7684;&#x591A;&#x7EBF;&#x7A0B;&#x53CA;&#x540C;&#x6B65;&#x95EE;&#x9898;&#xFF0C;&#x5E76;&#x4E14;&#x907F;&#x514D;&#x4E86;&#x591A;&#x7EBF;&#x7A0B;/&#x8FDB;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x5F00;&#x9500;</li>
<li>&#x6269;&#x5C55;&#x6027;&#x597D;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x901A;&#x8FC7;&#x589E;&#x52A0; <code>Reactor</code> &#x5B9E;&#x4F8B;&#x4E2A;&#x6570;&#x6765;&#x5145;&#x5206;&#x5229;&#x7528; <code>CPU</code> &#x8D44;&#x6E90;</li>
<li>&#x590D;&#x7528;&#x6027;&#x597D;&#xFF0C;<code>Reactor</code> &#x6A21;&#x578B;&#x672C;&#x8EAB;&#x4E0E;&#x5177;&#x4F53;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x903B;&#x8F91;&#x65E0;&#x5173;&#xFF0C;&#x5177;&#x6709;&#x5F88;&#x9AD8;&#x7684;&#x590D;&#x7528;&#x6027;</li>
</ol>
<h2 id="netty-&#x6A21;&#x578B;"><a name="netty-&#x6A21;&#x578B;" class="anchor-navigation-ex-anchor" href="#netty-&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. Netty &#x6A21;&#x578B;</h2>
<blockquote>
<p>&#x8BB2;&#x89E3;netty&#x7684;&#x65F6;&#x5019;&#x91C7;&#x7528;&#x7684;&#x662F;&#x5148;&#x5199;&#x4EE3;&#x7801;&#x4F53;&#x9A8C;&#x4E00;&#x4E0B;&#xFF0C;&#x518D;&#x7EC6;&#x8BB2;&#x91CC;&#x9762;&#x7684;&#x539F;&#x7406;&#x3002;&#x524D;&#x9762;&#x770B;&#x4E0D;&#x61C2;&#x7684;&#x53EF;&#x4EE5;&#x5148;&#x4E0D;&#x7528;&#x7EA0;&#x7ED3;&#xFF0C;&#x5148;&#x5F80;&#x540E;&#x9762;&#x770B;&#xFF0C;&#x540E;&#x9762;&#x57FA;&#x672C;&#x90FD;&#x4F1A;&#x8BB2;&#x6E05;&#x695A;</p>
</blockquote>
<h3 id="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;1---&#x7B80;&#x5355;&#x7248;"><a name="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;1---&#x7B80;&#x5355;&#x7248;" class="anchor-navigation-ex-anchor" href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;1---&#x7B80;&#x5355;&#x7248;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.1. &#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;1 - &#x7B80;&#x5355;&#x7248;</h3>
<p><code>Netty</code> &#x4E3B;&#x8981;&#x57FA;&#x4E8E;&#x4E3B;&#x4ECE; <code>Reactors</code> &#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#xFF08;&#x5982;&#x56FE;&#xFF09;&#x505A;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x6539;&#x8FDB;&#xFF0C;&#x5176;&#x4E2D;&#x4E3B;&#x4ECE; <code>Reactor</code> &#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x6709;&#x591A;&#x4E2A; <code>Reactor</code></p>
<p><img src="../img/netty30.png" alt=""></p>
<p><strong>&#x5BF9;&#x4E0A;&#x56FE;&#x8BF4;&#x660E;</strong></p>
<ol>
<li><code>BossGroup</code> &#x7EBF;&#x7A0B;&#x7EF4;&#x62A4; <code>Selector</code>&#xFF0C;&#x53EA;&#x5173;&#x6CE8; <code>Accecpt</code> </li>
<li>&#x5F53;&#x63A5;&#x6536;&#x5230; <code>Accept</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684; <code>SocketChannel</code>&#xFF0C;&#x5C01;&#x88C5;&#x6210; <code>NIOScoketChannel</code> &#x5E76;&#x6CE8;&#x518C;&#x5230; <code>Worker</code> &#x7EBF;&#x7A0B;&#xFF08;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#xFF09;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x7EF4;&#x62A4;</li>
<li>&#x5F53; <code>Worker</code> &#x7EBF;&#x7A0B;&#x76D1;&#x542C;&#x5230; <code>Selector</code> &#x4E2D;&#x901A;&#x9053;&#x53D1;&#x751F;&#x81EA;&#x5DF1;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;&#x540E;&#xFF0C;&#x5C31;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF08;&#x5C31;&#x7531; <code>handler</code>&#xFF09;&#xFF0C;&#x6CE8;&#x610F; <code>handler</code> &#x5DF2;&#x7ECF;&#x52A0;&#x5165;&#x5230;&#x901A;&#x9053;</li>
</ol>
<h3 id="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;2---&#x8FDB;&#x9636;&#x7248;"><a name="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;2---&#x8FDB;&#x9636;&#x7248;" class="anchor-navigation-ex-anchor" href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;2---&#x8FDB;&#x9636;&#x7248;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.2. &#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;2 - &#x8FDB;&#x9636;&#x7248;</h3>
<p><img src="../img/netty31.png" alt=""></p>
<p><code>BossGroup</code>&#x6709;&#x70B9;&#x50CF;&#x4E3B;<code>Reactor</code> &#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#xFF0C;<code>WorkerGroup</code>&#x5219;&#x50CF;<code>SubReactor</code>&#x4E00;&#x6837;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x3002;</p>
<h3 id="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;3---&#x8BE6;&#x7EC6;&#x7248;"><a name="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;3---&#x8BE6;&#x7EC6;&#x7248;" class="anchor-navigation-ex-anchor" href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;3---&#x8BE6;&#x7EC6;&#x7248;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.3. &#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;3 - &#x8BE6;&#x7EC6;&#x7248;</h3>
<p><img src="../img/netty32.png" alt=""></p>
<ol>
<li><code>Netty</code> &#x62BD;&#x8C61;&#x51FA;&#x4E24;&#x7EC4;&#x7EBF;&#x7A0B;&#x6C60; &#xFF0C;<code>BossGroup</code> &#x4E13;&#x95E8;&#x8D1F;&#x8D23;&#x63A5;&#x6536;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;<code>WorkerGroup</code> &#x4E13;&#x95E8;&#x8D1F;&#x8D23;&#x7F51;&#x7EDC;&#x7684;&#x8BFB;&#x5199;</li>
<li><code>BossGroup</code> &#x548C; <code>WorkerGroup</code> &#x7C7B;&#x578B;&#x90FD;&#x662F; <code>NioEventLoopGroup</code> </li>
<li><code>NioEventLoopGroup</code> &#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7EC4;&#xFF0C;&#x8FD9;&#x4E2A;&#x7EC4;&#x4E2D;&#x542B;&#x6709;&#x591A;&#x4E2A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x662F; <code>NioEventLoop</code> </li>
<li><code>NioEventLoop</code> &#x8868;&#x793A;&#x4E00;&#x4E2A;&#x4E0D;&#x65AD;&#x5FAA;&#x73AF;&#x7684;&#x6267;&#x884C;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x6BCF;&#x4E2A; <code>NioEventLoop</code> &#x90FD;&#x6709;&#x4E00;&#x4E2A; <code>Selector</code>&#xFF0C;&#x7528;&#x4E8E;&#x76D1;&#x542C;&#x7ED1;&#x5B9A;&#x5728;&#x5176;&#x4E0A;&#x7684; <code>socket</code> &#x7684;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;</li>
<li><code>NioEventLoopGroup</code> &#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5373;&#x53EF;&#x4EE5;&#x542B;&#x6709;&#x591A;&#x4E2A; <code>NioEventLoop</code> </li>
<li>&#x6BCF;&#x4E2A; <code>BossGroup</code>&#x4E0B;&#x9762;&#x7684;<code>NioEventLoop</code> &#x5FAA;&#x73AF;&#x6267;&#x884C;&#x7684;&#x6B65;&#x9AA4;&#x6709; <code>3</code> &#x6B65;<ul>
<li>&#x8F6E;&#x8BE2; <code>accept</code> &#x4E8B;&#x4EF6;</li>
<li>&#x5904;&#x7406; <code>accept</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x4E0E; <code>client</code> &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x751F;&#x6210; <code>NioScocketChannel</code>&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6CE8;&#x518C;&#x5230;&#x67D0;&#x4E2A; <code>workerGroup</code> <code>NIOEventLoop</code> &#x4E0A;&#x7684; <code>Selector</code></li>
<li>&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5373; <code>runAllTasks</code></li>
</ul>
</li>
<li>&#x6BCF;&#x4E2A; <code>WorkerGroup</code> <code>NIOEventLoop</code> &#x5FAA;&#x73AF;&#x6267;&#x884C;&#x7684;&#x6B65;&#x9AA4;<ul>
<li>&#x8F6E;&#x8BE2; <code>read</code>&#xFF0C;<code>write</code> &#x4E8B;&#x4EF6;</li>
<li>&#x5904;&#x7406; <code>I/O</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x5373; <code>read</code>&#xFF0C;<code>write</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x5728;&#x5BF9;&#x5E94; <code>NioScocketChannel</code> &#x5904;&#x7406;</li>
<li>&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x5373; <code>runAllTasks</code></li>
</ul>
</li>
<li>&#x6BCF;&#x4E2A; <code>Worker</code> <code>NIOEventLoop</code> &#x5904;&#x7406;&#x4E1A;&#x52A1;&#x65F6;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528; <code>pipeline</code>&#xFF08;&#x7BA1;&#x9053;&#xFF09;&#xFF0C;<code>pipeline</code> &#x4E2D;&#x5305;&#x542B;&#x4E86; <code>channel&#xFF08;&#x901A;&#x9053;&#xFF09;</code>&#xFF0C;&#x5373;&#x901A;&#x8FC7; <code>pipeline</code> &#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x901A;&#x9053;&#xFF0C;&#x7BA1;&#x9053;&#x4E2D;&#x7EF4;&#x62A4;&#x4E86;&#x5F88;&#x591A;&#x7684;&#x5904;&#x7406;&#x5668;&#x3002;&#xFF08;&#x8FD9;&#x4E2A;&#x70B9;&#x76EE;&#x524D;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x8BB2;&#xFF0C;&#x540E;&#x9762;&#x91CD;&#x70B9;&#x8BF4;&#xFF09;</li>
</ol>
<h3 id="netty-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---tcp-&#x670D;&#x52A1;"><a name="netty-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---tcp-&#x670D;&#x52A1;" class="anchor-navigation-ex-anchor" href="#netty-&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---tcp-&#x670D;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.4. Netty &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B; - TCP &#x670D;&#x52A1;</h3>
<p>&#x5B9E;&#x4F8B;&#x8981;&#x6C42;&#xFF1A;&#x4F7F;&#x7528; <code>IDEA</code> &#x521B;&#x5EFA; <code>Netty</code> &#x9879;&#x76EE;</p>
<ol>
<li><code>Netty</code> &#x670D;&#x52A1;&#x5668;&#x5728; <code>6668</code> &#x7AEF;&#x53E3;&#x76D1;&#x542C;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x80FD;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7ED9;&#x670D;&#x52A1;&#x5668;&quot;hello,&#x670D;&#x52A1;&#x5668;~&quot;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x56DE;&#x590D;&#x6D88;&#x606F;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&quot;hello,&#x5BA2;&#x6237;&#x7AEF;~&quot;</li>
<li>&#x76EE;&#x7684;&#xFF1A;&#x5BF9; <code>Netty</code> &#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#x6709;&#x4E00;&#x4E2A;&#x521D;&#x6B65;&#x8BA4;&#x8BC6;&#xFF0C;&#x4FBF;&#x4E8E;&#x7406;&#x89E3; <code>Netty</code> &#x6A21;&#x578B;&#x7406;&#x8BBA;</li>
<li><ol>
<li>&#x7F16;&#x5199;&#x670D;&#x52A1;&#x7AEF; </li>
<li>&#x7F16;&#x5199;&#x5BA2;&#x6237;&#x7AEF;   </li>
<li>&#x5BF9; <code>netty</code> &#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x770B;&#x770B; <code>netty</code> &#x6A21;&#x578B;&#x7279;&#x70B9;</li>
<li>&#x8BF4;&#x660E;&#xFF1A;&#x521B;&#x5EFA; <code>Maven</code> &#x9879;&#x76EE;&#xFF0C;&#x5E76;&#x5F15;&#x5165; <code>Netty</code> &#x5305;</li>
</ol>
</li>
<li>&#x4EE3;&#x7801;&#x5982;&#x4E0B;</li>
</ol>
<h4 id="nettyserver"><a name="nettyserver" class="anchor-navigation-ex-anchor" href="#nettyserver"><i class="fa fa-link" aria-hidden="true"></i></a>NettyServer</h4>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>


        <span class="token comment">//&#x521B;&#x5EFA;BossGroup &#x548C; WorkerGroup</span>
        <span class="token comment">//&#x8BF4;&#x660E;</span>
        <span class="token comment">//1. &#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4; bossGroup &#x548C; workerGroup</span>
        <span class="token comment">//2. bossGroup &#x53EA;&#x662F;&#x5904;&#x7406;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42; , &#x771F;&#x6B63;&#x7684;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#xFF0C;&#x4F1A;&#x4EA4;&#x7ED9; workerGroup&#x5B8C;&#x6210;</span>
        <span class="token comment">//3. &#x4E24;&#x4E2A;&#x90FD;&#x662F;&#x65E0;&#x9650;&#x5FAA;&#x73AF;</span>
        <span class="token comment">//4. bossGroup &#x548C; workerGroup &#x542B;&#x6709;&#x7684;&#x5B50;&#x7EBF;&#x7A0B;(NioEventLoop)&#x7684;&#x4E2A;&#x6570;</span>
        <span class="token comment">//   &#x9ED8;&#x8BA4;&#x5B9E;&#x9645; cpu&#x6838;&#x6570; * 2</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8</span>



        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x542F;&#x52A8;&#x5BF9;&#x8C61;&#xFF0C;&#x914D;&#x7F6E;&#x53C2;&#x6570;</span>
            <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x4F7F;&#x7528;&#x94FE;&#x5F0F;&#x7F16;&#x7A0B;&#x6765;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4;</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//&#x4F7F;&#x7528;NioSocketChannel &#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_BACKLOG<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x961F;&#x5217;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x4E2A;&#x6570;</span>
                    <span class="token punctuation">.</span><span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_KEEPALIVE<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x4FDD;&#x6301;&#x6D3B;&#x52A8;&#x8FDE;&#x63A5;&#x72B6;&#x6001;</span>
<span class="token comment">//                    .handler(null) // &#x8BE5; handler&#x5BF9;&#x5E94; bossGroup , childHandler &#x5BF9;&#x5E94; workerGroup</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x901A;&#x9053;&#x521D;&#x59CB;&#x5316;&#x5BF9;&#x8C61;(&#x533F;&#x540D;&#x5BF9;&#x8C61;)</span>
                        <span class="token comment">//&#x7ED9;pipeline &#x8BBE;&#x7F6E;&#x5904;&#x7406;&#x5668;</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;socketchannel hashcode=&quot;</span> <span class="token operator">+</span> ch<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#x7BA1;&#x7406; SocketChannel&#xFF0C; &#x518D;&#x63A8;&#x9001;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E1A;&#x52A1;&#x52A0;&#x5165;&#x5230;&#x5404;&#x4E2A;channel &#x5BF9;&#x5E94;&#x7684; NIOEventLoop &#x7684; taskQueue &#x6216;&#x8005; scheduleTaskQueue</span>
                            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x7ED9;&#x6211;&#x4EEC;&#x7684;workerGroup &#x7684; EventLoop &#x5BF9;&#x5E94;&#x7684;&#x7BA1;&#x9053;&#x8BBE;&#x7F6E;&#x5904;&#x7406;&#x5668;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;.....&#x670D;&#x52A1;&#x5668; is ready...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x5E76;&#x4E14;&#x540C;&#x6B65;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A; ChannelFuture &#x5BF9;&#x8C61;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x7ACB;&#x9A6C;&#x8FD4;&#x56DE;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF09;</span>
            <span class="token comment">//&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;(&#x5E76;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;)</span>
            <span class="token class-name">ChannelFuture</span> cf <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x7ED9;cf &#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x76D1;&#x63A7;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#x4E8B;&#x4EF6;</span>

            cf<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cf<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3; 6668 &#x6210;&#x529F;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3; 6668 &#x5931;&#x8D25;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">//&#x5BF9;&#x5173;&#x95ED;&#x901A;&#x9053;&#x4E8B;&#x4EF6;  &#x8FDB;&#x884C;&#x76D1;&#x542C;</span>
            cf<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h4 id="nettyserverhandler"><a name="nettyserverhandler" class="anchor-navigation-ex-anchor" href="#nettyserverhandler"><i class="fa fa-link" aria-hidden="true"></i></a>NettyServerHandler</h4>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token comment">/*
&#x8BF4;&#x660E;
1. &#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Handler &#x9700;&#x8981;&#x7EE7;&#x627F;netty &#x89C4;&#x5B9A;&#x597D;&#x7684;&#x67D0;&#x4E2A;HandlerAdapter(&#x89C4;&#x8303;)
2. &#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Handler , &#x624D;&#x80FD;&#x79F0;&#x4E3A;&#x4E00;&#x4E2A;handler
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x4E8B;&#x4EF6;(&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;)</span>
    <span class="token comment">/*
    1. ChannelHandlerContext ctx:&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;, &#x542B;&#x6709; &#x7BA1;&#x9053;pipeline , &#x901A;&#x9053;channel, &#x5730;&#x5740;
    2. Object msg: &#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E; &#x9ED8;&#x8BA4;Object
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x8BFB;&#x53D6;&#x7EBF;&#x7A0B; &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; channle =&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;server ctx =&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x770B;&#x770B;channel &#x548C; pipeline&#x7684;&#x5173;&#x7CFB;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x672C;&#x8D28;&#x662F;&#x4E00;&#x4E2A;&#x53CC;&#x5411;&#x94FE;&#x8868;</span>


        <span class="token comment">//&#x5C06; msg &#x8F6C;&#x6210;&#x4E00;&#x4E2A; ByteBuf</span>
        <span class="token comment">//ByteBuf &#x662F; Netty &#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x4E0D;&#x662F; NIO &#x7684; ByteBuffer.</span>
        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x662F;:&quot;</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x5730;&#x5740;:&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//writeAndFlush &#x662F; write + flush</span>
        <span class="token comment">//&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x5237;&#x65B0;</span>
        <span class="token comment">//&#x4E00;&#x822C;&#x8BB2;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x540E;, &#x4E00;&#x822C;&#x662F;&#x9700;&#x8981;&#x5173;&#x95ED;&#x901A;&#x9053;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="nettyclient"><a name="nettyclient" class="anchor-navigation-ex-anchor" href="#nettyclient"><i class="fa fa-link" aria-hidden="true"></i></a>NettyClient</h4>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7EC4;</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x5BF9;&#x8C61;</span>
            <span class="token comment">//&#x6CE8;&#x610F;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x7684;&#x4E0D;&#x662F; ServerBootstrap &#x800C;&#x662F; Bootstrap</span>
            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x8BBE;&#x7F6E;&#x76F8;&#x5173;&#x53C2;&#x6570;</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span> <span class="token comment">//&#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x7EC4;</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x9053;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;(&#x53CD;&#x5C04;)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x52A0;&#x5165;&#x81EA;&#x5DF1;&#x7684;&#x5904;&#x7406;&#x5668;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF; ok..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x542F;&#x52A8;&#x5BA2;&#x6237;&#x7AEF;&#x53BB;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x7AEF;</span>
            <span class="token comment">//&#x5173;&#x4E8E; ChannelFuture &#x8981;&#x5206;&#x6790;&#xFF0C;&#x6D89;&#x53CA;&#x5230;netty&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x578B;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x5BF9;&#x5173;&#x95ED;&#x901A;&#x9053;&#x4E8B;&#x4EF6;  &#x8FDB;&#x884C;&#x76D1;&#x542C;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>

            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="nettyclienthandler"><a name="nettyclienthandler" class="anchor-navigation-ex-anchor" href="#nettyclienthandler"><i class="fa fa-link" aria-hidden="true"></i></a>NettyClientHandler</h4>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x5F53;&#x901A;&#x9053;&#x5C31;&#x7EEA;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;&#x65B9;&#x6CD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;client &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, server: (&gt;^&#x3C9;^&lt;)&#x55B5;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5F53;&#x901A;&#x9053;&#x6709;&#x8BFB;&#x53D6;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x56DE;&#x590D;&#x7684;&#x6D88;&#x606F;:&quot;</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&#xFF1A; &quot;</span><span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x7684;-task-&#x6709;-3-&#x79CD;&#x5178;&#x578B;&#x4F7F;&#x7528;&#x573A;&#x666F;"><a name="&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x7684;-task-&#x6709;-3-&#x79CD;&#x5178;&#x578B;&#x4F7F;&#x7528;&#x573A;&#x666F;" class="anchor-navigation-ex-anchor" href="#&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x7684;-task-&#x6709;-3-&#x79CD;&#x5178;&#x578B;&#x4F7F;&#x7528;&#x573A;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.5. &#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x7684; Task &#x6709; 3 &#x79CD;&#x5178;&#x578B;&#x4F7F;&#x7528;&#x573A;&#x666F;</h3>
<ol>
<li>&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x666E;&#x901A;&#x4EFB;&#x52A1;&#x3010;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x3011;</li>
<li>&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;</li>
<li>&#x975E;&#x5F53;&#x524D; <code>Reactor</code> &#x7EBF;&#x7A0B;&#x8C03;&#x7528; <code>Channel</code> &#x7684;&#x5404;&#x79CD;&#x65B9;&#x6CD5;
&#x4F8B;&#x5982;&#x5728;<strong>&#x63A8;&#x9001;&#x7CFB;&#x7EDF;</strong>&#x7684;&#x4E1A;&#x52A1;&#x7EBF;&#x7A0B;&#x91CC;&#x9762;&#xFF0C;&#x6839;&#x636E;&#x7528;&#x6237;&#x7684;&#x6807;&#x8BC6;&#xFF0C;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684; <code>Channel</code> &#x5F15;&#x7528;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; <code>Write</code> &#x7C7B;&#x65B9;&#x6CD5;&#x5411;&#x8BE5;&#x7528;&#x6237;&#x63A8;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x5C31;&#x4F1A;&#x8FDB;&#x5165;&#x5230;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x3002;&#x6700;&#x7EC8;&#x7684; <code>Write</code> &#x4F1A;&#x63D0;&#x4EA4;&#x5230;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x540E;&#x88AB;&#x5F02;&#x6B65;&#x6D88;&#x8D39;</li>
</ol>
<p>&#x524D;&#x4E24;&#x79CD;&#x7684;&#x4EE3;&#x7801;&#x4E3E;&#x4F8B;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>simple</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * &#x8BF4;&#x660E;
 * 1. &#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Handler &#x9700;&#x8981;&#x7EE7;&#x7EED;netty &#x89C4;&#x5B9A;&#x597D;&#x7684;&#x67D0;&#x4E2A;HandlerAdapter(&#x89C4;&#x8303;)
 * 2. &#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Handler , &#x624D;&#x80FD;&#x79F0;&#x4E3A;&#x4E00;&#x4E2A;handler
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5B9E;&#x9645;(&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;)</span>

    <span class="token comment">/**
     * 1. ChannelHandlerContext ctx:&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;, &#x542B;&#x6709; &#x7BA1;&#x9053;pipeline , &#x901A;&#x9053;channel, &#x5730;&#x5740;
     * 2. Object msg: &#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E; &#x9ED8;&#x8BA4;Object
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">// &#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x8017;&#x65F6;&#x957F;&#x7684;&#x4E1A;&#x52A1;-&gt; &#x5F02;&#x6B65;&#x6267;&#x884C; -&gt; &#x63D0;&#x4EA4;&#x8BE5;channel &#x5BF9;&#x5E94;&#x7684;</span>
        <span class="token comment">// NIOEventLoop &#x7684; taskQueue&#x4E2D;,</span>

        <span class="token comment">// &#x89E3;&#x51B3;&#x65B9;&#x6848;1 &#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x666E;&#x901A;&#x4EFB;&#x52A1;</span>

        ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;2&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channel code=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x53D1;&#x751F;&#x5F02;&#x5E38;&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;3&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channel code=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x53D1;&#x751F;&#x5F02;&#x5E38;&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x89E3;&#x51B3;&#x65B9;&#x6848;2 : &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1; -&#x300B; &#x8BE5;&#x4EFB;&#x52A1;&#x662F;&#x63D0;&#x4EA4;&#x5230; scheduleTaskQueue&#x4E2D;</span>

        ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;4&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channel code=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x53D1;&#x751F;&#x5F02;&#x5E38;&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;go on ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        System.out.println(&quot;&#x670D;&#x52A1;&#x5668;&#x8BFB;&#x53D6;&#x7EBF;&#x7A0B; &quot; + Thread.currentThread().getName() + &quot; channle =&quot; + ctx.channel());</span>
<span class="token comment">//        System.out.println(&quot;server ctx =&quot; + ctx);</span>
<span class="token comment">//        System.out.println(&quot;&#x770B;&#x770B;channel &#x548C; pipeline&#x7684;&#x5173;&#x7CFB;&quot;);</span>
<span class="token comment">//        Channel channel = ctx.channel();</span>
<span class="token comment">//        ChannelPipeline pipeline = ctx.pipeline(); //&#x672C;&#x8D28;&#x662F;&#x4E00;&#x4E2A;&#x53CC;&#x5411;&#x94FE;&#x63A5;, &#x51FA;&#x7AD9;&#x5165;&#x7AD9;</span>
<span class="token comment">//        </span>
<span class="token comment">//        //&#x5C06; msg &#x8F6C;&#x6210;&#x4E00;&#x4E2A; ByteBuf</span>
<span class="token comment">//        //ByteBuf &#x662F; Netty &#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x4E0D;&#x662F; NIO &#x7684; ByteBuffer.</span>
<span class="token comment">//        ByteBuf buf = (ByteBuf) msg;</span>
<span class="token comment">//        System.out.println(&quot;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x662F;:&quot; + buf.toString(CharsetUtil.UTF_8));</span>
<span class="token comment">//        System.out.println(&quot;&#x5BA2;&#x6237;&#x7AEF;&#x5730;&#x5740;:&quot; + channel.remoteAddress());</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//writeAndFlush &#x662F; write + flush</span>
        <span class="token comment">//&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x7F13;&#x5B58;&#xFF0C;&#x5E76;&#x5237;&#x65B0;</span>
        <span class="token comment">//&#x4E00;&#x822C;&#x8BB2;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7F16;&#x7801;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x5BA2;&#x6237;&#x7AEF;~(&gt;^&#x3C9;^&lt;)&#x55B5;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5904;&#x7406;&#x5F02;&#x5E38;, &#x4E00;&#x822C;&#x662F;&#x9700;&#x8981;&#x5173;&#x95ED;&#x901A;&#x9053;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x65B9;&#x6848;&#x518D;&#x8BF4;&#x660E;"><a name="&#x65B9;&#x6848;&#x518D;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6848;&#x518D;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.6. &#x65B9;&#x6848;&#x518D;&#x8BF4;&#x660E;</h3>
<ol>
<li><code>Netty</code> &#x62BD;&#x8C61;&#x51FA;&#x4E24;&#x7EC4;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;<code>BossGroup</code> &#x4E13;&#x95E8;&#x8D1F;&#x8D23;&#x63A5;&#x6536;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#xFF0C;<code>WorkerGroup</code> &#x4E13;&#x95E8;&#x8D1F;&#x8D23;&#x7F51;&#x7EDC;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;</li>
<li><code>NioEventLoop</code> &#x8868;&#x793A;&#x4E00;&#x4E2A;&#x4E0D;&#x65AD;&#x5FAA;&#x73AF;&#x6267;&#x884C;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x6BCF;&#x4E2A; <code>NioEventLoop</code> &#x90FD;&#x6709;&#x4E00;&#x4E2A; <code>Selector</code>&#xFF0C;&#x7528;&#x4E8E;&#x76D1;&#x542C;&#x7ED1;&#x5B9A;&#x5728;&#x5176;&#x4E0A;&#x7684; <code>socket</code>&#x7F51;&#x7EDC;&#x901A;&#x9053;&#x3002;</li>
<li><p><code>NioEventLoop</code> &#x5185;&#x90E8;&#x91C7;&#x7528;&#x4E32;&#x884C;&#x5316;&#x8BBE;&#x8BA1;&#xFF0C;&#x4ECE;&#x6D88;&#x606F;&#x7684; <strong>&#x8BFB;&#x53D6;-&gt;&#x89E3;&#x7801;-&gt;&#x5904;&#x7406;-&gt;&#x7F16;&#x7801;-&gt;&#x53D1;&#x9001;</strong>&#xFF0C;&#x59CB;&#x7EC8;&#x7531; <code>IO</code> &#x7EBF;&#x7A0B; <code>NioEventLoop</code> &#x8D1F;&#x8D23;</p>
</li>
<li><p><code>NioEventLoopGroup</code> &#x4E0B;&#x5305;&#x542B;&#x591A;&#x4E2A; <code>NioEventLoop</code></p>
</li>
<li><p>&#x6BCF;&#x4E2A; <code>NioEventLoop</code> &#x4E2D;&#x5305;&#x542B;&#x6709;&#x4E00;&#x4E2A; <code>Selector</code>&#xFF0C;&#x4E00;&#x4E2A; <code>taskQueue</code></p>
</li>
<li>&#x6BCF;&#x4E2A; <code>NioEventLoop</code> &#x7684; <code>Selector</code> &#x4E0A;&#x53EF;&#x4EE5;&#x6CE8;&#x518C;&#x76D1;&#x542C;&#x591A;&#x4E2A; <code>NioChannel</code></li>
<li>&#x6BCF;&#x4E2A; <code>NioChannel</code> &#x53EA;&#x4F1A;&#x7ED1;&#x5B9A;&#x5728;&#x552F;&#x4E00;&#x7684; <code>NioEventLoop</code> &#x4E0A;</li>
<li>&#x6BCF;&#x4E2A; <code>NioChannel</code> &#x90FD;&#x7ED1;&#x5B9A;&#x6709;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x7684; <code>ChannelPipeline</code></li>
</ol>
<h2 id="&#x5F02;&#x6B65;&#x6A21;&#x578B;"><a name="&#x5F02;&#x6B65;&#x6A21;&#x578B;" class="anchor-navigation-ex-anchor" href="#&#x5F02;&#x6B65;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9. &#x5F02;&#x6B65;&#x6A21;&#x578B;</h2>
<h3 id="&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><a name="&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9.1. &#x57FA;&#x672C;&#x4ECB;&#x7ECD;</h3>
<ol>
<li>&#x5F02;&#x6B65;&#x7684;&#x6982;&#x5FF5;&#x548C;&#x540C;&#x6B65;&#x76F8;&#x5BF9;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x53D1;&#x51FA;&#x540E;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x4E0D;&#x80FD;&#x7ACB;&#x523B;&#x5F97;&#x5230;&#x7ED3;&#x679C;&#x3002;&#x5B9E;&#x9645;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x7684;&#x7EC4;&#x4EF6;&#x5728;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x72B6;&#x6001;&#x3001;&#x901A;&#x77E5;&#x548C;&#x56DE;&#x8C03;&#x6765;&#x901A;&#x77E5;&#x8C03;&#x7528;&#x8005;&#x3002;</li>
<li><code>Netty</code> &#x4E2D;&#x7684; <code>I/O</code> &#x64CD;&#x4F5C;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x5305;&#x62EC; <code>Bind&#x3001;Write&#x3001;Connect</code> &#x7B49;&#x64CD;&#x4F5C;&#x4F1A;&#x9996;&#x5148;&#x7B80;&#x5355;&#x7684;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>ChannelFuture</code>&#x3002;</li>
<li>&#x8C03;&#x7528;&#x8005;&#x5E76;&#x4E0D;&#x80FD;&#x7ACB;&#x523B;&#x83B7;&#x5F97;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7; <code>Future-Listener</code> &#x673A;&#x5236;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x4E3B;&#x52A8;&#x83B7;&#x53D6;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x901A;&#x77E5;&#x673A;&#x5236;&#x83B7;&#x5F97; <code>IO</code> &#x64CD;&#x4F5C;&#x7ED3;&#x679C;&#x3002;</li>
<li><code>Netty</code> &#x7684;&#x5F02;&#x6B65;&#x6A21;&#x578B;&#x662F;&#x5EFA;&#x7ACB;&#x5728; <code>future</code> &#x548C; <code>callback</code> &#x7684;&#x4E4B;&#x4E0A;&#x7684;&#x3002;<code>callback</code> &#x5C31;&#x662F;&#x56DE;&#x8C03;&#x3002;&#x91CD;&#x70B9;&#x8BF4; <code>Future</code>&#xFF0C;&#x5B83;&#x7684;&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x662F;&#xFF1A;&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5; <code>fun</code>&#xFF0C;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x53EF;&#x80FD;&#x975E;&#x5E38;&#x8017;&#x65F6;&#xFF0C;&#x7B49;&#x5F85; <code>fun</code> &#x8FD4;&#x56DE;&#x663E;&#x7136;&#x4E0D;&#x5408;&#x9002;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5728;&#x8C03;&#x7528; <code>fun</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7ACB;&#x9A6C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>Future</code>&#xFF0C;&#x540E;&#x7EED;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>Future</code> &#x53BB;&#x76D1;&#x63A7;&#x65B9;&#x6CD5; <code>fun</code> &#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF08;&#x5373;&#xFF1A;<code>Future-Listener</code> &#x673A;&#x5236;&#xFF09;</li>
</ol>
<h3 id="future-&#x8BF4;&#x660E;"><a name="future-&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#future-&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9.2. Future &#x8BF4;&#x660E;</h3>
<ol>
<li>&#x8868;&#x793A;&#x5F02;&#x6B65;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;,&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x68C0;&#x6D4B;&#x6267;&#x884C;&#x662F;&#x5426;&#x5B8C;&#x6210;&#xFF0C;&#x6BD4;&#x5982;&#x68C0;&#x7D22;&#x8BA1;&#x7B97;&#x7B49;&#x7B49;&#x3002;</li>
<li><code>ChannelFuture</code> &#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF1A;<code>public interface ChannelFuture extends Future<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Void</span><span class="token punctuation">&gt;</span></span></code> &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5F53;&#x76D1;&#x542C;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x901A;&#x77E5;&#x5230;&#x76D1;&#x542C;&#x5668;&#x3002;</li>
</ol>
<h3 id="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;"><a name="&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;" class="anchor-navigation-ex-anchor" href="#&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9.3. &#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x793A;&#x610F;&#x56FE;</h3>
<p>&#x4E0B;&#x9762;&#x7B2C;&#x4E00;&#x5F20;&#x56FE;&#x5C31;&#x662F;&#x7BA1;&#x9053;&#xFF0C;&#x4E2D;&#x95F4;&#x4F1A;&#x7ECF;&#x8FC7;&#x591A;&#x4E2A;handler</p>
<p><img src="../img/netty33.png" alt=""></p>
<p><img src="../img/netty34.png" alt=""></p>
<p>&#x8BF4;&#x660E;&#xFF1A;</p>
<ol>
<li>&#x5728;&#x4F7F;&#x7528; <code>Netty</code> &#x8FDB;&#x884C;&#x7F16;&#x7A0B;&#x65F6;&#xFF0C;&#x62E6;&#x622A;&#x64CD;&#x4F5C;&#x548C;&#x8F6C;&#x6362;&#x51FA;&#x5165;&#x7AD9;&#x6570;&#x636E;&#x53EA;&#x9700;&#x8981;&#x60A8;&#x63D0;&#x4F9B; <code>callback</code> &#x6216;&#x5229;&#x7528; <code>future</code> &#x5373;&#x53EF;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;&#x94FE;&#x5F0F;&#x64CD;&#x4F5C;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#xFF0C;&#x5E76;&#x6709;&#x5229;&#x4E8E;&#x7F16;&#x5199;&#x53EF;&#x91CD;&#x7528;&#x7684;&#x3001;&#x901A;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x3002;</li>
<li><code>Netty</code> &#x6846;&#x67B6;&#x7684;&#x76EE;&#x6807;&#x5C31;&#x662F;&#x8BA9;&#x4F60;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x4ECE;&#x7F51;&#x7EDC;&#x57FA;&#x7840;&#x5E94;&#x7528;&#x7F16;&#x7801;&#x4E2D;&#x5206;&#x79BB;&#x51FA;&#x6765;&#x3001;&#x89E3;&#x8131;&#x51FA;&#x6765;&#x3002;</li>
</ol>
<h3 id="future-listener-&#x673A;&#x5236;"><a name="future-listener-&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#future-listener-&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9.4. Future-Listener &#x673A;&#x5236;</h3>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x770B;&#x4E0D;&#x61C2;&#x7684;&#x53EF;&#x4EE5;&#x770B;&#x7B14;&#x8005;&#x7684;<strong>&#x5E76;&#x53D1;&#x7CFB;&#x5217;-JUC&#x90E8;&#x5206;</strong></p>
</blockquote>
<ol>
<li>&#x5F53; <code>Future</code> &#x5BF9;&#x8C61;&#x521A;&#x521A;&#x521B;&#x5EFA;&#x65F6;&#xFF0C;&#x5904;&#x4E8E;&#x975E;&#x5B8C;&#x6210;&#x72B6;&#x6001;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD4;&#x56DE;&#x7684; <code>ChannelFuture</code> &#x6765;&#x83B7;&#x53D6;&#x64CD;&#x4F5C;&#x6267;&#x884C;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6CE8;&#x518C;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x6765;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x5E38;&#x89C1;&#x6709;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;<ul>
<li>&#x901A;&#x8FC7; <code>isDone</code> &#x65B9;&#x6CD5;&#x6765;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x662F;&#x5426;&#x5B8C;&#x6210;&#xFF1B;</li>
<li>&#x901A;&#x8FC7; <code>isSuccess</code> &#x65B9;&#x6CD5;&#x6765;&#x5224;&#x65AD;&#x5DF2;&#x5B8C;&#x6210;&#x7684;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x662F;&#x5426;&#x6210;&#x529F;&#xFF1B;</li>
<li>&#x901A;&#x8FC7; <code>getCause</code> &#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x5DF2;&#x5B8C;&#x6210;&#x7684;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x5931;&#x8D25;&#x7684;&#x539F;&#x56E0;&#xFF1B;</li>
<li>&#x901A;&#x8FC7; <code>isCancelled</code> &#x65B9;&#x6CD5;&#x6765;&#x5224;&#x65AD;&#x5DF2;&#x5B8C;&#x6210;&#x7684;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x662F;&#x5426;&#x88AB;&#x53D6;&#x6D88;&#xFF1B;</li>
<li>&#x901A;&#x8FC7; <code>addListener</code> &#x65B9;&#x6CD5;&#x6765;&#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5F53;&#x64CD;&#x4F5C;&#x5DF2;&#x5B8C;&#x6210;&#xFF08;<code>isDone</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x5B8C;&#x6210;&#xFF09;&#xFF0C;&#x5C06;&#x4F1A;&#x901A;&#x77E5;&#x6307;&#x5B9A;&#x7684;&#x76D1;&#x542C;&#x5668;&#xFF1B;&#x5982;&#x679C; <code>Future</code> &#x5BF9;&#x8C61;&#x5DF2;&#x5B8C;&#x6210;&#xFF0C;&#x5219;&#x901A;&#x77E5;&#x6307;&#x5B9A;&#x7684;&#x76D1;&#x542C;&#x5668;</li>
</ul>
</li>
</ol>
<p>&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;
&#x6F14;&#x793A;&#xFF1A;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;&#x662F;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x5F53;&#x7ED1;&#x5B9A;&#x64CD;&#x4F5C;&#x5904;&#x7406;&#x5B8C;&#xFF0C;&#x5C06;&#x4F1A;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x76D1;&#x542C;&#x5668;&#x5904;&#x7406;&#x903B;&#x8F91;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">//&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x5E76;&#x4E14;&#x540C;&#x6B65;,&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;ChannelFuture&#x5BF9;&#x8C61;</span>
<span class="token comment">//&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;(&#x5E76;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;)</span>
<span class="token class-name">ChannelFuture</span> cf <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//&#x7ED9;cf&#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x76D1;&#x63A7;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#x4E8B;&#x4EF6;</span>
cf<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> operationComplete <span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cf<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3;6668&#x6210;&#x529F;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x76D1;&#x542C;&#x7AEF;&#x53E3;6668&#x5931;&#x8D25;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---http&#x670D;&#x52A1;"><a name="&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---http&#x670D;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B;---http&#x670D;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.10. &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5B9E;&#x4F8B; - HTTP&#x670D;&#x52A1;</h2>
<ol>
<li>&#x5B9E;&#x4F8B;&#x8981;&#x6C42;&#xFF1A;&#x4F7F;&#x7528; <code>IDEA</code> &#x521B;&#x5EFA; <code>Netty</code> &#x9879;&#x76EE;</li>
<li><code>Netty</code> &#x670D;&#x52A1;&#x5668;&#x5728; <code>6668</code> &#x7AEF;&#x53E3;&#x76D1;&#x542C;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x51FA;&#x8BF7;&#x6C42; <code>http://localhost:6668/</code> </li>
<li>&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x56DE;&#x590D;&#x6D88;&#x606F;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&quot;Hello!&#x6211;&#x662F;&#x670D;&#x52A1;&#x5668;5&quot;,&#x5E76;&#x5BF9;&#x7279;&#x5B9A;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#x3002;</li>
<li>&#x76EE;&#x7684;&#xFF1A;<code>Netty</code> &#x53EF;&#x4EE5;&#x505A; <code>Http</code> &#x670D;&#x52A1;&#x5F00;&#x53D1;&#xFF0C;&#x5E76;&#x4E14;&#x7406;&#x89E3; <code>Handler</code> &#x5B9E;&#x4F8B;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x53CA;&#x5176;&#x8BF7;&#x6C42;&#x7684;&#x5173;&#x7CFB;&#x3002;</li>
<li>&#x770B;&#x8001;&#x5E08;&#x4EE3;&#x7801;&#x6F14;&#x793A;</li>
</ol>
<h3 id="testserver"><a name="testserver" class="anchor-navigation-ex-anchor" href="#testserver"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.1. TestServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestServerInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">6668</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="testserverinitializer"><a name="testserverinitializer" class="anchor-navigation-ex-anchor" href="#testserverinitializer"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.2. TestServerInitializer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServerCodec</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServerInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x5411;&#x7BA1;&#x9053;&#x52A0;&#x5165;&#x5904;&#x7406;&#x5668;</span>

        <span class="token comment">//&#x5F97;&#x5230;&#x7BA1;&#x9053;</span>
        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x52A0;&#x5165;&#x4E00;&#x4E2A;netty &#x63D0;&#x4F9B;&#x7684;httpServerCodec codec =&gt;[coder - decoder]</span>
        <span class="token comment">//HttpServerCodec &#x8BF4;&#x660E;</span>
        <span class="token comment">//1. HttpServerCodec &#x662F;netty &#x63D0;&#x4F9B;&#x7684;&#x5904;&#x7406;http&#x7684; &#x7F16;-&#x89E3;&#x7801;&#x5668;</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;MyHttpServerCodec&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">HttpServerCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2. &#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;handler</span>
        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;MyTestHttpServerHandler&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TestHttpServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ok~~~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="testhttpserverhandler"><a name="testhttpserverhandler" class="anchor-navigation-ex-anchor" href="#testhttpserverhandler"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.3. TestHttpServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CharsetUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URI</span></span><span class="token punctuation">;</span>

<span class="token comment">/*
&#x8BF4;&#x660E;
1. SimpleChannelInboundHandler &#x662F; ChannelInboundHandlerAdapter
2. HttpObject &#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x76F8;&#x4E92;&#x901A;&#x8BAF;&#x7684;&#x6570;&#x636E;&#x88AB;&#x5C01;&#x88C5;&#x6210; HttpObject
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestHttpServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>


    <span class="token comment">//channelRead0 &#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x636E;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">HttpObject</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BF9;&#x5E94;&#x7684;channel=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; pipeline=&quot;</span> <span class="token operator">+</span> ctx
        <span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x901A;&#x8FC7;pipeline&#x83B7;&#x53D6;channel&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5F53;&#x524D;ctx&#x7684;handler=&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x5224;&#x65AD; msg &#x662F;&#x4E0D;&#x662F; httprequest&#x8BF7;&#x6C42;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ctx &#x7C7B;&#x578B;=&quot;</span><span class="token operator">+</span>ctx<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;pipeline hashcode&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; TestHttpServerHandler hash=&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;msg &#x7C7B;&#x578B;=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5BA2;&#x6237;&#x7AEF;&#x5730;&#x5740;&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x83B7;&#x53D6;&#x5230;</span>
            <span class="token class-name">HttpRequest</span> httpRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpRequest</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
            <span class="token comment">//&#x83B7;&#x53D6;uri, &#x8FC7;&#x6EE4;&#x6307;&#x5B9A;&#x7684;&#x8D44;&#x6E90;</span>
            <span class="token class-name">URI</span> uri <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;/favicon.ico&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uri<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x8BF7;&#x6C42;&#x4E86; favicon.ico, &#x4E0D;&#x505A;&#x54CD;&#x5E94;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//&#x56DE;&#x590D;&#x4FE1;&#x606F;&#x7ED9;&#x6D4F;&#x89C8;&#x5668; [http&#x534F;&#x8BAE;]</span>

            <span class="token class-name">ByteBuf</span> content <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &#x6211;&#x662F;&#x670D;&#x52A1;&#x5668;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x6784;&#x9020;&#x4E00;&#x4E2A;http&#x7684;&#x76F8;&#x5E94;&#xFF0C;&#x5373; httpresponse</span>
            <span class="token class-name">FullHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpVersion</span><span class="token punctuation">.</span>HTTP_1_1<span class="token punctuation">,</span> <span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

            response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span>CONTENT_TYPE<span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span>CONTENT_LENGTH<span class="token punctuation">,</span> content<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x5C06;&#x6784;&#x5EFA;&#x597D; response&#x8FD4;&#x56DE;</span>
            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h1 id="netty-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;"><a name="netty-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#netty-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>3. Netty &#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;</h1>
<blockquote>
<p>&#x5404;&#x79CD;&#x4E1C;&#x897F;&#x770B;&#x4E0D;&#x61C2;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x7B2C;&#x4E09;&#x8BDD;&#xFF0C;&#x7B2C;&#x4E09;&#x8BDD;&#x6211;&#x81EA;&#x8BA4;&#x4E3A;&#x7528;&#x901A;&#x4FD7;&#x7684;&#x8BED;&#x8A00;&#x8BB2;&#x7684;&#x8FD8;&#x7B97;&#x6E05;&#x695A;&#x3002;</p>
</blockquote>
<h2 id="bootstrap&#x3001;serverbootstrap"><a name="bootstrap&#x3001;serverbootstrap" class="anchor-navigation-ex-anchor" href="#bootstrap&#x3001;serverbootstrap"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. Bootstrap&#x3001;ServerBootstrap</h2>
<ol>
<li><code>Bootstrap</code> &#x610F;&#x601D;&#x662F;&#x5F15;&#x5BFC;&#xFF0C;&#x4E00;&#x4E2A; <code>Netty</code> &#x5E94;&#x7528;&#x901A;&#x5E38;&#x7531;&#x4E00;&#x4E2A; <code>Bootstrap</code> &#x5F00;&#x59CB;&#xFF0C;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x914D;&#x7F6E;&#x6574;&#x4E2A; <code>Netty</code> &#x7A0B;&#x5E8F;&#xFF0C;&#x4E32;&#x8054;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;<code>Netty</code> &#x4E2D; <code>Bootstrap</code> &#x7C7B;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;&#x7684;&#x542F;&#x52A8;&#x5F15;&#x5BFC;&#x7C7B;&#xFF0C;<code>ServerBootstrap</code> &#x662F;&#x670D;&#x52A1;&#x7AEF;&#x542F;&#x52A8;&#x5F15;&#x5BFC;&#x7C7B;&#x3002;</li>
<li>&#x5E38;&#x89C1;&#x7684;&#x65B9;&#x6CD5;&#x6709;<ul>
<li><code>public ServerBootstrap group(EventLoopGroup parentGroup, EventLoopGroup childGroup)</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x4E24;&#x4E2A; <code>EventLoop</code></li>
<li><code>public B group(EventLoopGroup group)</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A; <code>EventLoop</code></li>
<li><code>public B channel(Class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?</span> <span class="token attr-name">extends</span> <span class="token attr-name">C</span><span class="token punctuation">&gt;</span></span> channelClass)</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;</li>
<li><code>public <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> B option(ChannelOption<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> option, T value)</code>&#xFF0C;&#x7528;&#x6765;&#x7ED9; <code>ServerChannel</code> &#x6DFB;&#x52A0;&#x914D;&#x7F6E;</li>
<li><code>public <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> ServerBootstrap childOption(ChannelOption<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> childOption, T value)</code>&#xFF0C;&#x7528;&#x6765;&#x7ED9;&#x63A5;&#x6536;&#x5230;&#x7684;&#x901A;&#x9053;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;</li>
<li><code>public ServerBootstrap childHandler(ChannelHandler childHandler)</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x7C7B;&#xFF08;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>handler</code>&#xFF09;</li>
<li><code>public ChannelFuture bind(int inetPort)</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x7528;&#x6765;&#x8BBE;&#x7F6E;&#x5360;&#x7528;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
<li><code>public ChannelFuture connect(String inetHost, int inetPort)</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7528;&#x6765;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x7AEF;</li>
</ul>
</li>
</ol>
<h2 id="future&#x3001;channelfuture"><a name="future&#x3001;channelfuture" class="anchor-navigation-ex-anchor" href="#future&#x3001;channelfuture"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. Future&#x3001;ChannelFuture</h2>
<p><code>Netty</code> &#x4E2D;&#x6240;&#x6709;&#x7684; <code>IO</code> &#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x4E0D;&#x80FD;&#x7ACB;&#x523B;&#x5F97;&#x77E5;&#x6D88;&#x606F;&#x662F;&#x5426;&#x88AB;&#x6B63;&#x786E;&#x5904;&#x7406;&#x3002;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x8FC7;&#x4E00;&#x4F1A;&#x7B49;&#x5B83;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x5C31;&#x662F;&#x901A;&#x8FC7; <code>Future</code> &#x548C; <code>ChannelFutures</code>&#xFF0C;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#xFF0C;&#x5F53;&#x64CD;&#x4F5C;&#x6267;&#x884C;&#x6210;&#x529F;&#x6216;&#x5931;&#x8D25;&#x65F6;&#x76D1;&#x542C;&#x4F1A;&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#x6CE8;&#x518C;&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;</p>
<p>&#x5E38;&#x89C1;&#x7684;&#x65B9;&#x6CD5;&#x6709;</p>
<ul>
<li><code>Channel channel()</code>&#xFF0C;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x8FDB;&#x884C; <code>IO</code> &#x64CD;&#x4F5C;&#x7684;&#x901A;&#x9053;</li>
<li><code>ChannelFuture sync()</code>&#xFF0C;&#x7B49;&#x5F85;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x6267;&#x884C;&#x5B8C;&#x6BD5;</li>
</ul>
<h2 id="channel"><a name="channel" class="anchor-navigation-ex-anchor" href="#channel"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. Channel</h2>
<ol>
<li><code>Netty</code> &#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x80FD;&#x591F;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x7F51;&#x7EDC; <code>I/O</code> &#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x901A;&#x8FC7; <code>Channel</code> &#x53EF;&#x83B7;&#x5F97;&#x5F53;&#x524D;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x7684;&#x901A;&#x9053;&#x7684;&#x72B6;&#x6001;</li>
<li>&#x901A;&#x8FC7; <code>Channel</code> &#x53EF;&#x83B7;&#x5F97;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF08;&#x4F8B;&#x5982;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#xFF09;</li>
<li><code>Channel</code> &#x63D0;&#x4F9B;&#x5F02;&#x6B65;&#x7684;&#x7F51;&#x7EDC; <code>I/O</code> &#x64CD;&#x4F5C;(&#x5982;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x8BFB;&#x5199;&#xFF0C;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;)&#xFF0C;&#x5F02;&#x6B65;&#x8C03;&#x7528;&#x610F;&#x5473;&#x7740;&#x4EFB;&#x4F55; <code>I/O</code> &#x8C03;&#x7528;&#x90FD;&#x5C06;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4FDD;&#x8BC1;&#x5728;&#x8C03;&#x7528;&#x7ED3;&#x675F;&#x65F6;&#x6240;&#x8BF7;&#x6C42;&#x7684; <code>I/O</code> &#x64CD;&#x4F5C;&#x5DF2;&#x5B8C;&#x6210;</li>
<li>&#x8C03;&#x7528;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>ChannelFuture</code> &#x5B9E;&#x4F8B;&#xFF0C;&#x901A;&#x8FC7;&#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;&#x5230; <code>ChannelFuture</code> &#x4E0A;&#xFF0C;&#x53EF;&#x4EE5; <code>I/O</code> &#x64CD;&#x4F5C;&#x6210;&#x529F;&#x3001;&#x5931;&#x8D25;&#x6216;&#x53D6;&#x6D88;&#x65F6;&#x56DE;&#x8C03;&#x901A;&#x77E5;&#x8C03;&#x7528;&#x65B9;</li>
<li>&#x652F;&#x6301;&#x5173;&#x8054; <code>I/O</code> &#x64CD;&#x4F5C;&#x4E0E;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;</li>
<li>&#x4E0D;&#x540C;&#x534F;&#x8BAE;&#x3001;&#x4E0D;&#x540C;&#x7684;&#x963B;&#x585E;&#x7C7B;&#x578B;&#x7684;&#x8FDE;&#x63A5;&#x90FD;&#x6709;&#x4E0D;&#x540C;&#x7684; <code>Channel</code> &#x7C7B;&#x578B;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x5E38;&#x7528;&#x7684; <code>Channel</code> &#x7C7B;&#x578B;&#xFF1A;<ul>
<li><code>NioSocketChannel</code>&#xFF0C;&#x5F02;&#x6B65;&#x7684;&#x5BA2;&#x6237;&#x7AEF; <code>TCP</code> <code>Socket</code> &#x8FDE;&#x63A5;&#x3002;</li>
<li><code>NioServerSocketChannel</code>&#xFF0C;&#x5F02;&#x6B65;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7AEF; <code>TCP</code> <code>Socket</code> &#x8FDE;&#x63A5;&#x3002;</li>
<li><code>NioDatagramChannel</code>&#xFF0C;&#x5F02;&#x6B65;&#x7684; <code>UDP</code> &#x8FDE;&#x63A5;&#x3002;</li>
<li><code>NioSctpChannel</code>&#xFF0C;&#x5F02;&#x6B65;&#x7684;&#x5BA2;&#x6237;&#x7AEF; <code>Sctp</code> &#x8FDE;&#x63A5;&#x3002;</li>
<li><code>NioSctpServerChannel</code>&#xFF0C;&#x5F02;&#x6B65;&#x7684; <code>Sctp</code> &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x4E9B;&#x901A;&#x9053;&#x6DB5;&#x76D6;&#x4E86; <code>UDP</code> &#x548C; <code>TCP</code> &#x7F51;&#x7EDC; <code>IO</code> &#x4EE5;&#x53CA;&#x6587;&#x4EF6; <code>IO</code>&#x3002;</li>
</ul>
</li>
</ol>
<h2 id="selector"><a name="selector" class="anchor-navigation-ex-anchor" href="#selector"><i class="fa fa-link" aria-hidden="true"></i></a>3.4. Selector</h2>
<ol>
<li><code>Netty</code> &#x57FA;&#x4E8E; <code>Selector</code> &#x5BF9;&#x8C61;&#x5B9E;&#x73B0; <code>I/O</code> &#x591A;&#x8DEF;&#x590D;&#x7528;&#xFF0C;&#x901A;&#x8FC7; <code>Selector</code> &#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x76D1;&#x542C;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#x7684; <code>Channel</code> &#x4E8B;&#x4EF6;&#x3002;</li>
<li>&#x5F53;&#x5411;&#x4E00;&#x4E2A; <code>Selector</code> &#x4E2D;&#x6CE8;&#x518C; <code>Channel</code> &#x540E;&#xFF0C;<code>Selector</code> &#x5185;&#x90E8;&#x7684;&#x673A;&#x5236;&#x5C31;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x4E0D;&#x65AD;&#x5730;&#x67E5;&#x8BE2;&#xFF08;<code>Select</code>&#xFF09;&#x8FD9;&#x4E9B;&#x6CE8;&#x518C;&#x7684; <code>Channel</code> &#x662F;&#x5426;&#x6709;&#x5DF2;&#x5C31;&#x7EEA;&#x7684; <code>I/O</code> &#x4E8B;&#x4EF6;&#xFF08;&#x4F8B;&#x5982;&#x53EF;&#x8BFB;&#xFF0C;&#x53EF;&#x5199;&#xFF0C;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x5B8C;&#x6210;&#x7B49;&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x7A0B;&#x5E8F;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x7B80;&#x5355;&#x5730;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x9AD8;&#x6548;&#x5730;&#x7BA1;&#x7406;&#x591A;&#x4E2A; <code>Channel</code></li>
</ol>
<h2 id="channelhandler-&#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;"><a name="channelhandler-&#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;" class="anchor-navigation-ex-anchor" href="#channelhandler-&#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>3.5. ChannelHandler &#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;</h2>
<ol>
<li><code>ChannelHandler</code> &#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5904;&#x7406; <code>I/O</code> &#x4E8B;&#x4EF6;&#x6216;&#x62E6;&#x622A; <code>I/O</code> &#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x8F6C;&#x53D1;&#x5230;&#x5176; <code>ChannelPipeline</code>&#xFF08;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x94FE;&#xFF09;&#x4E2D;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;</li>
<li><code>ChannelHandler</code> &#x672C;&#x8EAB;&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x5F88;&#x591A;&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x6709;&#x8BB8;&#x591A;&#x7684;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#xFF0C;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#x671F;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x5B83;&#x7684;&#x5B50;&#x7C7B;</li>
<li><code>ChannelHandler</code> &#x53CA;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;&#x4E00;&#x89C8;&#x56FE;&#xFF08;&#x540E;&#xFF09;</li>
</ol>
<p><img src="../img/netty35.png" alt=""></p>
<ol>
<li>&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; <code>Handler</code> &#x7C7B;&#x53BB;&#x7EE7;&#x627F; <code>ChannelInboundHandlerAdapter</code>&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x91CD;&#x5199;&#x76F8;&#x5E94;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x770B;&#x4E00;&#x822C;&#x90FD;&#x9700;&#x8981;&#x91CD;&#x5199;&#x54EA;&#x4E9B;&#x65B9;&#x6CD5;</li>
</ol>
<p><img src="../img/netty36.png" alt=""></p>
<h2 id="pipeline-&#x548C;-channelpipeline"><a name="pipeline-&#x548C;-channelpipeline" class="anchor-navigation-ex-anchor" href="#pipeline-&#x548C;-channelpipeline"><i class="fa fa-link" aria-hidden="true"></i></a>3.6. Pipeline &#x548C; ChannelPipeline</h2>
<p><code>ChannelPipeline</code> &#x662F;&#x4E00;&#x4E2A;&#x91CD;&#x70B9;&#xFF1A;</p>
<ol>
<li><code>ChannelPipeline</code> &#x662F;&#x4E00;&#x4E2A; <code>Handler</code> &#x7684;&#x96C6;&#x5408;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x5904;&#x7406;&#x548C;&#x62E6;&#x622A; <code>inbound</code> &#x6216;&#x8005; <code>outbound</code> &#x7684;&#x4E8B;&#x4EF6;&#x548C;&#x64CD;&#x4F5C;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x8D2F;&#x7A7F; <code>Netty</code> &#x7684;&#x94FE;&#x3002;&#xFF08;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x7406;&#x89E3;&#xFF1A;<code>ChannelPipeline</code> &#x662F;&#x4FDD;&#x5B58; <code>ChannelHandler</code> &#x7684; <code>List</code>&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x6216;&#x62E6;&#x622A; <code>Channel</code> &#x7684;&#x5165;&#x7AD9;&#x4E8B;&#x4EF6;&#x548C;&#x51FA;&#x7AD9;&#x64CD;&#x4F5C;&#xFF09;</li>
<li><code>ChannelPipeline</code> &#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x79CD;&#x9AD8;&#x7EA7;&#x5F62;&#x5F0F;&#x7684;&#x62E6;&#x622A;&#x8FC7;&#x6EE4;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x63A7;&#x5236;&#x4E8B;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA; <code>Channel</code> &#x4E2D;&#x5404;&#x4E2A;&#x7684; <code>ChannelHandler</code> &#x5982;&#x4F55;&#x76F8;&#x4E92;&#x4EA4;&#x4E92;</li>
<li>&#x5728; <code>Netty</code> &#x4E2D;&#x6BCF;&#x4E2A; <code>Channel</code> &#x90FD;&#x6709;&#x4E14;&#x4EC5;&#x6709;&#x4E00;&#x4E2A; <code>ChannelPipeline</code> &#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x7EC4;&#x6210;&#x5173;&#x7CFB;&#x5982;&#x4E0B;</li>
</ol>
<p><img src="../img/netty37.png" alt=""></p>
<ol>
<li>&#x5E38;&#x7528;&#x65B9;&#x6CD5;
<code>ChannelPipeline addFirst(ChannelHandler... handlers)</code>&#xFF0C;&#x628A;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x7C7B;&#xFF08;<code>handler</code>&#xFF09;&#x6DFB;&#x52A0;&#x5230;&#x94FE;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;<code>ChannelPipeline addLast(ChannelHandler... handlers)</code>&#xFF0C;&#x628A;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x7C7B;&#xFF08;<code>handler</code>&#xFF09;&#x6DFB;&#x52A0;&#x5230;&#x94FE;&#x4E2D;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;</li>
</ol>
<blockquote>
<p>&#x60F3;&#x8981;&#x66F4;&#x6E05;&#x695A;&#x7684;&#x4E86;&#x89E3;pipeline&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;debug&#xFF0C;&#x770B;&#x4E00;&#x4E0B;pipeline&#x91CC;&#x7A76;&#x7ADF;&#x6709;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x3002;</p>
</blockquote>
<p>&#x4ECE;head&#x770B;&#x4E00;&#x4E0B;debug</p>
<p><img src="../img/netty38.png" alt=""></p>
<ul>
<li><code>TestServerInitializer</code>&#x548C;<code>HttpServerCodec</code>&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x672C;&#x8EAB;&#x4E5F;&#x662F;<code>handler</code></li>
<li>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x4E8B;&#x4EF6;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x5F80;&#x670D;&#x52A1;&#x5668;&#x8D70;&#x6211;&#x4EEC;&#x79F0;&#x4E3A;&#x51FA;&#x7AD9;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x662F;&#x5165;&#x7AD9;&#x3002;</li>
</ul>
<h2 id="channelhandlercontext"><a name="channelhandlercontext" class="anchor-navigation-ex-anchor" href="#channelhandlercontext"><i class="fa fa-link" aria-hidden="true"></i></a>3.7. ChannelHandlerContext</h2>
<ol>
<li>&#x4FDD;&#x5B58; <code>Channel</code> &#x76F8;&#x5173;&#x7684;&#x6240;&#x6709;&#x4E0A;&#x4E0B;&#x6587;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x65F6;&#x5173;&#x8054;&#x4E00;&#x4E2A; <code>ChannelHandler</code> &#x5BF9;&#x8C61;</li>
<li>&#x5373; <code>ChannelHandlerContext</code> &#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x5668; <code>ChannelHandler</code>&#xFF0C;&#x540C;&#x65F6; <code>ChannelHandlerContext</code> &#x4E2D;&#x4E5F;&#x7ED1;&#x5B9A;&#x4E86;&#x5BF9;&#x5E94;&#x7684; <code>pipeline</code> &#x548C; <code>Channel</code> &#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x65B9;&#x4FBF;&#x5BF9; <code>ChannelHandler</code> &#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</li>
</ol>
<p><img src="../img/netty39.png" alt=""></p>
<ol>
<li><p>&#x5E38;&#x7528;&#x65B9;&#x6CD5;</p>
</li>
<li><p><code>ChannelFuture close()</code>&#xFF0C;&#x5173;&#x95ED;&#x901A;&#x9053;</p>
</li>
<li><code>ChannelOutboundInvoker flush()</code>&#xFF0C;&#x5237;&#x65B0;</li>
<li><code>ChannelFuture writeAndFlush(Object msg)</code>&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x5199;&#x5230; </li>
<li><code>ChannelPipeline</code> &#x4E2D;&#x5F53;&#x524D; <code>ChannelHandler</code> &#x7684;&#x4E0B;&#x4E00;&#x4E2A; <code>ChannelHandler</code> &#x5F00;&#x59CB;&#x5904;&#x7406;&#xFF08;&#x51FA;&#x7AD9;&#xFF09;</li>
</ol>
<p><img src="../img/netty40.png" alt=""></p>
<h2 id="channeloption"><a name="channeloption" class="anchor-navigation-ex-anchor" href="#channeloption"><i class="fa fa-link" aria-hidden="true"></i></a>3.8. ChannelOption</h2>
<ol>
<li><code>Netty</code> &#x5728;&#x521B;&#x5EFA; <code>Channel</code> &#x5B9E;&#x4F8B;&#x540E;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x9700;&#x8981;&#x8BBE;&#x7F6E; <code>ChannelOption</code> &#x53C2;&#x6570;&#x3002;</li>
<li><code>ChannelOption</code> &#x53C2;&#x6570;&#x5982;&#x4E0B;&#xFF1A;</li>
</ol>
<p><img src="../img/netty41.png" alt=""></p>
<h2 id="eventloopgroup-&#x548C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;-nioeventloopgroup"><a name="eventloopgroup-&#x548C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;-nioeventloopgroup" class="anchor-navigation-ex-anchor" href="#eventloopgroup-&#x548C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;-nioeventloopgroup"><i class="fa fa-link" aria-hidden="true"></i></a>3.9. EventLoopGroup &#x548C;&#x5176;&#x5B9E;&#x73B0;&#x7C7B; NioEventLoopGroup</h2>
<ol>
<li><code>EventLoopGroup</code> &#x662F;&#x4E00;&#x7EC4; <code>EventLoop</code> &#x7684;&#x62BD;&#x8C61;&#xFF0C;<code>Netty</code> &#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x5229;&#x7528;&#x591A;&#x6838; <code>CPU</code> &#x8D44;&#x6E90;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x6709;&#x591A;&#x4E2A; <code>EventLoop</code> &#x540C;&#x65F6;&#x5DE5;&#x4F5C;&#xFF0C;&#x6BCF;&#x4E2A; <code>EventLoop</code> &#x7EF4;&#x62A4;&#x7740;&#x4E00;&#x4E2A; <code>Selector</code> &#x5B9E;&#x4F8B;&#x3002;</li>
<li><code>EventLoopGroup</code> &#x63D0;&#x4F9B; <code>next</code> &#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x7EC4;&#x91CC;&#x9762;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x89C4;&#x5219;&#x83B7;&#x53D6;&#x5176;&#x4E2D;&#x4E00;&#x4E2A; <code>EventLoop</code> &#x6765;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x3002;&#x5728; <code>Netty</code> &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7F16;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x90FD;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x4E24;&#x4E2A; <code>EventLoopGroup</code>&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<code>BossEventLoopGroup</code> &#x548C; <code>WorkerEventLoopGroup</code>&#x3002;</li>
<li>&#x901A;&#x5E38;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x5373;&#x4E00;&#x4E2A; <code>ServerSocketChannel</code> &#x5BF9;&#x5E94;&#x4E00;&#x4E2A; <code>Selector</code> &#x548C;&#x4E00;&#x4E2A; <code>EventLoop</code> &#x7EBF;&#x7A0B;&#x3002;<code>BossEventLoop</code> &#x8D1F;&#x8D23;&#x63A5;&#x6536;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x5E76;&#x5C06; <code>SocketChannel</code> &#x4EA4;&#x7ED9; <code>WorkerEventLoopGroup</code> &#x6765;&#x8FDB;&#x884C; <code>IO</code> &#x5904;&#x7406;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;</li>
</ol>
<p><img src="../img/netty42.png" alt=""></p>
<ol>
<li>&#x5E38;&#x7528;&#x65B9;&#x6CD5;
<code>public NioEventLoopGroup()</code>&#xFF0C;&#x6784;&#x9020;&#x65B9;&#x6CD5;
<code>public Future<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?</span><span class="token punctuation">&gt;</span></span> shutdownGracefully()</code>&#xFF0C;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;</li>
</ol>
<h2 id="unpooled-&#x7C7B;"><a name="unpooled-&#x7C7B;" class="anchor-navigation-ex-anchor" href="#unpooled-&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>3.10. Unpooled &#x7C7B;</h2>
<ol>
<li><code>Netty</code> &#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x7528;&#x6765;&#x64CD;&#x4F5C;&#x7F13;&#x51B2;&#x533A;&#xFF08;&#x5373; <code>Netty</code> &#x7684;&#x6570;&#x636E;&#x5BB9;&#x5668;&#xFF09;&#x7684;&#x5DE5;&#x5177;&#x7C7B;</li>
<li>&#x5E38;&#x7528;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#x6240;&#x793A;</li>
</ol>
<p><img src="../img/netty43.png" alt=""></p>
<ol>
<li>&#x4E3E;&#x4F8B;&#x8BF4;&#x660E; <code>Unpooled</code> &#x83B7;&#x53D6; <code>Netty</code> &#x7684;&#x6570;&#x636E;&#x5BB9;&#x5668; <code>ByteBuf</code> &#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;</li>
</ol>
<p><img src="../img/netty44.png" alt=""></p>
<p>&#x6848;&#x4F8B; 1</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buf</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyByteBuf01</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ByteBuf</span>
        <span class="token comment">//&#x8BF4;&#x660E;</span>
        <span class="token comment">//1. &#x521B;&#x5EFA; &#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;arr , &#x662F;&#x4E00;&#x4E2A;byte[10]</span>
        <span class="token comment">//2. &#x5728;netty &#x7684;buffer&#x4E2D;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;flip &#x8FDB;&#x884C;&#x53CD;&#x8F6C;</span>
        <span class="token comment">//   &#x5E95;&#x5C42;&#x7EF4;&#x62A4;&#x4E86; readerindex &#x548C; writerIndex</span>
        <span class="token comment">//3. &#x901A;&#x8FC7; readerindex &#x548C;  writerIndex &#x548C;  capacity&#xFF0C; &#x5C06;buffer&#x5206;&#x6210;&#x4E09;&#x4E2A;&#x533A;&#x57DF;</span>
        <span class="token comment">// 0---readerindex &#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x7684;&#x533A;&#x57DF;</span>
        <span class="token comment">// readerindex---writerIndex &#xFF0C; &#x53EF;&#x8BFB;&#x7684;&#x533A;&#x57DF;</span>
        <span class="token comment">// writerIndex -- capacity, &#x53EF;&#x5199;&#x7684;&#x533A;&#x57DF;</span>
        <span class="token class-name">ByteBuf</span> buffer <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            buffer<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity=&quot;</span> <span class="token operator">+</span> buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span>
        <span class="token comment">//&#x8F93;&#x51FA;</span>
<span class="token comment">//        for(int i = 0; i&lt;buffer.capacity(); i++) {</span>
              <span class="token comment">//&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;readerindex&#x4E0D;&#x4F1A;&#x53D8;</span>
<span class="token comment">//            System.out.println(buffer.getByte(i));</span>
<span class="token comment">//        }</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;readerindex&#x4F1A;&#x53D8;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6848;&#x4F8B; 2</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buf</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyByteBuf02</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x521B;&#x5EFA;ByteBuf</span>
        <span class="token class-name">ByteBuf</span> byteBuf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello,world!&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x4F7F;&#x7528;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">hasArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// true</span>

            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x5C06; content &#x8F6C;&#x6210;&#x5B57;&#x7B26;&#x4E32;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;byteBuf=&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">arrayOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">readerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">writerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 36</span>

            <span class="token comment">//System.out.println(byteBuf.readByte()); //</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 104</span>

            <span class="token keyword">int</span> len <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x53EF;&#x8BFB;&#x7684;&#x5B57;&#x8282;&#x6570;  12</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;len=&quot;</span> <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x4F7F;&#x7528;for&#x53D6;&#x51FA;&#x5404;&#x4E2A;&#x5B57;&#x8282;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> byteBuf<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//&#x6309;&#x7167;&#x67D0;&#x4E2A;&#x8303;&#x56F4;&#x8BFB;&#x53D6;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">getCharSequence</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">getCharSequence</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="netty-&#x5E94;&#x7528;&#x5B9E;&#x4F8B;-&#x7FA4;&#x804A;&#x7CFB;&#x7EDF;"><a name="netty-&#x5E94;&#x7528;&#x5B9E;&#x4F8B;-&#x7FA4;&#x804A;&#x7CFB;&#x7EDF;" class="anchor-navigation-ex-anchor" href="#netty-&#x5E94;&#x7528;&#x5B9E;&#x4F8B;-&#x7FA4;&#x804A;&#x7CFB;&#x7EDF;"><i class="fa fa-link" aria-hidden="true"></i></a>3.11. Netty &#x5E94;&#x7528;&#x5B9E;&#x4F8B;-&#x7FA4;&#x804A;&#x7CFB;&#x7EDF;</h2>
<p>&#x5B9E;&#x4F8B;&#x8981;&#x6C42;&#xFF1A;</p>
<ol>
<li>&#x7F16;&#x5199;&#x4E00;&#x4E2A; <code>Netty</code> &#x7FA4;&#x804A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x7B80;&#x5355;&#x901A;&#x8BAF;&#xFF08;&#x975E;&#x963B;&#x585E;&#xFF09;</li>
<li>&#x5B9E;&#x73B0;&#x591A;&#x4EBA;&#x7FA4;&#x804A;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF1A;&#x53EF;&#x4EE5;&#x76D1;&#x6D4B;&#x7528;&#x6237;&#x4E0A;&#x7EBF;&#xFF0C;&#x79BB;&#x7EBF;&#xFF0C;&#x5E76;&#x5B9E;&#x73B0;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x529F;&#x80FD;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x901A;&#x8FC7; <code>channel</code> &#x53EF;&#x4EE5;&#x65E0;&#x963B;&#x585E;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7ED9;&#x5176;&#x5B83;&#x6240;&#x6709;&#x7528;&#x6237;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x5176;&#x5B83;&#x7528;&#x6237;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#xFF08;&#x6709;&#x670D;&#x52A1;&#x5668;&#x8F6C;&#x53D1;&#x5F97;&#x5230;&#xFF09;</li>
<li>&#x76EE;&#x7684;&#xFF1A;&#x8FDB;&#x4E00;&#x6B65;&#x7406;&#x89E3; <code>Netty</code> &#x975E;&#x963B;&#x585E;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x673A;&#x5236;</li>
</ol>
<p><img src="../img/netty45.png" alt=""></p>
<p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<h3 id="groupchatserver"><a name="groupchatserver" class="anchor-navigation-ex-anchor" href="#groupchatserver"><i class="fa fa-link" aria-hidden="true"></i></a>3.11.1. GroupChatServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span> <span class="token comment">//&#x76D1;&#x542C;&#x7AEF;&#x53E3;</span>


    <span class="token keyword">public</span> <span class="token class-name">GroupChatServer</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x7F16;&#x5199;run&#x65B9;&#x6CD5;&#xFF0C;&#x5904;&#x7406;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token comment">//&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4;</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8&#x4E2A;NioEventLoop</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_BACKLOG<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_KEEPALIVE<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

                            <span class="token comment">//&#x83B7;&#x53D6;&#x5230;pipeline</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x5411;pipeline&#x52A0;&#x5165;&#x89E3;&#x7801;&#x5668;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;decoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x5411;pipeline&#x52A0;&#x5165;&#x7F16;&#x7801;&#x5668;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;encoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//&#x52A0;&#x5165;&#x81EA;&#x5DF1;&#x7684;&#x4E1A;&#x52A1;&#x5904;&#x7406;handler</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupChatServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;netty &#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x76D1;&#x542C;&#x5173;&#x95ED;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">new</span> <span class="token class-name">GroupChatServer</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="groupchatserverhandler"><a name="groupchatserverhandler" class="anchor-navigation-ex-anchor" href="#groupchatserverhandler"><i class="fa fa-link" aria-hidden="true"></i></a>3.11.2. GroupChatServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>group<span class="token punctuation">.</span></span><span class="token class-name">ChannelGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>group<span class="token punctuation">.</span></span><span class="token class-name">DefaultChannelGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">GlobalEventExecutor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x8FD9;&#x6837;&#x5199;&#x8FD8;&#x8981;&#x81EA;&#x5DF1;&#x904D;&#x5386;Channel</span>
    <span class="token comment">//public static List&lt;Channel&gt; channels = new ArrayList&lt;Channel&gt;();</span>

    <span class="token comment">//&#x4F7F;&#x7528;&#x4E00;&#x4E2A;hashmap &#x7BA1;&#x7406;&#x79C1;&#x804A;&#xFF08;&#x79C1;&#x804A;&#x672C;&#x6848;&#x4F8B;&#x5E76;&#x672A;&#x5B9E;&#x73B0;&#xFF0C;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x4E2A;&#x601D;&#x8DEF;&#xFF09;</span>
    <span class="token comment">//public static Map&lt;String, Channel&gt; channels = new HashMap&lt;String,Channel&gt;();</span>

    <span class="token comment">//&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;channle &#x7EC4;&#xFF0C;&#x7BA1;&#x7406;&#x6240;&#x6709;&#x7684;channel</span>
    <span class="token comment">//GlobalEventExecutor.INSTANCE) &#x662F;&#x5168;&#x5C40;&#x7684;&#x4E8B;&#x4EF6;&#x6267;&#x884C;&#x5668;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ChannelGroup</span>  channelGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultChannelGroup</span><span class="token punctuation">(</span><span class="token class-name">GlobalEventExecutor</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">//handlerAdded &#x8868;&#x793A;&#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#xFF0C;&#x4E00;&#x65E6;&#x8FDE;&#x63A5;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x88AB;&#x6267;&#x884C;</span>
    <span class="token comment">//&#x5C06;&#x5F53;&#x524D;channel &#x52A0;&#x5165;&#x5230;  channelGroup</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5C06;&#x8BE5;&#x5BA2;&#x6237;&#x52A0;&#x5165;&#x804A;&#x5929;&#x7684;&#x4FE1;&#x606F;&#x63A8;&#x9001;&#x7ED9;&#x5176;&#x5B83;&#x5728;&#x7EBF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;</span>

        <span class="token comment">//&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x5C06; channelGroup &#x4E2D;&#x6240;&#x6709;&#x7684;channel &#x904D;&#x5386;&#xFF0C;&#x5E76;&#x53D1;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x904D;&#x5386;</span>

        channelGroup<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[&#x5BA2;&#x6237;&#x7AEF;]&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x52A0;&#x5165;&#x804A;&#x5929;&quot;</span> <span class="token operator">+</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channelGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x79C1;&#x804A;&#x5982;&#x4F55;&#x5B9E;&#x73B0;</span>
<span class="token comment">//         channels.put&#xFF08;&quot;userid100&quot;,channel&#xFF09;;</span>


    <span class="token punctuation">}</span>

    <span class="token comment">//&#x65AD;&#x5F00;&#x8FDE;&#x63A5;, &#x5C06;xx&#x5BA2;&#x6237;&#x79BB;&#x5F00;&#x4FE1;&#x606F;&#x63A8;&#x9001;&#x7ED9;&#x5F53;&#x524D;&#x5728;&#x7EBF;&#x7684;&#x5BA2;&#x6237;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRemoved</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channelGroup<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[&#x5BA2;&#x6237;&#x7AEF;]&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x79BB;&#x5F00;&#x4E86;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;channelGroup size&quot;</span> <span class="token operator">+</span> channelGroup<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//&#x8868;&#x793A;channel &#x5904;&#x4E8E;&#x6D3B;&#x52A8;&#x72B6;&#x6001;, &#x63D0;&#x793A; xx&#x4E0A;&#x7EBF;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x8FD9;&#x4E2A;&#x662F;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#x770B;&#x7684;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x63D0;&#x793A;xxx&#x52A0;&#x5165;&#x7FA4;&#x804A;&#x4E86;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x4E0A;&#x7EBF;&#x4E86;~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x8868;&#x793A;channel &#x5904;&#x4E8E;&#x4E0D;&#x6D3B;&#x52A8;&#x72B6;&#x6001;, &#x63D0;&#x793A; xx&#x79BB;&#x7EBF;&#x4E86;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x79BB;&#x7EBF;&#x4E86;~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x8F6C;&#x53D1;&#x7ED9;&#x5728;&#x7EBF;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//&#x83B7;&#x53D6;&#x5230;&#x5F53;&#x524D;channel</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x904D;&#x5386;channelGroup, &#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x56DE;&#x9001;&#x4E0D;&#x540C;&#x7684;&#x6D88;&#x606F;</span>

        channelGroup<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>ch <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>channel <span class="token operator">!=</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//&#x4E0D;&#x662F;&#x5F53;&#x524D;&#x7684;channel,&#x8F6C;&#x53D1;&#x6D88;&#x606F;</span>
                ch<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[&#x5BA2;&#x6237;]&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &#x53D1;&#x9001;&#x4E86;&#x6D88;&#x606F;&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//&#x56DE;&#x663E;&#x81EA;&#x5DF1;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x7ED9;&#x81EA;&#x5DF1;</span>
                ch<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[&#x81EA;&#x5DF1;]&#x53D1;&#x9001;&#x4E86;&#x6D88;&#x606F;&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x5173;&#x95ED;&#x901A;&#x9053;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="groupchatclient"><a name="groupchatclient" class="anchor-navigation-ex-anchor" href="#groupchatclient"><i class="fa fa-link" aria-hidden="true"></i></a>3.11.3. GroupChatClient</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatClient</span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x5C5E;&#x6027;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GroupChatClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>


        <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

                        <span class="token comment">//&#x5F97;&#x5230;pipeline</span>
                        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//&#x52A0;&#x5165;&#x76F8;&#x5173;handler</span>
                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;decoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">&quot;encoder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//&#x52A0;&#x5165;&#x81EA;&#x5B9A;&#x4E49;&#x7684;handler</span>
                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GroupChatClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#x5F97;&#x5230;channel</span>
            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">localAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;--------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x8F93;&#x5165;&#x4FE1;&#x606F;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x626B;&#x63CF;&#x5668;</span>
            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasNextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> msg <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//&#x901A;&#x8FC7;channel &#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;</span>
                channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">GroupChatClient</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="groupchatclienthandler"><a name="groupchatclienthandler" class="anchor-navigation-ex-anchor" href="#groupchatclienthandler"><i class="fa fa-link" aria-hidden="true"></i></a>3.11.4. GroupChatClientHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">//&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x62FF;&#x5230;&#x7684;&#x6570;&#x636E;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="netty-&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;"><a name="netty-&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#netty-&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>3.12. Netty &#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;</h2>
<p>&#x5B9E;&#x4F8B;&#x8981;&#x6C42;&#xFF1A;</p>
<ol>
<li>&#x7F16;&#x5199;&#x4E00;&#x4E2A; <code>Netty</code> &#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x6848;&#x4F8B;,&#x5F53;&#x670D;&#x52A1;&#x5668;&#x8D85;&#x8FC7; <code>3</code> &#x79D2;&#x6CA1;&#x6709;&#x8BFB;&#x65F6;&#xFF0C;&#x5C31;&#x63D0;&#x793A;&#x8BFB;&#x7A7A;&#x95F2;</li>
<li>&#x5F53;&#x670D;&#x52A1;&#x5668;&#x8D85;&#x8FC7; <code>5</code> &#x79D2;&#x6CA1;&#x6709;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5C31;&#x63D0;&#x793A;&#x5199;&#x7A7A;&#x95F2;</li>
<li>&#x5B9E;&#x73B0;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x8D85;&#x8FC7; <code>7</code> &#x79D2;&#x6CA1;&#x6709;&#x8BFB;&#x6216;&#x8005;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5C31;&#x63D0;&#x793A;&#x8BFB;&#x5199;&#x7A7A;&#x95F2;</li>
<li>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ol>
<h3 id="myserver"><a name="myserver" class="anchor-navigation-ex-anchor" href="#myserver"><i class="fa fa-link" aria-hidden="true"></i></a>3.12.1. MyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>heartbeat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LogLevel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LoggingHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span></span><span class="token class-name">IdleStateHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>


        <span class="token comment">//&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4;</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8&#x4E2A;NioEventLoop</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//&#x5728;bossGroup&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#x5668;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//&#x52A0;&#x5165;&#x4E00;&#x4E2A;netty &#x63D0;&#x4F9B; IdleStateHandler</span>
                    <span class="token comment">/*
                    &#x8BF4;&#x660E;
                    1. IdleStateHandler &#x662F;netty &#x63D0;&#x4F9B;&#x7684;&#x5904;&#x7406;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#x7684;&#x5904;&#x7406;&#x5668;
                    2. long readerIdleTime : &#x8868;&#x793A;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x8BFB;, &#x5C31;&#x4F1A;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x5305;&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x8FDE;&#x63A5;
                    3. long writerIdleTime : &#x8868;&#x793A;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x5199;, &#x5C31;&#x4F1A;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x5305;&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x8FDE;&#x63A5;
                    4. long allIdleTime : &#x8868;&#x793A;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x8BFB;&#x5199;, &#x5C31;&#x4F1A;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x5305;&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x8FDE;&#x63A5;

                    5. &#x6587;&#x6863;&#x8BF4;&#x660E;
                    triggers an {@link IdleStateEvent} when a {@link Channel} has not performed
                   read, write, or both operation for a while.
                    6. &#x5F53; IdleStateEvent &#x89E6;&#x53D1;&#x540E; , &#x5C31;&#x4F1A;&#x4F20;&#x9012;&#x7ED9;&#x7BA1;&#x9053; &#x7684;&#x4E0B;&#x4E00;&#x4E2A;handler&#x53BB;&#x5904;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528;(&#x89E6;&#x53D1;)
                   &#x4E0B;&#x4E00;&#x4E2A;handler &#x7684; userEventTiggered , &#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x53BB;&#x5904;&#x7406; IdleStateEvent(&#x8BFB;&#x7A7A;&#x95F2;&#xFF0C;&#x5199;&#x7A7A;&#x95F2;&#xFF0C;&#x8BFB;&#x5199;&#x7A7A;&#x95F2;)
                    7.handlerRemoved&#x6709;&#x65F6;&#x5019;&#x662F;&#x65E0;&#x6CD5;&#x611F;&#x77E5;&#x8FDE;&#x63A5;&#x65AD;&#x6389;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x5FC3;&#x8DF3;&#x5305;&#x7684;&#x68C0;&#x6D4B;&#x6765;&#x5224;&#x65AD;&#x8FDE;&#x63A5;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x6548;
                     */</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IdleStateHandler</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x5BF9;&#x7A7A;&#x95F2;&#x68C0;&#x6D4B;&#x8FDB;&#x4E00;&#x6B65;&#x5904;&#x7406;&#x7684;handler(&#x81EA;&#x5B9A;&#x4E49;)</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="myserverhandler"><a name="myserverhandler" class="anchor-navigation-ex-anchor" href="#myserverhandler"><i class="fa fa-link" aria-hidden="true"></i></a>3.12.2. MyServerHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>heartbeat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span></span><span class="token class-name">IdleStateEvent</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     *
     * @param ctx &#x4E0A;&#x4E0B;&#x6587;
     * @param evt &#x4E8B;&#x4EF6;
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>evt <span class="token keyword">instanceof</span> <span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">//&#x5C06;  evt &#x5411;&#x4E0B;&#x8F6C;&#x578B; IdleStateEvent</span>
            <span class="token class-name">IdleStateEvent</span> event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> evt<span class="token punctuation">;</span>
            <span class="token class-name">String</span> eventType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> READER_IDLE<span class="token operator">:</span>
                  eventType <span class="token operator">=</span> <span class="token string">&quot;&#x8BFB;&#x7A7A;&#x95F2;&quot;</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> WRITER_IDLE<span class="token operator">:</span>
                    eventType <span class="token operator">=</span> <span class="token string">&quot;&#x5199;&#x7A7A;&#x95F2;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> ALL_IDLE<span class="token operator">:</span>
                    eventType <span class="token operator">=</span> <span class="token string">&quot;&#x8BFB;&#x5199;&#x7A7A;&#x95F2;&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&#x8D85;&#x65F6;&#x65F6;&#x95F4;--&quot;</span> <span class="token operator">+</span> eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x505A;&#x76F8;&#x5E94;&#x5904;&#x7406;..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x5982;&#x679C;&#x53D1;&#x751F;&#x7A7A;&#x95F2;&#xFF0C;&#x6211;&#x4EEC;&#x5173;&#x95ED;&#x901A;&#x9053;</span>
           <span class="token comment">// ctx.channel().close();</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="netty-&#x901A;&#x8FC7;-websocket-&#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;"><a name="netty-&#x901A;&#x8FC7;-websocket-&#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;" class="anchor-navigation-ex-anchor" href="#netty-&#x901A;&#x8FC7;-websocket-&#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;"><i class="fa fa-link" aria-hidden="true"></i></a>3.13. Netty &#x901A;&#x8FC7; WebSocket &#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;</h2>
<p>&#x5B9E;&#x4F8B;&#x8981;&#x6C42;&#xFF1A;</p>
<ol>
<li><code>Http</code> &#x534F;&#x8BAE;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x670D;&#x52A1;&#x5668;&#x95F4;&#x7684;&#x8BF7;&#x6C42;&#x54CD;&#x5E94;&#x4E00;&#x6B21;&#xFF0C;&#x4E0B;&#x4E00;&#x6B21;&#x4F1A;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x8FDE;&#x63A5;&#x3002;</li>
<li>&#x8981;&#x6C42;&#xFF1A;&#x5B9E;&#x73B0;&#x57FA;&#x4E8E; <code>WebSocket</code> &#x7684;&#x957F;&#x8FDE;&#x63A5;&#x7684;&#x5168;&#x53CC;&#x5DE5;&#x7684;&#x4EA4;&#x4E92;</li>
<li>&#x6539;&#x53D8; <code>Http</code> &#x534F;&#x8BAE;&#x591A;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x7EA6;&#x675F;&#xFF0C;&#x5B9E;&#x73B0;&#x957F;&#x8FDE;&#x63A5;&#x4E86;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7ED9;&#x6D4F;&#x89C8;&#x5668;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4F1A;&#x76F8;&#x4E92;&#x611F;&#x77E5;&#xFF0C;&#x6BD4;&#x5982;&#x670D;&#x52A1;&#x5668;&#x5173;&#x95ED;&#x4E86;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x611F;&#x77E5;&#xFF0C;&#x540C;&#x6837;&#x6D4F;&#x89C8;&#x5668;&#x5173;&#x95ED;&#x4E86;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x611F;&#x77E5;</li>
<li>&#x8FD0;&#x884C;&#x754C;&#x9762;</li>
</ol>
<p><img src="../img/netty46.png" alt=""></p>
<h3 id="myserver_1"><a name="myserver_1" class="anchor-navigation-ex-anchor" href="#myserver_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.13.1. MyServer</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>websocket</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>heartbeat<span class="token punctuation">.</span></span><span class="token class-name">MyServerHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpObjectAggregator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServerCodec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span>websocketx<span class="token punctuation">.</span></span><span class="token class-name">WebSocketServerProtocolHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LogLevel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LoggingHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">ChunkedWriteHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span></span><span class="token class-name">IdleStateHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>


        <span class="token comment">//&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7EC4;</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8&#x4E2A;NioEventLoop</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serverBootstrap<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//&#x56E0;&#x4E3A;&#x57FA;&#x4E8E;http&#x534F;&#x8BAE;&#xFF0C;&#x4F7F;&#x7528;http&#x7684;&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x5668;</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//http&#x662F;&#x4EE5;&#x5757;&#x65B9;&#x5F0F;&#x5199;&#xFF0C;&#x6DFB;&#x52A0;ChunkedWriteHandler&#x5904;&#x7406;&#x5668;</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChunkedWriteHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">/*
                    &#x8BF4;&#x660E;
                    1. http&#x6570;&#x636E;&#x5728;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x5206;&#x6BB5;, HttpObjectAggregator &#xFF0C;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A;&#x6BB5;&#x805A;&#x5408;
                    2. &#x8FD9;&#x5C31;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF0C;&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x5927;&#x91CF;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x51FA;&#x591A;&#x6B21;http&#x8BF7;&#x6C42;
                     */</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">(</span><span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">/*
                    &#x8BF4;&#x660E;
                    1. &#x5BF9;&#x5E94;websocket &#xFF0C;&#x5B83;&#x7684;&#x6570;&#x636E;&#x662F;&#x4EE5; &#x5E27;(frame) &#x5F62;&#x5F0F;&#x4F20;&#x9012;
                    2. &#x53EF;&#x4EE5;&#x770B;&#x5230;WebSocketFrame &#x4E0B;&#x9762;&#x6709;&#x516D;&#x4E2A;&#x5B50;&#x7C7B;
                    3. &#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x65F6; ws://localhost:7000/hello &#x8868;&#x793A;&#x8BF7;&#x6C42;&#x7684;uri
                    4. WebSocketServerProtocolHandler &#x6838;&#x5FC3;&#x529F;&#x80FD;&#x662F;&#x5C06; http&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x4E3A; ws&#x534F;&#x8BAE; , &#x4FDD;&#x6301;&#x957F;&#x8FDE;&#x63A5;
                    5. &#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A; &#x72B6;&#x6001;&#x7801; 101
                     */</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebSocketServerProtocolHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//&#x81EA;&#x5B9A;&#x4E49;&#x7684;handler &#xFF0C;&#x5904;&#x7406;&#x4E1A;&#x52A1;&#x903B;&#x8F91;</span>
                    pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyTextWebSocketFrameHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="mytextwebsocketframehandler"><a name="mytextwebsocketframehandler" class="anchor-navigation-ex-anchor" href="#mytextwebsocketframehandler"><i class="fa fa-link" aria-hidden="true"></i></a>3.13.2. MyTextWebSocketFrameHandler</h3>
<pre class="language-"><code class="lang-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>websocket</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span>websocketx<span class="token punctuation">.</span></span><span class="token class-name">TextWebSocketFrame</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>

<span class="token comment">//&#x8FD9;&#x91CC; TextWebSocketFrame &#x7C7B;&#x578B;&#xFF0C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x5E27;(frame)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTextWebSocketFrameHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">TextWebSocketFrame</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x6D88;&#x606F; &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x56DE;&#x590D;&#x6D88;&#x606F;</span>
        ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">(</span><span class="token string">&quot;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x95F4;&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//&#x5F53;web&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x540E;&#xFF0C; &#x89E6;&#x53D1;&#x65B9;&#x6CD5;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//id &#x8868;&#x793A;&#x552F;&#x4E00;&#x7684;&#x503C;&#xFF0C;LongText &#x662F;&#x552F;&#x4E00;&#x7684; ShortText &#x4E0D;&#x662F;&#x552F;&#x4E00;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;handlerAdded &#x88AB;&#x8C03;&#x7528;&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asLongText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;handlerAdded &#x88AB;&#x8C03;&#x7528;&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asShortText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRemoved</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;handlerRemoved &#x88AB;&#x8C03;&#x7528;&quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asLongText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#x5F02;&#x5E38;&#x53D1;&#x751F; &quot;</span> <span class="token operator">+</span> cause<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x5173;&#x95ED;&#x8FDE;&#x63A5;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="hellohtml"><a name="hellohtml" class="anchor-navigation-ex-anchor" href="#hellohtml"><i class="fa fa-link" aria-hidden="true"></i></a>3.13.3. hello.html</h3>
<pre class="language-"><code class="lang-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
    var socket;
    //&#x5224;&#x65AD;&#x5F53;&#x524D;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x5426;&#x652F;&#x6301;websocket
    if(window.WebSocket) {
        //go on
        socket = new WebSocket(&quot;ws://localhost:7000/hello2&quot;);
        //&#x76F8;&#x5F53;&#x4E8E;channelReado, ev &#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x56DE;&#x9001;&#x7684;&#x6D88;&#x606F;
        socket.onmessage = function (ev) {
            var rt = document.getElementById(&quot;responseText&quot;);
            rt.value = rt.value + &quot;\n&quot; + ev.data;
        }

        //&#x76F8;&#x5F53;&#x4E8E;&#x8FDE;&#x63A5;&#x5F00;&#x542F;(&#x611F;&#x77E5;&#x5230;&#x8FDE;&#x63A5;&#x5F00;&#x542F;)
        socket.onopen = function (ev) {
            var rt = document.getElementById(&quot;responseText&quot;);
            rt.value = &quot;&#x8FDE;&#x63A5;&#x5F00;&#x542F;&#x4E86;..&quot;
        }

        //&#x76F8;&#x5F53;&#x4E8E;&#x8FDE;&#x63A5;&#x5173;&#x95ED;(&#x611F;&#x77E5;&#x5230;&#x8FDE;&#x63A5;&#x5173;&#x95ED;)
        socket.onclose = function (ev) {

            var rt = document.getElementById(&quot;responseText&quot;);
            rt.value = rt.value + &quot;\n&quot; + &quot;&#x8FDE;&#x63A5;&#x5173;&#x95ED;&#x4E86;..&quot;
        }
    } else {
        alert(&quot;&#x5F53;&#x524D;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x652F;&#x6301;websocket&quot;)
    }

    //&#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230;&#x670D;&#x52A1;&#x5668;
    function send(message) {
        if(!window.socket) { //&#x5148;&#x5224;&#x65AD;socket&#x662F;&#x5426;&#x521B;&#x5EFA;&#x597D;
            return;
        }
        if(socket.readyState == WebSocket.OPEN) {
            //&#x901A;&#x8FC7;socket &#x53D1;&#x9001;&#x6D88;&#x606F;
            socket.send(message)
        } else {
            alert(&quot;&#x8FDE;&#x63A5;&#x6CA1;&#x6709;&#x5F00;&#x542F;&quot;);
        }
    }
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>return false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> 300px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&#x53D1;&#x751F;&#x6D88;&#x606F;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>send(this.form.message.value)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>responseText<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> 300px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&#x6E05;&#x7A7A;&#x5185;&#x5BB9;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>document.getElementById(<span class="token punctuation">&apos;</span>responseText<span class="token punctuation">&apos;</span>).value=<span class="token punctuation">&apos;</span><span class="token punctuation">&apos;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5E76;&#x4E0D;&#x662F;&#x53D1;&#x4E00;&#x6B21;&#x6570;&#x636E;&#xFF0C;&#x8FDE;&#x63A5;&#x5C31;&#x5173;&#x95ED;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x53D1;&#x9001;&#x3002;</p>
<p><img src="../img/netty47.png" alt=""></p>
<footer class="page-footer-ex"> <span class="page-footer-ex-copyright"> &#x4F7F;&#x7528;<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">&#x77E5;&#x8BC6;&#x5171;&#x4EAB; &#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0&#x534F;&#x8BAE;</a>&#x53D1;&#x5E03; </span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <span class="page-footer-ex-footer-update"> <i>updated</i> 2022-07-18 15:10:06 </span> </footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="1.传统IO.html" class="navigation navigation-prev " aria-label="Previous page: 1.传统IO">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="3.Netty实现rpc.html" class="navigation navigation-next " aria-label="Next page: 3.Netty实现rpc">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2.Netty实战","level":"1.8.2","depth":2,"next":{"title":"3.Netty实现rpc","level":"1.8.3","depth":2,"path":"7.Netty/3.Netty实现rpc.md","ref":"7.Netty/3.Netty实现rpc.md","articles":[]},"previous":{"title":"1.传统IO","level":"1.8.1","depth":2,"path":"7.Netty/1.传统IO.md","ref":"7.Netty/1.传统IO.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","copy-code-button","page-footer-ex","anchor-navigation-ex","expandable-chapters-small","prism","-highlight","-lunr","-search","theme-comscore","search-pro","splitter"],"ignores":["_book","node_modules"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"],"lang":{"flow":"typescript"}},"page-footer-ex":{"copyright":"使用[知识共享 署名-相同方式共享 4.0协议](https://creativecommons.org/licenses/by-sa/4.0/)发布","markdown":true,"update_format":"YYYY-MM-DD HH:mm:ss","update_label":"<i>updated</i>"},"splitter":{},"search-pro":{},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"theme-comscore":{},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"ALin","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"学习笔记","links":{"sidebar":{"Home":"https://lucklin8.github.io/ALin.github.io/"}},"gitbook":"*","description":"ALin的学习博客"},"file":{"path":"7.Netty/2.Netty实战.md","mtime":"2022-07-18T15:10:06.525Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-07-18T15:10:57.703Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

